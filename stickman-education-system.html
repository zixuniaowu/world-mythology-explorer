<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥è©±æ•™è‚²ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ - ç«æŸ´äººã§å­¦ã¶ä¸–ç•Œã®ç¥è©±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2em;
            color: #FFD700;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .header p {
            color: #F5E6D3;
            font-size: 1.1em;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .main-container {
            flex: 1;
            display: flex;
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ */
        .animation-stage {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .stage-title {
            font-size: 1.5em;
            color: #4ecdc4;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scene-number {
            background: #4ecdc4;
            color: #1a1a2e;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        /* Canvas */
        .canvas-container {
            position: relative;
            background: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        #animationCanvas {
            display: block;
            width: 100%;
            height: 400px;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆèª¬æ˜ã‚¨ãƒªã‚¢ */
        .text-description {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid #4ecdc4;
        }

        .text-description h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .text-description p {
            line-height: 1.8;
            color: #F5E6D3;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .control-panel {
            width: 350px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .playback-controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .controls-title {
            font-size: 1.2em;
            color: #FFD700;
            margin-bottom: 15px;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .control-btn {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-container {
            margin-top: 15px;
        }

        .progress-label {
            font-size: 0.9em;
            color: #a0a0a0;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4 0%, #44a08d 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* ã‚·ãƒ¼ãƒ³é¸æŠ */
        .scene-selector {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .scene-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .scene-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .scene-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #4ecdc4;
        }

        .scene-item.active {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
        }

        .scene-item-title {
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .scene-item-description {
            font-size: 0.9em;
            color: #a0a0a0;
        }

        /* è¨­å®šãƒ‘ãƒãƒ« */
        .settings-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .speed-control {
            margin-top: 15px;
        }

        .speed-label {
            font-size: 0.9em;
            color: #a0a0a0;
            margin-bottom: 8px;
        }

        .speed-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #4ecdc4;
            border-radius: 50%;
            cursor: pointer;
        }

        .speed-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #4ecdc4;
            border-radius: 50%;
            cursor: pointer;
        }

        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
        .checkbox-group {
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            color: #F5E6D3;
        }

        /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .control-panel {
                width: 100%;
            }

            #animationCanvas {
                height: 300px;
            }

            .header h1 {
                font-size: 1.5em;
            }
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: #4ecdc4;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>

    <header class="header">
        <h1>ğŸ­ ç¥è©±æ•™è‚²ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</h1>
        <p>ç«æŸ´äººã§å­¦ã¶ä¸–ç•Œã®ç¥è©±ç‰©èª</p>
    </header>

    <div class="main-container">
        <div class="animation-stage">
            <h2 class="stage-title">
                <span class="scene-number">ç¬¬1å¹•</span>
                <span id="sceneTitle">å“ªå’èª•ç”Ÿ - è“®ã®èŠ±ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸç¥ç«¥</span>
            </h2>

            <div class="canvas-container">
                <canvas id="animationCanvas"></canvas>
            </div>

            <div class="text-description">
                <h3>å ´é¢èª¬æ˜</h3>
                <p id="sceneDescription">
                    é™³å¡˜é–¢ã®ç·å…µãƒ»æé–ã®å®¶ã«ã€ä¸‰å¹´å…­ãƒ¶æœˆã®å¦Šå¨ æœŸé–“ã‚’çµŒã¦ã€ä¸æ€è­°ãªå­ä¾›ãŒç”Ÿã¾ã‚Œã¾ã—ãŸã€‚
                    ãã®å­ã¯è“®ã®èŠ±ã®ä¸­ã‹ã‚‰ç¾ã‚Œã€ç”Ÿã¾ã‚ŒãªãŒã‚‰ã«ã—ã¦ç¥é€šåŠ›ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚
                    å¤ªä¹™çœŸäººãŒã“ã®å­ã«ã€Œå“ªå’ã€ã¨ã„ã†åå‰ã‚’æˆã‘ã€ä¹¾å¤åœã¨æ··å¤©ç¶¾ã¨ã„ã†äºŒã¤ã®å®ç‰©ã‚’ä¸ãˆã¾ã—ãŸã€‚
                </p>
            </div>
        </div>

        <div class="control-panel">
            <!-- å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="playback-controls">
                <h3 class="controls-title">å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
                
                <div class="control-buttons">
                    <button class="control-btn" id="playBtn" onclick="togglePlay()">
                        <span>â–¶</span>
                        <span>å†ç”Ÿ</span>
                    </button>
                    <button class="control-btn" id="pauseBtn" onclick="pauseAnimation()">
                        <span>â¸</span>
                        <span>ä¸€æ™‚åœæ­¢</span>
                    </button>
                    <button class="control-btn" id="resetBtn" onclick="resetAnimation()">
                        <span>â®</span>
                        <span>æœ€åˆã‹ã‚‰</span>
                    </button>
                </div>

                <div class="progress-container">
                    <div class="progress-label">
                        <span>é€²è¡ŒçŠ¶æ³</span>
                        <span id="progressText">0%</span>
                    </div>
                    <div class="progress-bar" onclick="seekAnimation(event)">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>

            <!-- ã‚·ãƒ¼ãƒ³é¸æŠ -->
            <div class="scene-selector">
                <h3 class="controls-title">ã‚·ãƒ¼ãƒ³é¸æŠ</h3>
                <div class="scene-list">
                    <div class="scene-item active" onclick="selectScene(0)">
                        <div class="scene-item-title">ç¬¬1å¹•ï¼šå“ªå’èª•ç”Ÿ</div>
                        <div class="scene-item-description">è“®ã®èŠ±ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸç¥ç«¥</div>
                    </div>
                    <div class="scene-item" onclick="selectScene(1)">
                        <div class="scene-item-title">ç¬¬2å¹•ï¼šæµ·ã§éŠã¶</div>
                        <div class="scene-item-description">æ··å¤©ç¶¾ã§æµ·ã‚’æºã‚‰ã™</div>
                    </div>
                    <div class="scene-item" onclick="selectScene(2)">
                        <div class="scene-item-title">ç¬¬3å¹•ï¼šé¾å®®ã®æ€’ã‚Š</div>
                        <div class="scene-item-description">é¾ç‹ã®ä¸‰å¤ªå­ãƒ»æ•–ä¸™ç™»å ´</div>
                    </div>
                    <div class="scene-item" onclick="selectScene(3)">
                        <div class="scene-item-title">ç¬¬4å¹•ï¼šæˆ¦é—˜</div>
                        <div class="scene-item-description">å“ªå’ã¨æ•–ä¸™ã®å¯¾æ±º</div>
                    </div>
                    <div class="scene-item" onclick="selectScene(4)">
                        <div class="scene-item-title">ç¬¬5å¹•ï¼šé¾ç­‹ã‚’æŠœã</div>
                        <div class="scene-item-description">æ•–ä¸™ã®æœ€æœŸ</div>
                    </div>
                </div>
            </div>

            <!-- è¨­å®š -->
            <div class="settings-panel">
                <h3 class="controls-title">è¨­å®š</h3>
                
                <div class="speed-control">
                    <div class="speed-label">
                        ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦: <span id="speedValue">1.0x</span>
                    </div>
                    <input type="range" class="speed-slider" id="speedSlider" 
                           min="0.5" max="2" step="0.1" value="1" 
                           oninput="updateSpeed(this.value)">
                </div>

                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="showNarration" checked>
                        <label for="showNarration">ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="autoPlay" checked>
                        <label for="autoPlay">è‡ªå‹•æ¬¡å¹•å†ç”Ÿ</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="showEffects" checked>
                        <label for="showEffects">ç‰¹æ®ŠåŠ¹æœè¡¨ç¤º</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Canvasè¨­å®š
        const canvas = document.getElementById('animationCanvas');
        const ctx = canvas.getContext('2d');
        
        // Canvas ã‚µã‚¤ã‚ºè¨­å®š
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = 400;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        let isPlaying = false;
        let currentScene = 0;
        let animationProgress = 0;
        let animationSpeed = 1.0;
        let animationFrame = 0;

        // ã‚·ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿
        const scenes = [
            {
                title: "å“ªå’èª•ç”Ÿ - è“®ã®èŠ±ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸç¥ç«¥",
                description: "é™³å¡˜é–¢ã®ç·å…µãƒ»æé–ã®å®¶ã«ã€ä¸‰å¹´å…­ãƒ¶æœˆã®å¦Šå¨ æœŸé–“ã‚’çµŒã¦ã€ä¸æ€è­°ãªå­ä¾›ãŒç”Ÿã¾ã‚Œã¾ã—ãŸã€‚ãã®å­ã¯è“®ã®èŠ±ã®ä¸­ã‹ã‚‰ç¾ã‚Œã€ç”Ÿã¾ã‚ŒãªãŒã‚‰ã«ã—ã¦ç¥é€šåŠ›ã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚",
                duration: 5000,
                frames: []
            },
            {
                title: "æµ·ã§éŠã¶ - æ··å¤©ç¶¾ã§æµ·ã‚’æºã‚‰ã™",
                description: "ä¸ƒæ­³ã«ãªã£ãŸå“ªå’ã¯ã€æš‘ã„å¤ã®æ—¥ã«æµ·è¾ºã§æ°´æµ´ã³ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚å½¼ãŒæ··å¤©ç¶¾ã‚’æ°´ä¸­ã§æŒ¯ã‚‹ã¨ã€ãã®ç¥é€šåŠ›ã«ã‚ˆã‚Šæµ·å…¨ä½“ãŒæ¿€ã—ãæºã‚Œã€é¾å®®ã¾ã§éœ‡å‹•ãŒä¼ã‚ã‚Šã¾ã—ãŸã€‚",
                duration: 5000,
                frames: []
            },
            {
                title: "é¾å®®ã®æ€’ã‚Š - é¾ç‹ã®ä¸‰å¤ªå­ãƒ»æ•–ä¸™ç™»å ´",
                description: "æµ·ã®æºã‚Œã«æ€’ã£ãŸæ±æµ·é¾ç‹ã¯ã€ä¸‰å¤ªå­ã®æ•–ä¸™ã‚’æ´¾é£ã—ã¦åŸå› ã‚’èª¿æŸ»ã•ã›ã¾ã—ãŸã€‚æ•–ä¸™ã¯æ°´é¢ã«ç¾ã‚Œã€å“ªå’ã‚’è¦‹ã¤ã‘ã¦æ¿€ã—ãå±è²¬ã—ã¾ã—ãŸã€‚",
                duration: 5000,
                frames: []
            },
            {
                title: "æˆ¦é—˜ - å“ªå’ã¨æ•–ä¸™ã®å¯¾æ±º",
                description: "è‹¥ã„å“ªå’ã¯æ•–ä¸™ã®å‚²æ…¢ãªæ…‹åº¦ã«è…¹ã‚’ç«‹ã¦ã€äºŒäººã®é–“ã§æ¿€ã—ã„æˆ¦ã„ãŒå§‹ã¾ã‚Šã¾ã—ãŸã€‚å“ªå’ã¯ä¹¾å¤åœã¨æ··å¤©ç¶¾ã‚’ä½¿ã„ã€æ•–ä¸™ã¯é¾ã®å§¿ã«å¤‰èº«ã—ã¦æˆ¦ã„ã¾ã—ãŸã€‚",
                duration: 6000,
                frames: []
            },
            {
                title: "é¾ç­‹ã‚’æŠœã - æ•–ä¸™ã®æœ€æœŸ",
                description: "æˆ¦ã„ã®æœ«ã€å“ªå’ã¯æ•–ä¸™ã‚’æ‰“ã¡å€’ã—ã€ãã®é¾ç­‹ã‚’æŠœãå–ã‚Šã¾ã—ãŸã€‚ã“ã‚ŒãŒå¾Œã®å¤§ããªé¨’å‹•ã®å§‹ã¾ã‚Šã¨ãªã‚Šã€å“ªå’ã®é‹å‘½ã‚’å¤§ããå¤‰ãˆã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚",
                duration: 5000,
                frames: []
            }
        ];

        // Stickman ã‚¯ãƒ©ã‚¹
        class Stickman {
            constructor(x, y, color = '#000') {
                this.x = x;
                this.y = y;
                this.color = color;
                this.scale = 1;
                this.rotation = 0;
                this.limbAngles = {
                    leftArm: 0,
                    rightArm: 0,
                    leftLeg: 0,
                    rightLeg: 0
                };
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.scale(this.scale, this.scale);
                
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';

                // é ­
                ctx.beginPath();
                ctx.arc(0, -30, 15, 0, Math.PI * 2);
                ctx.stroke();

                // ä½“
                ctx.beginPath();
                ctx.moveTo(0, -15);
                ctx.lineTo(0, 20);
                ctx.stroke();

                // å·¦è…•
                ctx.save();
                ctx.translate(0, -5);
                ctx.rotate(this.limbAngles.leftArm);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-20, 15);
                ctx.stroke();
                ctx.restore();

                // å³è…•
                ctx.save();
                ctx.translate(0, -5);
                ctx.rotate(this.limbAngles.rightArm);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(20, 15);
                ctx.stroke();
                ctx.restore();

                // å·¦è„š
                ctx.save();
                ctx.translate(0, 20);
                ctx.rotate(this.limbAngles.leftLeg);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-15, 25);
                ctx.stroke();
                ctx.restore();

                // å³è„š
                ctx.save();
                ctx.translate(0, 20);
                ctx.rotate(this.limbAngles.rightLeg);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(15, 25);
                ctx.stroke();
                ctx.restore();

                ctx.restore();
            }

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰
            walk(frame) {
                const cycle = frame * 0.1;
                this.limbAngles.leftArm = Math.sin(cycle) * 0.5;
                this.limbAngles.rightArm = -Math.sin(cycle) * 0.5;
                this.limbAngles.leftLeg = -Math.sin(cycle) * 0.3;
                this.limbAngles.rightLeg = Math.sin(cycle) * 0.3;
            }

            fight(frame) {
                const cycle = frame * 0.15;
                this.limbAngles.leftArm = -Math.PI/4 + Math.sin(cycle) * 0.3;
                this.limbAngles.rightArm = Math.PI/3 + Math.cos(cycle) * 0.4;
                this.limbAngles.leftLeg = -0.2;
                this.limbAngles.rightLeg = 0.2;
            }

            idle() {
                this.limbAngles.leftArm = 0.2;
                this.limbAngles.rightArm = -0.2;
                this.limbAngles.leftLeg = 0;
                this.limbAngles.rightLeg = 0;
            }
        }

        // èƒŒæ™¯æç”»
        function drawBackground(sceneType) {
            // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            
            switch(sceneType) {
                case 'birth':
                    gradient.addColorStop(0, '#FFE4E1');
                    gradient.addColorStop(1, '#FFC0CB');
                    break;
                case 'ocean':
                    gradient.addColorStop(0, '#87CEEB');
                    gradient.addColorStop(1, '#4682B4');
                    break;
                case 'battle':
                    gradient.addColorStop(0, '#FF6B6B');
                    gradient.addColorStop(1, '#8B0000');
                    break;
                default:
                    gradient.addColorStop(0, '#E6F3FF');
                    gradient.addColorStop(1, '#B0D4FF');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // è“®ã®èŠ±ã‚’æç”»
        function drawLotus(x, y, size, bloom) {
            ctx.save();
            ctx.translate(x, y);
            
            // èŠ±ã³ã‚‰
            const petalCount = 8;
            for (let i = 0; i < petalCount; i++) {
                ctx.save();
                ctx.rotate((Math.PI * 2 / petalCount) * i);
                ctx.fillStyle = `rgba(255, 182, 193, ${0.7 * bloom})`;
                ctx.beginPath();
                ctx.ellipse(0, -size * 0.5 * bloom, size * 0.3, size * 0.6 * bloom, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                ctx.restore();
            }
            
            // ä¸­å¿ƒ
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(0, 0, size * 0.2, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
        }

        // æµ·ã®æ³¢ã‚’æç”»
        function drawWaves(frame) {
            ctx.strokeStyle = '#4682B4';
            ctx.lineWidth = 2;
            
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                const y = canvas.height - 50 - i * 20;
                for (let x = 0; x <= canvas.width; x += 10) {
                    const waveY = y + Math.sin((x + frame * 2) * 0.02) * 10;
                    if (x === 0) {
                        ctx.moveTo(x, waveY);
                    } else {
                        ctx.lineTo(x, waveY);
                    }
                }
                ctx.stroke();
            }
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
        function drawTextOverlay(text, x, y) {
            if (!document.getElementById('showNarration').checked) return;
            
            ctx.save();
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(x - 150, y - 30, 300, 60);
            
            ctx.fillStyle = 'white';
            ctx.font = '16px Noto Sans JP';
            ctx.textAlign = 'center';
            ctx.fillText(text, x, y);
            ctx.restore();
        }

        // ã‚·ãƒ¼ãƒ³1: å“ªå’èª•ç”Ÿ
        function animateScene1(progress) {
            drawBackground('birth');
            
            const lotusX = canvas.width / 2;
            const lotusY = canvas.height / 2;
            const bloom = Math.min(progress / 50, 1);
            
            drawLotus(lotusX, lotusY, 100, bloom);
            
            if (progress > 50) {
                const nezha = new Stickman(lotusX, lotusY);
                nezha.scale = 0.5 + (progress - 50) / 100;
                nezha.color = '#FFD700';
                nezha.idle();
                nezha.draw(ctx);
            }
            
            if (progress > 30 && progress < 70) {
                drawTextOverlay("è“®ã®èŠ±ã‹ã‚‰ç¥ç«¥ãŒèª•ç”Ÿ", canvas.width / 2, canvas.height - 50);
            }
        }

        // ã‚·ãƒ¼ãƒ³2: æµ·ã§éŠã¶
        function animateScene2(progress) {
            drawBackground('ocean');
            drawWaves(animationFrame);
            
            const nezha = new Stickman(canvas.width / 3, canvas.height / 2);
            nezha.color = '#FFD700';
            nezha.walk(animationFrame);
            nezha.x += progress * 2;
            nezha.draw(ctx);
            
            // æ··å¤©ç¶¾ã‚’æç”»
            if (progress > 30) {
                ctx.strokeStyle = '#FF69B4';
                ctx.lineWidth = 5;
                ctx.beginPath();
                const ribbonX = nezha.x + 20;
                const ribbonY = nezha.y - 10;
                ctx.moveTo(ribbonX, ribbonY);
                for (let i = 0; i < 100; i++) {
                    const x = ribbonX + i;
                    const y = ribbonY + Math.sin((i + animationFrame) * 0.1) * 20;
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            }
            
            if (progress > 40 && progress < 80) {
                drawTextOverlay("æ··å¤©ç¶¾ãŒæµ·ã‚’æºã‚‰ã™", canvas.width / 2, 50);
            }
        }

        // ã‚·ãƒ¼ãƒ³3: é¾ç‹ç™»å ´
        function animateScene3(progress) {
            drawBackground('ocean');
            drawWaves(animationFrame);
            
            const nezha = new Stickman(canvas.width / 3, canvas.height / 2);
            nezha.color = '#FFD700';
            nezha.idle();
            nezha.draw(ctx);
            
            if (progress > 30) {
                const aobing = new Stickman(canvas.width * 2 / 3, canvas.height / 2);
                aobing.color = '#4169E1';
                aobing.scale = 1.2;
                aobing.idle();
                aobing.draw(ctx);
                
                // é¾ã®è§’ã‚’è¿½åŠ 
                ctx.strokeStyle = '#4169E1';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(aobing.x - 5, aobing.y - 45);
                ctx.lineTo(aobing.x - 10, aobing.y - 55);
                ctx.moveTo(aobing.x + 5, aobing.y - 45);
                ctx.lineTo(aobing.x + 10, aobing.y - 55);
                ctx.stroke();
            }
            
            if (progress > 40 && progress < 80) {
                drawTextOverlay("é¾ç‹ã®ä¸‰å¤ªå­ãƒ»æ•–ä¸™ãŒç¾ã‚Œã‚‹", canvas.width / 2, 50);
            }
        }

        // ã‚·ãƒ¼ãƒ³4: æˆ¦é—˜
        function animateScene4(progress) {
            drawBackground('battle');
            
            const nezha = new Stickman(canvas.width / 3, canvas.height / 2);
            nezha.color = '#FFD700';
            nezha.fight(animationFrame);
            nezha.draw(ctx);
            
            const aobing = new Stickman(canvas.width * 2 / 3, canvas.height / 2);
            aobing.color = '#4169E1';
            aobing.scale = 1.2;
            aobing.fight(animationFrame + 10);
            aobing.draw(ctx);
            
            // æˆ¦é—˜ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            if (document.getElementById('showEffects').checked) {
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 2;
                for (let i = 0; i < 5; i++) {
                    ctx.beginPath();
                    const angle = (animationFrame * 0.1 + i * Math.PI / 2.5);
                    const x = canvas.width / 2 + Math.cos(angle) * 50;
                    const y = canvas.height / 2 + Math.sin(angle) * 50;
                    ctx.arc(x, y, 10, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
            
            if (progress > 30 && progress < 70) {
                drawTextOverlay("æ¿€ã—ã„æˆ¦ã„ãŒå§‹ã¾ã‚‹", canvas.width / 2, canvas.height - 50);
            }
        }

        // ã‚·ãƒ¼ãƒ³5: çµæœ«
        function animateScene5(progress) {
            drawBackground('battle');
            
            const nezha = new Stickman(canvas.width / 2 - 50, canvas.height / 2);
            nezha.color = '#FFD700';
            nezha.idle();
            nezha.draw(ctx);
            
            if (progress < 50) {
                const aobing = new Stickman(canvas.width / 2 + 50, canvas.height / 2 + 30);
                aobing.color = '#4169E1';
                aobing.scale = 1.2;
                aobing.rotation = Math.PI / 4;
                aobing.draw(ctx);
            }
            
            if (progress > 60) {
                // é¾ç­‹ã‚’æç”»
                ctx.strokeStyle = '#4169E1';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(nezha.x + 20, nezha.y);
                ctx.lineTo(nezha.x + 80, nezha.y - 20);
                ctx.stroke();
            }
            
            if (progress > 40 && progress < 80) {
                drawTextOverlay("å“ªå’ãŒå‹åˆ©ã‚’åã‚ã‚‹", canvas.width / 2, 50);
            }
        }

        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const currentSceneData = scenes[currentScene];
            const progress = (animationProgress / currentSceneData.duration) * 100;
            
            // ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³ã‚’æç”»
            switch(currentScene) {
                case 0:
                    animateScene1(progress);
                    break;
                case 1:
                    animateScene2(progress);
                    break;
                case 2:
                    animateScene3(progress);
                    break;
                case 3:
                    animateScene4(progress);
                    break;
                case 4:
                    animateScene5(progress);
                    break;
            }
            
            if (isPlaying) {
                animationProgress += 16 * animationSpeed; // ç´„60fps
                animationFrame++;
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ›´æ–°
                updateProgressBar(progress);
                
                // ã‚·ãƒ¼ãƒ³çµ‚äº†ãƒã‚§ãƒƒã‚¯
                if (animationProgress >= currentSceneData.duration) {
                    if (document.getElementById('autoPlay').checked && currentScene < scenes.length - 1) {
                        selectScene(currentScene + 1);
                    } else {
                        pauseAnimation();
                    }
                }
                
                requestAnimationFrame(animate);
            }
        }

        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«é–¢æ•°
        function togglePlay() {
            if (isPlaying) {
                pauseAnimation();
            } else {
                isPlaying = true;
                document.getElementById('playBtn').classList.add('active');
                animate();
            }
        }

        function pauseAnimation() {
            isPlaying = false;
            document.getElementById('playBtn').classList.remove('active');
        }

        function resetAnimation() {
            animationProgress = 0;
            animationFrame = 0;
            pauseAnimation();
            animate();
            updateProgressBar(0);
        }

        function selectScene(sceneIndex) {
            currentScene = sceneIndex;
            animationProgress = 0;
            animationFrame = 0;
            
            // UIæ›´æ–°
            document.getElementById('sceneTitle').textContent = scenes[sceneIndex].title;
            document.getElementById('sceneDescription').textContent = scenes[sceneIndex].description;
            
            // ã‚·ãƒ¼ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.scene-item').forEach((item, index) => {
                item.classList.toggle('active', index === sceneIndex);
            });
            
            // ã‚·ãƒ¼ãƒ³ç•ªå·æ›´æ–°
            document.querySelector('.scene-number').textContent = `ç¬¬${sceneIndex + 1}å¹•`;
            
            animate();
        }

        function updateSpeed(value) {
            animationSpeed = parseFloat(value);
            document.getElementById('speedValue').textContent = value + 'x';
        }

        function updateProgressBar(progress) {
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = Math.round(progress) + '%';
        }

        function seekAnimation(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = (x / rect.width) * 100;
            
            animationProgress = (percentage / 100) * scenes[currentScene].duration;
            animationFrame = Math.floor(animationProgress / 16);
            updateProgressBar(percentage);
            animate();
        }

        // åˆæœŸåŒ–
        animate();
    </script>
</body>
</html>