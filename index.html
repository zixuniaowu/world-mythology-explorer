<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Mythology Explorer - Interactive Map</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: #fff;
        }

        /* Header Styles */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 40px;
            background: rgba(15, 12, 41, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
        }

        .nav-controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding: 10px 40px 10px 15px;
            border-radius: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            width: 250px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.15);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
        }


        /* Main Container */
        .main-container {
            margin-top: 100px;
            padding: 40px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.2em;
        }

        /* Map Container */
        .map-container {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .map-wrapper {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        #worldMapCanvas {
            width: 100%;
            height: auto;
            cursor: crosshair;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(102, 126, 234, 0.3), 
                        inset 0 0 30px rgba(102, 126, 234, 0.1);
        }

        /* Mythology Markers */
        .mythology-marker {
            position: absolute;
            width: 30px;
            height: 30px;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .mythology-marker:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }

        .marker-inner {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .marker-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, transparent 70%);
            animation: pulse 2s infinite;
            filter: blur(2px);
        }

        .marker-pin {
            position: absolute;
            width: 20px;
            height: 20px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, #fff 30%, transparent 70%);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.6);
        }

        .mythology-marker.active .marker-pin {
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 0 30px rgba(255, 255, 255, 1);
        }

        .marker-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 1;
            transition: all 0.3s ease;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .marker-label::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid rgba(0, 0, 0, 0.9);
        }

        .mythology-marker:hover .marker-label {
            transform: translateX(-50%) translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Connection Lines */
        .connection-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform-origin: left center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .connection-line.show {
            opacity: 1;
            animation: flow 3s linear infinite;
        }

        @keyframes flow {
            0% {
                background-position: -100% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        /* Enhanced marker animations */
        .mythology-marker {
            animation: float-marker 3s ease-in-out infinite;
            animation-delay: calc(var(--marker-index) * 0.2s);
        }

        @keyframes float-marker {
            0%, 100% {
                transform: translate(-50%, -50%) translateY(0);
            }
            50% {
                transform: translate(-50%, -50%) translateY(-5px);
            }
        }


        /* Map overlay effect */
        .map-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(15, 12, 41, 0.2) 100%);
            pointer-events: none;
            z-index: 5;
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: float 20s infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }

        /* Legend / Filter Controls */
        .legend {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            user-select: none;
            position: relative;
        }

        /* Tooltip for legend items */
        .legend-item::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            margin-bottom: 5px;
            z-index: 1000;
        }

        .legend-item:hover::after {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        .legend-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .legend-item.active {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .filter-controls {
            margin-top: 20px;
            text-align: center;
        }

        /* Filter instructions */
        .filter-instructions {
            text-align: center;
            margin: 15px 0;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
        }

        .filter-instructions i {
            color: #667eea;
            margin-right: 5px;
        }

        .filter-btn {
            padding: 8px 20px;
            margin: 0 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #667eea;
        }

        /* About Section */
        .about-section {
            margin-top: 60px;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .about-section h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #fff;
        }

        .about-content {
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }

        .links-section {
            margin-top: 40px;
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .link-btn {
            padding: 12px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .link-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #667eea;
            transform: translateY(-2px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .nav-controls {
                flex-direction: column;
                gap: 10px;
            }

            .search-input {
                width: 200px;
            }

            .main-container {
                padding: 20px;
                margin-top: 120px;
            }

            .page-title h1 {
                font-size: 2em;
            }

            .mythology-marker {
                width: 25px;
                height: 25px;
            }

            .marker-pin {
                width: 15px;
                height: 15px;
            }

            .marker-label {
                font-size: 9px;
                padding: 3px 6px;
                bottom: -18px;
            }

            /* å¢åŠ æ‰‹æ©Ÿç«¯é»æ“Šå€åŸŸ */
            .mythology-marker::before {
                content: '';
                position: absolute;
                width: 45px;
                height: 45px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: transparent;
                z-index: -1;
            }

            .links-section {
                flex-direction: column;
                align-items: center;
            }
            
            /* æ‰‹æ©Ÿç«¯éæ¿¾å™¨å„ªåŒ– */
            .legend {
                gap: 8px;
            }
            
            .legend-item {
                padding: 8px 15px;
                font-size: 12px;
            }
            
            .legend-color {
                width: 16px;
                height: 16px;
            }
            
            .filter-controls {
                margin-top: 15px;
            }
            
            .filter-btn {
                padding: 6px 15px;
                font-size: 12px;
                margin: 0 3px;
            }
        }

        /* Loading Animation */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #667eea;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .tooltip.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <header class="header">
        <div class="logo" onclick="location.reload()">World Mythology Explorer</div>
        <div class="nav-controls">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="ç¥è©±ã‚’æ¤œç´¢...">
                <span class="search-icon">ğŸ”</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <div class="page-title">
            <h1 id="mainTitle">ä¸–ç•Œç¥è©±ã®æ—…</h1>
            <p class="page-subtitle" id="subtitle">åœ°åŸŸã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç¥è©±ã®å®ç‰©ã‚’æ¢ç´¢</p>
        </div>

        <!-- Map Container -->
        <div class="map-container">
            <div class="map-wrapper">
                <canvas id="worldMapCanvas"></canvas>
                <div id="mythologyMarkers"></div>
                <div id="connectionLines"></div>
            </div>


            <!-- Tooltip -->
            <div class="tooltip" id="tooltip"></div>
        </div>

        <!-- Filter Instructions -->
        <div class="filter-instructions">
            <i>ğŸ¯</i> <span>åœ°åŸŸã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãã®åœ°åŸŸã®ç¥è©±ã®ã¿ã‚’è¡¨ç¤ºã§ãã¾ã™</span>
        </div>

        <!-- Legend -->
        <div class="legend" id="legendFilter">
            <div class="legend-item" data-region="east-asia" data-tooltip="ä¸­å›½ã¨æ—¥æœ¬ã®ç¥è©±ã‚’è¡¨ç¤º" onclick="toggleFilter('east-asia')">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span class="legend-text">æ±ã‚¢ã‚¸ã‚¢ç¥è©±</span>
            </div>
            <div class="legend-item" data-region="south-asia" data-tooltip="ã‚¤ãƒ³ãƒ‰ã®ç¥è©±ã‚’è¡¨ç¤º" onclick="toggleFilter('south-asia')">
                <div class="legend-color" style="background: #4ecdc4;"></div>
                <span class="legend-text">å—ã‚¢ã‚¸ã‚¢ç¥è©±</span>
            </div>
            <div class="legend-item" data-region="middle-east" data-tooltip="ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢ã®ç¥è©±ã‚’è¡¨ç¤º" onclick="toggleFilter('middle-east')">
                <div class="legend-color" style="background: #f7b731;"></div>
                <span class="legend-text">ä¸­æ±ç¥è©±</span>
            </div>
            <div class="legend-item" data-region="europe" data-tooltip="ã‚®ãƒªã‚·ãƒ£ã€åŒ—æ¬§ã€ã‚±ãƒ«ãƒˆã®ç¥è©±ã‚’è¡¨ç¤º" onclick="toggleFilter('europe')">
                <div class="legend-color" style="background: #5f27cd;"></div>
                <span class="legend-text">ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ç¥è©±</span>
            </div>
            <div class="legend-item" data-region="africa" data-tooltip="ã‚¨ã‚¸ãƒ—ãƒˆã¨è¥¿ã‚¢ãƒ•ãƒªã‚«ã®ç¥è©±ã‚’è¡¨ç¤º" onclick="toggleFilter('africa')">
                <div class="legend-color" style="background: #ee5a6f;"></div>
                <span class="legend-text">ã‚¢ãƒ•ãƒªã‚«ç¥è©±</span>
            </div>
            <div class="legend-item" data-region="americas" data-tooltip="ã‚¢ã‚¹ãƒ†ã‚«ãƒ»ãƒãƒ¤ã¨åŒ—ç±³å…ˆä½æ°‘ã®ç¥è©±ã‚’è¡¨ç¤º" onclick="toggleFilter('americas')">
                <div class="legend-color" style="background: #00d2d3;"></div>
                <span class="legend-text">ã‚¢ãƒ¡ãƒªã‚«ç¥è©±</span>
            </div>
            <div class="legend-item" data-region="oceania" data-tooltip="ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ã¨ãƒãƒªãƒã‚·ã‚¢ã®ç¥è©±ã‚’è¡¨ç¤º" onclick="toggleFilter('oceania')">
                <div class="legend-color" style="background: #22a6b3;"></div>
                <span class="legend-text">ã‚ªã‚»ã‚¢ãƒ‹ã‚¢ç¥è©±</span>
            </div>
        </div>
        
        <!-- Filter Controls -->
        <div class="filter-controls">
            <button class="filter-btn" onclick="showAllRegions()" title="ã™ã¹ã¦ã®åœ°åŸŸã®ç¥è©±ã‚’è¡¨ç¤ºã—ã¾ã™">ğŸŒ ã™ã¹ã¦è¡¨ç¤º</button>
            <button class="filter-btn" onclick="clearFilters()" title="é¸æŠã—ãŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’è§£é™¤ã—ã¾ã™">âœ– ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢</button>
        </div>

        <!-- About Section -->
        <div class="about-section">
            <h2>ä¸–ç•Œç¥è©±ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã«ã¤ã„ã¦</h2>
            <div class="about-content">
                <p>äººé–“ã®æƒ³åƒåŠ›ã®è±Šã‹ãªã‚¿ãƒšã‚¹ãƒˆãƒªãƒ¼ã‚’æ—…ã—ã¾ã—ã‚‡ã†ã€‚ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢ã®å¤ä»£ã®ç‰©èªã‹ã‚‰å¤ªå¹³æ´‹è«¸å³¶ã®é®®ã‚„ã‹ãªç‰©èªã¾ã§ã€ã•ã¾ã–ã¾ãªæ–‡åŒ–ãŒç¥è©±ã‚’é€šã˜ã¦å­˜åœ¨ã®ç¥ç§˜ã‚’ã©ã®ã‚ˆã†ã«èª¬æ˜ã—ã¦ããŸã‹ã‚’æ¢ã‚Šã¾ã™ã€‚</p>
                <p>å„ç¥è©±ã¯å˜ãªã‚‹ç‰©èªã§ã¯ãªãã€æ–‡æ˜ã®é­‚ã‚’è¡¨ã—ã¦ã„ã¾ã™ - å½¼ã‚‰ã®ä¾¡å€¤è¦³ã€æã‚Œã€å¸Œæœ›ã€ãã—ã¦å®‡å®™ã¸ã®ç†è§£ã€‚ä»»æ„ã®åœ°åŸŸã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãã®ç¥è©±ã®éºç”£ã‚’ç™ºè¦‹ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
            <div class="links-section">
                <a href="ai-text-to-animation.html" class="link-btn">AIã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«</a>
                <a href="text-to-animation.html" class="link-btn">ã‚·ãƒ³ãƒ—ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</a>
                <a href="#" class="link-btn">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ•ã‚©ãƒ¼ãƒ©ãƒ </a>
            </div>
        </div>
    </div>

    <!-- Canvas Performance Optimization -->
    <script src="canvas-performance-optimizations.js"></script>
    <script>
        // Language fixed to Japanese
        const currentLanguage = 'ja';
        
        // Language data for UI elements
        const translations = {
            ja: {
                title: "ä¸–ç•Œç¥è©±ã®æ—…",
                subtitle: "åœ°åŸŸã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç¥è©±ã®å®ç‰©ã‚’æ¢ç´¢",
                search: "ç¥è©±ã‚’æ¤œç´¢...",
                categories: {
                    'east-asia': "æ±ã‚¢ã‚¸ã‚¢ç¥è©±",
                    'south-asia': "å—ã‚¢ã‚¸ã‚¢ç¥è©±",
                    'europe': "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ç¥è©±",
                    'middle-east': "ä¸­æ±ç¥è©±",
                    'africa': "ã‚¢ãƒ•ãƒªã‚«ç¥è©±",
                    'americas': "ã‚¢ãƒ¡ãƒªã‚«ç¥è©±",
                    'oceania': "ã‚ªã‚»ã‚¢ãƒ‹ã‚¢ç¥è©±"
                },
                aboutTitle: "ä¸–ç•Œç¥è©±ã«ã¤ã„ã¦",
                aboutText1: "äººé–“ã®æƒ³åƒåŠ›ã®è±Šã‹ãªã‚¿ãƒšã‚¹ãƒˆãƒªãƒ¼ã‚’æ—…ã—ã¾ã—ã‚‡ã†ã€‚ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢ã®å¤ä»£ã®ç‰©èªã‹ã‚‰å¤ªå¹³æ´‹è«¸å³¶ã®é®®ã‚„ã‹ãªç‰©èªã¾ã§ã€ã•ã¾ã–ã¾ãªæ–‡åŒ–ãŒç¥è©±ã‚’é€šã˜ã¦å­˜åœ¨ã®ç¥ç§˜ã‚’ã©ã®ã‚ˆã†ã«èª¬æ˜ã—ã¦ããŸã‹ã‚’æ¢ã‚Šã¾ã™ã€‚",
                aboutText2: "å„ç¥è©±ã¯å˜ãªã‚‹ç‰©èªã§ã¯ãªãã€æ–‡æ˜ã®é­‚ã‚’è¡¨ã—ã¦ã„ã¾ã™ - å½¼ã‚‰ã®ä¾¡å€¤è¦³ã€æã‚Œã€å¸Œæœ›ã€ãã—ã¦å®‡å®™ã¸ã®ç†è§£ã€‚ä»»æ„ã®åœ°åŸŸã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãã®ç¥è©±ã®éºç”£ã‚’ç™ºè¦‹ã—ã¦ãã ã•ã„ã€‚",
                links: {
                    aiAnimation: "AIã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«",
                    simpleAnimation: "ã‚·ãƒ³ãƒ—ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",
                    community: "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ•ã‚©ãƒ¼ãƒ©ãƒ "
                }
            },
            zh: {
                title: "ä¸–ç•Œç¥è¯ä¹‹æ—…",
                subtitle: "ç‚¹å‡»åœ°åŒºæ¢ç´¢ç¥è¯å®è—",
                search: "æœç´¢ç¥è¯...",
                categories: {
                    'east-asia': "ä¸œäºšç¥è¯",
                    'south-asia': "å—äºšç¥è¯",
                    'europe': "æ¬§æ´²ç¥è¯",
                    'middle-east': "ä¸­ä¸œç¥è¯",
                    'africa': "éæ´²ç¥è¯",
                    'americas': "ç¾æ´²ç¥è¯",
                    'oceania': "å¤§æ´‹æ´²ç¥è¯"
                },
                aboutTitle: "å…³äºä¸–ç•Œç¥è¯",
                aboutText1: "è¸ä¸Šäººç±»æƒ³è±¡åŠ›ä¸°å¯Œçš„æ—…ç¨‹ã€‚ä»ç¾ç´¢ä¸è¾¾ç±³äºšçš„å¤ä»£æ•…äº‹åˆ°å¤ªå¹³æ´‹å²›å±¿çš„ç”ŸåŠ¨ä¼ è¯´ï¼Œæ¢ç´¢ä¸åŒæ–‡åŒ–å¦‚ä½•é€šè¿‡ç¥è¯æ¥è§£é‡Šå­˜åœ¨çš„å¥¥ç§˜ã€‚",
                aboutText2: "æ¯ä¸ªç¥è¯ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•…äº‹ï¼Œæ›´ä»£è¡¨ç€æ–‡æ˜çš„çµé­‚â€”â€”ä»–ä»¬çš„ä»·å€¼è§‚ã€ææƒ§ã€å¸Œæœ›ä»¥åŠå¯¹å®‡å®™çš„ç†è§£ã€‚ç‚¹å‡»ä»»æ„åœ°åŒºï¼Œå‘ç°å…¶ç¥è¯é—äº§ã€‚",
                links: {
                    aiAnimation: "AIåŠ¨ç”»å·¥å…·",
                    simpleAnimation: "ç®€å•åŠ¨ç”»",
                    community: "ç¤¾åŒºè®ºå›"
                }
            },
            en: {
                title: "Journey Through World Mythology",
                subtitle: "Click on regions to explore mythological treasures",
                search: "Search mythology...",
                categories: {
                    'east-asia': "East Asian Mythology",
                    'south-asia': "South Asian Mythology",
                    'europe': "European Mythology",
                    'middle-east': "Middle Eastern Mythology",
                    'africa': "African Mythology",
                    'americas': "American Mythology",
                    'oceania': "Oceanian Mythology"
                },
                aboutTitle: "About World Mythology",
                aboutText1: "Journey through the rich tapestry of human imagination. From the ancient tales of Mesopotamia to the vibrant stories of Pacific islands, explore how different cultures have explained the mysteries of existence through mythology.",
                aboutText2: "Each mythology is more than just stories - they represent the soul of civilizations, their values, fears, hopes, and understanding of the cosmos. Click on any region to discover its mythological heritage.",
                links: {
                    aiAnimation: "AI Animation Tool",
                    simpleAnimation: "Simple Animation",
                    community: "Community Forum"
                }
            }
        };
        
        
        // Update UI text based on current language
        function updateUILanguage() {
            const t = translations[currentLanguage];
            
            // Update page title and subtitle
            const pageTitle = document.querySelector('#mainTitle');
            const pageSubtitle = document.querySelector('#subtitle');
            if (pageTitle) pageTitle.textContent = t.title;
            if (pageSubtitle) pageSubtitle.textContent = t.subtitle;
            
            // Update search placeholder
            const searchInput = document.querySelector('#searchInput');
            if (searchInput) searchInput.placeholder = t.search;
            
            // Update legend items
            document.querySelectorAll('.legend-item').forEach(item => {
                const region = item.getAttribute('data-region');
                if (region && t.categories[region]) {
                    const textElement = item.querySelector('.legend-text');
                    if (textElement) textElement.textContent = t.categories[region];
                }
            });
            
            // Update about section
            const aboutTitle = document.querySelector('.about-section h2');
            const aboutTexts = document.querySelectorAll('.about-content p');
            if (aboutTitle) aboutTitle.textContent = t.aboutTitle;
            if (aboutTexts[0]) aboutTexts[0].textContent = t.aboutText1;
            if (aboutTexts[1]) aboutTexts[1].textContent = t.aboutText2;
            
            // Update links
            const linkBtns = document.querySelectorAll('.link-btn');
            if (linkBtns[0]) linkBtns[0].textContent = t.links.aiAnimation;
            if (linkBtns[1]) linkBtns[1].textContent = t.links.simpleAnimation;
            if (linkBtns[2]) linkBtns[2].textContent = t.links.community;
        }
        
        // Update legend text to Japanese
        function updateLegendLanguage() {
            document.querySelectorAll('.legend-text').forEach(element => {
                const text = element.getAttribute('data-ja') || element.getAttribute('data-en');
                element.textContent = text;
            });
        }
        
        // Mythology locations with real world coordinates (normalized 0-1)
        const mythologyLocations = {
            china: { 
                x: 0.78, y: 0.38, 
                name: { en: "China", ja: "ä¸­å›½", zh: "ä¸­å›½" }, 
                region: { en: "Shanhaijing", ja: "å±±æµ·çµŒ", zh: "å±±æµ·ç»" }
            },
            japan: { 
                x: 0.87, y: 0.36, 
                name: { en: "Japan", ja: "æ—¥æœ¬", zh: "æ—¥æœ¬" }, 
                region: { en: "Kojiki", ja: "å¤äº‹è¨˜", zh: "å¤äº‹è®°" }
            },
            india: { 
                x: 0.67, y: 0.48, 
                name: { en: "India", ja: "ã‚¤ãƒ³ãƒ‰", zh: "å°åº¦" }, 
                region: { en: "Mahabharata", ja: "ãƒãƒãƒ¼ãƒãƒ¼ãƒ©ã‚¿", zh: "æ‘©è¯ƒå©†ç½—å¤š" }
            },
            greece: { 
                x: 0.52, y: 0.38, 
                name: { en: "Greece", ja: "ã‚®ãƒªã‚·ãƒ£", zh: "å¸Œè…Š" }, 
                region: { en: "Olympus", ja: "ã‚ªãƒªãƒ³ãƒã‚¹", zh: "å¥¥æ—åŒ¹æ–¯" }
            },
            egypt: { 
                x: 0.53, y: 0.50, 
                name: { en: "Egypt", ja: "ã‚¨ã‚¸ãƒ—ãƒˆ", zh: "åŸƒåŠ" }, 
                region: { en: "Hieroglyphs", ja: "ãƒ’ã‚¨ãƒ­ã‚°ãƒªãƒ•", zh: "è±¡å½¢æ–‡å­—" }
            },
            norse: { 
                x: 0.50, y: 0.22, 
                name: { en: "Scandinavia", ja: "ã‚¹ã‚«ãƒ³ã‚¸ãƒŠãƒ“ã‚¢", zh: "æ–¯å ªçš„çº³ç»´äºš" }, 
                region: { en: "Valhalla", ja: "ãƒ´ã‚¡ãƒ«ãƒãƒ©", zh: "ç“¦å°”å“ˆæ‹‰" }
            },
            celtic: { 
                x: 0.46, y: 0.28, 
                name: { en: "Ireland", ja: "ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰", zh: "çˆ±å°”å…°" }, 
                region: { en: "TÃ­r na nÃ“g", ja: "ã‚±ãƒ«ãƒˆç¥è©±", zh: "é’æ˜¥ä¹‹åœ°" }
            },
            mesopotamia: { 
                x: 0.58, y: 0.42, 
                name: { en: "Mesopotamia", ja: "ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢", zh: "ç¾ç´¢ä¸è¾¾ç±³äºš" }, 
                region: { en: "Babylon", ja: "ãƒãƒ“ãƒ­ãƒ³", zh: "å·´æ¯”ä¼¦" }
            },
            aztecMaya: { 
                x: 0.22, y: 0.50, 
                name: { en: "Mexico", ja: "ãƒ¡ã‚­ã‚·ã‚³", zh: "å¢¨è¥¿å“¥" }, 
                region: { en: "Tenochtitlan", ja: "ãƒ†ãƒãƒãƒ†ã‚£ãƒˆãƒ©ãƒ³", zh: "ç‰¹è¯ºå¥‡æç‰¹å…°" }
            },
            nativeAmerican: { 
                x: 0.18, y: 0.38, 
                name: { en: "North America", ja: "åŒ—ã‚¢ãƒ¡ãƒªã‚«", zh: "åŒ—ç¾æ´²" }, 
                region: { en: "Great Spirit", ja: "ã‚°ãƒ¬ãƒ¼ãƒˆã‚¹ãƒ”ãƒªãƒƒãƒˆ", zh: "å¤§ç²¾çµ" }
            },
            westAfrica: { 
                x: 0.48, y: 0.58, 
                name: { en: "West Africa", ja: "è¥¿ã‚¢ãƒ•ãƒªã‚«", zh: "è¥¿é" }, 
                region: { en: "Yoruba", ja: "ãƒ¨ãƒ«ãƒ", zh: "çº¦é²å·´" }
            },
            aboriginal: { 
                x: 0.82, y: 0.72, 
                name: { en: "Australia", ja: "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢", zh: "æ¾³å¤§åˆ©äºš" }, 
                region: { en: "Dreamtime", ja: "ãƒ‰ãƒªãƒ¼ãƒ ã‚¿ã‚¤ãƒ ", zh: "æ¢¦å¢ƒæ—¶ä»£" }
            },
            polynesian: { 
                x: 0.90, y: 0.65, 
                name: { en: "Polynesia", ja: "ãƒãƒªãƒã‚·ã‚¢", zh: "æ³¢åˆ©å°¼è¥¿äºš" }, 
                region: { en: "Moana", ja: "ãƒ¢ã‚¢ãƒŠ", zh: "æµ·æ´‹" }
            }
        };

        // Mythology Data
        const mythologyData = {
            china: {
                title: "Chinese Mythology",
                titleZh: "ä¸­å›½ç¥è¯",
                titleJa: "ä¸­å›½ç¥è©±",
                origin: "Ancient China",
                originJa: "å¤ä»£ä¸­å›½",
                description: "A rich tapestry of legends including the Classic of Mountains and Seas (å±±æµ·ç»), Investiture of the Gods (å°ç¥æ¼”ä¹‰), and Strange Tales from a Chinese Studio (èŠæ–‹å¿—å¼‚).",
                descriptionJa: "å±±æµ·çµŒã€å°ç¥æ¼”ç¾©ã€èŠæ–å¿—ç•°ãªã©ã®è±Šã‹ãªä¼èª¬ã®ç¹”ç‰©ã€‚å¤ä»£ä¸­å›½ã®ç¥è©±ä½“ç³»ã¯ã€å¤©åœ°å‰µé€ ã‹ã‚‰ç¥ã€…ã¨å¦–æ€ªã®ç‰©èªã¾ã§å¹…åºƒãå±•é–‹ã—ã¦ã„ã¾ã™ã€‚",
                features: ["Dragons", "Immortals", "Journey to the West", "Jade Emperor", "Fox Spirits"],
                featuresJa: ["é¾", "ä»™äºº", "è¥¿éŠè¨˜", "ç‰çš‡å¤§å¸", "ç‹ç‹¸ç²¾"],
                color: "#ff6b6b"
            },
            japan: {
                title: "Japanese Mythology",
                titleZh: "æ—¥æœ¬ç¥è¯",
                titleJa: "æ—¥æœ¬ç¥è©±",
                origin: "Ancient Japan",
                originZh: "å¤ä»£æ—¥æœ¬",
                originJa: "å¤ä»£æ—¥æœ¬",
                description: "Ancient chronicles like Kojiki (å¤äº‹è¨˜) and Nihon Shoki (æ—¥æœ¬æ›¸ç´€), plus a rich tradition of yokai (å¦–æ€ª) folklore.",
                descriptionZh: "åŒ…æ‹¬å¤äº‹è®°ã€æ—¥æœ¬ä¹¦çºªç­‰å¤ä»£ç¼–å¹´å²ï¼Œä»¥åŠä¸°å¯Œçš„å¦–æ€ªæ°‘ä¿—ä¼ ç»Ÿã€‚",
                descriptionJa: "å¤äº‹è¨˜ã‚„æ—¥æœ¬æ›¸ç´€ãªã©ã®å¤ä»£ã®è¨˜éŒ²ã€ãã—ã¦è±Šã‹ãªå¦–æ€ªã®æ°‘ä¿—ä¼çµ±ã€‚",
                features: ["Kami", "Yokai", "Amaterasu", "Susanoo", "Kitsune"],
                featuresJa: ["ç¥", "å¦–æ€ª", "å¤©ç…§å¤§ç¥", "é ˆä½ä¹‹ç”·", "ç‹"],
                featuresZh: ["ç¥çµ", "å¦–æ€ª", "å¤©ç…§å¤§ç¥", "é¡»ä½ä¹‹ç”·", "ç‹ç‹¸"],
                color: "#ff9999"
            },
            india: {
                title: "Indian Mythology",
                titleZh: "å°åº¦ç¥è¯",
                titleJa: "ã‚¤ãƒ³ãƒ‰ç¥è©±",
                origin: "Ancient India",
                originZh: "å¤ä»£å°åº¦",
                originJa: "å¤ä»£ã‚¤ãƒ³ãƒ‰",
                description: "Epic tales from the Mahabharata, Ramayana, and ancient Vedic texts that form the foundation of Hindu philosophy.",
                descriptionZh: "æ¥è‡ªæ‘©è¯ƒå©†ç½—å¤šã€ç½—æ‘©è¡é‚£å’Œå¤ä»£å é™€ç»å…¸çš„å²è¯—æ•…äº‹ï¼Œæ„æˆäº†å°åº¦æ•™å“²å­¦çš„åŸºç¡€ã€‚",
                descriptionJa: "ãƒãƒãƒ¼ãƒãƒ¼ãƒ©ã‚¿ã€ãƒ©ãƒ¼ãƒãƒ¼ãƒ¤ãƒŠã€ãã—ã¦å¤ä»£ãƒ´ã‚§ãƒ¼ãƒ€ã®çµŒå…¸ã‹ã‚‰ã®å£®å¤§ãªç‰©èªã€‚ãƒ’ãƒ³ãƒ‰ã‚¥ãƒ¼å“²å­¦ã®åŸºç¤ã‚’å½¢æˆã™ã‚‹ç¥è©±ä½“ç³»ã§ã™ã€‚",
                features: ["Vishnu", "Shiva", "Krishna", "Rama", "Vedas"],
                featuresZh: ["æ¯—æ¹¿å¥´", "æ¹¿å©†", "å…‹é‡Œå¸Œçº³", "ç½—æ‘©", "å é™€ç»"],
                featuresJa: ["ãƒ´ã‚£ã‚·ãƒ¥ãƒŒ", "ã‚·ãƒ´ã‚¡", "ã‚¯ãƒªã‚·ãƒ¥ãƒŠ", "ãƒ©ãƒ¼ãƒ", "ãƒ´ã‚§ãƒ¼ãƒ€"],
                color: "#4ecdc4"
            },
            mesopotamia: {
                title: "Mesopotamian Mythology",
                titleZh: "ç¾ç´¢ä¸è¾¾ç±³äºšç¥è¯",
                titleJa: "ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢ç¥è©±",
                origin: "Ancient Mesopotamia",
                originZh: "å¤ä»£ç¾ç´¢ä¸è¾¾ç±³äºš",
                originJa: "å¤ä»£ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢",
                description: "The world's oldest recorded myths, including the Epic of Gilgamesh and tales from ancient Babylon and Sumeria.",
                descriptionZh: "ä¸–ç•Œä¸Šæœ€å¤è€çš„è®°å½•ç¥è¯ï¼ŒåŒ…æ‹¬å‰å°”ä¼½ç¾ä»€å²è¯—ä»¥åŠæ¥è‡ªå¤å·´æ¯”ä¼¦å’Œè‹ç¾å°”çš„ä¼ è¯´ã€‚",
                descriptionJa: "ã‚®ãƒ«ã‚¬ãƒ¡ã‚·ãƒ¥å™äº‹è©©ã‚’å«ã‚€ä¸–ç•Œæœ€å¤ã®è¨˜éŒ²ã•ã‚ŒãŸç¥è©±ã€‚å¤ä»£ãƒãƒ“ãƒ­ãƒ³ã¨ã‚·ãƒ¥ãƒ¡ãƒ¼ãƒ«ã®ç‰©èªãŒæ–‡æ˜ã®é»æ˜æœŸã‚’ç‰©èªã‚Šã¾ã™ã€‚",
                features: ["Gilgamesh", "Enkidu", "Tiamat", "Marduk", "Ishtar"],
                featuresZh: ["å‰å°”ä¼½ç¾ä»€", "æ©å¥‡éƒ½", "æäºšé©¬ç‰¹", "é©¬å°”æœå…‹", "ä¼Šä»€å¡”å°”"],
                featuresJa: ["ã‚®ãƒ«ã‚¬ãƒ¡ã‚·ãƒ¥", "ã‚¨ãƒ³ã‚­ãƒ‰ã‚¥", "ãƒ†ã‚£ã‚¢ãƒãƒˆ", "ãƒãƒ«ãƒ‰ã‚¥ã‚¯", "ã‚¤ã‚·ãƒ¥ã‚¿ãƒ«"],
                color: "#f7b731"
            },
            greece: {
                title: "Greek Mythology",
                titleZh: "å¸Œè…Šç¥è¯",
                titleJa: "ã‚®ãƒªã‚·ãƒ£ç¥è©±",
                origin: "Ancient Greece",
                originZh: "å¤å¸Œè…Š",
                originJa: "å¤ä»£ã‚®ãƒªã‚·ãƒ£",
                description: "The pantheon of Olympian gods and heroes whose stories have influenced Western culture for millennia.",
                descriptionZh: "å¥¥æ—åŒ¹æ–¯ä¼—ç¥å’Œè‹±é›„çš„ä¸‡ç¥æ®¿ï¼Œä»–ä»¬çš„æ•…äº‹åƒå¹´æ¥å½±å“ç€è¥¿æ–¹æ–‡åŒ–ã€‚",
                descriptionJa: "ã‚ªãƒªãƒ³ãƒã‚¹ã®ç¥ã€…ã¨è‹±é›„ãŸã¡ã®ç‰©èªã€‚è¥¿æ´‹æ–‡åŒ–ã«æ•°åƒå¹´ã«ã‚ãŸã£ã¦å½±éŸ¿ã‚’ä¸ãˆç¶šã‘ã¦ã„ã‚‹ç¥è©±ä½“ç³»ã§ã™ã€‚",
                features: ["Zeus", "Athena", "Odysseus", "Hercules", "Olympus"],
                featuresZh: ["å®™æ–¯", "é›…å…¸å¨œ", "å¥¥å¾·ä¿®æ–¯", "èµ«æ‹‰å…‹å‹’æ–¯", "å¥¥æ—åŒ¹æ–¯"],
                featuresJa: ["ã‚¼ã‚¦ã‚¹", "ã‚¢ãƒ†ãƒŠ", "ã‚ªãƒ‡ãƒ¥ãƒƒã‚»ã‚¦ã‚¹", "ãƒ˜ãƒ©ã‚¯ãƒ¬ã‚¹", "ã‚ªãƒªãƒ³ãƒã‚¹"],
                color: "#5f27cd"
            },
            norse: {
                title: "Norse Mythology",
                titleZh: "åŒ—æ¬§ç¥è¯",
                titleJa: "åŒ—æ¬§ç¥è©±",
                origin: "Ancient Scandinavia",
                originZh: "å¤ä»£æ–¯å ªçš„çº³ç»´äºš",
                originJa: "å¤ä»£ã‚¹ã‚«ãƒ³ã‚¸ãƒŠãƒ“ã‚¢",
                description: "Tales of gods, giants, and the cosmic tree Yggdrasil from the Viking Age, preserved in the Eddas.",
                descriptionZh: "ç»´äº¬æ—¶ä»£çš„è¯¸ç¥ã€å·¨äººå’Œä¸–ç•Œæ ‘ä¼Šæ ¼å¾·æ‹‰å¸Œå°”çš„æ•…äº‹ï¼Œä¿å­˜åœ¨åŸƒè¾¾ä¸­ã€‚",
                descriptionJa: "ã‚¨ãƒƒãƒ€ã«ä¿å­˜ã•ã‚ŒãŸãƒ´ã‚¡ã‚¤ã‚­ãƒ³ã‚°æ™‚ä»£ã®ç¥ã€…ã€å·¨äººã€ä¸–ç•Œæ¨¹ãƒ¦ã‚°ãƒ‰ãƒ©ã‚·ãƒ«ã®ç‰©èªã€‚åŒ—æ¬§ã®å³ã—ã„è‡ªç„¶ãŒç”Ÿã‚“ã å£®å¤§ãªç¥è©±ã§ã™ã€‚",
                features: ["Odin", "Thor", "Loki", "Ragnarok", "Valhalla"],
                featuresZh: ["å¥¥ä¸", "ç´¢å°”", "æ´›åŸº", "è¯¸ç¥é»„æ˜", "ç“¦å°”å“ˆæ‹‰"],
                featuresJa: ["ã‚ªãƒ¼ãƒ‡ã‚£ãƒ³", "ãƒˆãƒ¼ãƒ«", "ãƒ­ã‚­", "ãƒ©ã‚°ãƒŠãƒ­ã‚¯", "ãƒ´ã‚¡ãƒ«ãƒãƒ©"],
                color: "#7f39fb"
            },
            celtic: {
                title: "Celtic Mythology",
                titleZh: "å‡¯å°”ç‰¹ç¥è¯",
                titleJa: "ã‚±ãƒ«ãƒˆç¥è©±",
                origin: "Ancient Celtic Lands",
                originZh: "å¤ä»£å‡¯å°”ç‰¹åœ°åŒº",
                originJa: "å¤ä»£ã‚±ãƒ«ãƒˆåœ°åŸŸ",
                description: "Mystical tales from Ireland, Wales, and Scotland featuring otherworldly beings and heroic quests.",
                descriptionZh: "æ¥è‡ªçˆ±å°”å…°ã€å¨å°”å£«å’Œè‹æ ¼å…°çš„ç¥ç§˜æ•…äº‹ï¼Œæç»˜äº†å¼‚ä¸–ç•Œç”Ÿçµå’Œè‹±é›„æ¢é™©ã€‚",
                descriptionJa: "ã‚¢ã‚¤ãƒ«ãƒ©ãƒ³ãƒ‰ã€ã‚¦ã‚§ãƒ¼ãƒ«ã‚ºã€ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ã‹ã‚‰ä¼ã‚ã‚‹ç¥ç§˜çš„ãªç‰©èªã€‚ç•°ç•Œã®å­˜åœ¨ã¨è‹±é›„ã®å†’é™ºãŒç¹”ã‚Šãªã™å¹»æƒ³çš„ãªä¸–ç•Œã§ã™ã€‚",
                features: ["Tuatha DÃ© Danann", "CÃº Chulainn", "Morrigan", "Druids", "Sidhe"],
                featuresZh: ["è¾¾åŠªç¥æ—", "åº“ä¸˜æ—", "è«ç‘ç”˜", "å¾·é²ä¼Š", "ä»™çµ"],
                featuresJa: ["ãƒˆã‚¥ã‚¢ãƒãƒ»ãƒ‡ãƒ»ãƒ€ãƒŠãƒ¼ãƒ³", "ã‚¯ãƒ¼ãƒ»ãƒ•ãƒ¼ãƒªãƒ³", "ãƒ¢ãƒªã‚¬ãƒ³", "ãƒ‰ãƒ«ã‚¤ãƒ‰", "ã‚·ãƒ¼"],
                color: "#9c59d1"
            },
            egypt: {
                title: "Egyptian Mythology",
                titleZh: "åŸƒåŠç¥è¯",
                titleJa: "ã‚¨ã‚¸ãƒ—ãƒˆç¥è©±",
                origin: "Ancient Egypt",
                originZh: "å¤åŸƒåŠ",
                originJa: "å¤ä»£ã‚¨ã‚¸ãƒ—ãƒˆ",
                description: "Stories of gods who controlled the Nile, the afterlife, and the cosmic order, preserved in hieroglyphs and papyri.",
                descriptionZh: "æŒç®¡å°¼ç½—æ²³ã€æ¥ä¸–å’Œå®‡å®™ç§©åºçš„è¯¸ç¥æ•…äº‹ï¼Œä¿å­˜åœ¨è±¡å½¢æ–‡å­—å’Œçº¸èè‰çº¸ä¸­ã€‚",
                descriptionJa: "ãƒŠã‚¤ãƒ«å·ã€æ¥ä¸–ã€å®‡å®™ã®ç§©åºã‚’å¸ã‚‹ç¥ã€…ã®ç‰©èªã€‚ãƒ’ã‚¨ãƒ­ã‚°ãƒªãƒ•ã¨ãƒ‘ãƒ”ãƒ«ã‚¹ã«ä¿å­˜ã•ã‚ŒãŸæ°¸é ã®ç”Ÿå‘½ã¸ã®æ¢æ±‚ã§ã™ã€‚",
                features: ["Ra", "Osiris", "Isis", "Anubis", "Book of the Dead"],
                featuresZh: ["æ‹‰", "å¥¥è¥¿é‡Œæ–¯", "ä¼Šè¥¿æ–¯", "é˜¿åŠªæ¯”æ–¯", "æ­»è€…ä¹‹ä¹¦"],
                featuresJa: ["ãƒ©ãƒ¼", "ã‚ªã‚·ãƒªã‚¹", "ã‚¤ã‚·ã‚¹", "ã‚¢ãƒŒãƒ“ã‚¹", "æ­»è€…ã®æ›¸"],
                color: "#ee5a6f"
            },
            westAfrica: {
                title: "West African Mythology",
                titleZh: "è¥¿éç¥è¯",
                titleJa: "è¥¿ã‚¢ãƒ•ãƒªã‚«ç¥è©±",
                origin: "West Africa",
                originZh: "è¥¿é",
                originJa: "è¥¿ã‚¢ãƒ•ãƒªã‚«",
                description: "Oral traditions including the trickster Anansi and creation myths from various West African cultures.",
                descriptionZh: "åŒ…æ‹¬æ¶ä½œå‰§ä¹‹ç¥é˜¿å—è¥¿åœ¨å†…çš„å£è¿°ä¼ ç»Ÿï¼Œä»¥åŠæ¥è‡ªå„ç§è¥¿éæ–‡åŒ–çš„åˆ›ä¸–ç¥è¯ã€‚",
                descriptionJa: "ã‚¢ãƒŠãƒ³ã‚·ã‚’å«ã‚€å£æ‰¿ä¼çµ±ã€‚ãƒ¨ãƒ«ãƒæ—ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹æ§˜ã€…ãªè¥¿ã‚¢ãƒ•ãƒªã‚«æ–‡åŒ–ã®å‰µé€ ç¥è©±ãŒè±Šã‹ãªç²¾ç¥ä¸–ç•Œã‚’ç‰©èªã‚Šã¾ã™ã€‚",
                features: ["Anansi", "Yoruba Orishas", "Trickster Tales", "Creation Stories", "Ancestral Spirits"],
                featuresZh: ["é˜¿å—è¥¿", "çº¦é²å·´ç¥çµ", "æ¶ä½œå‰§æ•…äº‹", "åˆ›ä¸–æ•…äº‹", "ç¥–å…ˆä¹‹çµ"],
                featuresJa: ["ã‚¢ãƒŠãƒ³ã‚·", "ãƒ¨ãƒ«ãƒã®ã‚ªãƒªã‚·ãƒ£", "ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ç‰©èª", "å‰µä¸–ç¥è©±", "ç¥–å…ˆã®éœŠ"],
                color: "#ff7979"
            },
            aztecMaya: {
                title: "Aztec & Maya Mythology",
                titleZh: "é˜¿å…¹ç‰¹å…‹ä¸ç›é›…ç¥è¯",
                titleJa: "ã‚¢ã‚¹ãƒ†ã‚«ãƒ»ãƒãƒ¤ç¥è©±",
                origin: "Mesoamerica",
                originZh: "ä¸­ç¾æ´²",
                originJa: "ãƒ¡ã‚½ã‚¢ãƒ¡ãƒªã‚«",
                description: "Complex cosmologies from the Aztec and Maya civilizations, featuring feathered serpents and jaguar gods.",
                descriptionZh: "é˜¿å…¹ç‰¹å…‹å’Œç›é›…æ–‡æ˜çš„å¤æ‚å®‡å®™è§‚ï¼Œä»¥ç¾½è›‡ç¥å’Œç¾æ´²è±¹ç¥ä¸ºç‰¹è‰²ã€‚",
                descriptionJa: "ã‚¢ã‚¹ãƒ†ã‚«ã¨ãƒãƒ¤æ–‡æ˜ã®è¤‡é›‘ãªå®‡å®™è¦³ã€‚ç¾½æ¯›ã®è›‡ã‚„ã‚¸ãƒ£ã‚¬ãƒ¼ã®ç¥ã€…ãŒç¹”ã‚Šãªã™ã€å¤©æ–‡å­¦ã¨ç²¾ç¥ä¸–ç•ŒãŒèåˆã—ãŸç¥è©±ä½“ç³»ã§ã™ã€‚",
                features: ["Quetzalcoatl", "Kukulkan", "Popol Vuh", "Tezcatlipoca", "Xibalba"],
                featuresZh: ["ç¾½è›‡ç¥", "åº“åº“å°”å", "æ³¢æ³¢å°”ä¹Œ", "ç‰¹æ–¯å¡ç‰¹åˆ©æ³¢å¡", "è¥¿å·´å°”å·´"],
                featuresJa: ["ã‚±ãƒ„ã‚¡ãƒ«ã‚³ã‚¢ãƒˆãƒ«", "ã‚¯ã‚¯ãƒ«ã‚«ãƒ³", "ãƒãƒãƒ«ãƒ»ãƒ´ãƒ¼", "ãƒ†ã‚¹ã‚«ãƒˆãƒªãƒã‚«", "ã‚·ãƒãƒ«ãƒ"],
                color: "#00d2d3"
            },
            nativeAmerican: {
                title: "Native American Mythology",
                titleZh: "åŒ—ç¾åŸä½æ°‘ç¥è¯",
                titleJa: "ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ¡ãƒªã‚«ãƒ³ç¥è©±",
                origin: "North America",
                originZh: "åŒ—ç¾æ´²",
                originJa: "åŒ—ã‚¢ãƒ¡ãƒªã‚«",
                description: "Diverse traditions from hundreds of tribes, featuring creation stories, animal spirits, and sacred landscapes.",
                descriptionZh: "æ¥è‡ªæ•°ç™¾ä¸ªéƒ¨è½çš„å¤šæ ·ä¼ ç»Ÿï¼ŒåŒ…æ‹¬åˆ›ä¸–æ•…äº‹ã€åŠ¨ç‰©ç²¾çµå’Œç¥åœ£æ™¯è§‚ã€‚",
                descriptionJa: "æ•°ç™¾ã®éƒ¨æ—ã‹ã‚‰ä¼ã‚ã‚‹å¤šæ§˜ãªä¼çµ±ã€‚å‰µä¸–ç‰©èªã€å‹•ç‰©ã®éœŠã€è–ãªã‚‹å¤§åœ°ãŒç´¡ãã€è‡ªç„¶ã¨ã®æ·±ã„çµ†ã‚’è¡¨ã™ç¥è©±ã§ã™ã€‚",
                features: ["Coyote", "Thunderbird", "Great Spirit", "Vision Quests", "Sacred Animals"],
                featuresZh: ["éƒŠç‹¼", "é›·é¸Ÿ", "å¤§ç²¾çµ", "çµè§†æ¢ç´¢", "ç¥åœ£åŠ¨ç‰©"],
                featuresJa: ["ã‚³ãƒ¨ãƒ¼ãƒ†", "ã‚µãƒ³ãƒ€ãƒ¼ãƒãƒ¼ãƒ‰", "ã‚°ãƒ¬ãƒ¼ãƒˆãƒ»ã‚¹ãƒ”ãƒªãƒƒãƒˆ", "ãƒ“ã‚¸ãƒ§ãƒ³ãƒ»ã‚¯ã‚¨ã‚¹ãƒˆ", "è–ãªã‚‹å‹•ç‰©"],
                color: "#00b8d4"
            },
            aboriginal: {
                title: "Aboriginal Dreamtime",
                titleZh: "æ¾³æ´²åŸä½æ°‘æ¢¦æ—¶ä»£",
                titleJa: "ã‚¢ãƒœãƒªã‚¸ãƒ‹ãƒ»ãƒ‰ãƒªãƒ¼ãƒ ã‚¿ã‚¤ãƒ ",
                origin: "Australia",
                originZh: "æ¾³å¤§åˆ©äºš",
                originJa: "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢",
                description: "The Dreamtime stories that explain the creation of the land, animals, and people of Australia.",
                descriptionZh: "æ¢¦æ—¶ä»£æ•…äº‹è§£é‡Šäº†æ¾³å¤§åˆ©äºšåœŸåœ°ã€åŠ¨ç‰©å’Œäººæ°‘çš„åˆ›é€ ã€‚",
                descriptionJa: "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ã®å¤§åœ°ã€å‹•ç‰©ã€äººã€…ã®å‰µé€ ã‚’èª¬æ˜ã™ã‚‹ãƒ‰ãƒªãƒ¼ãƒ ã‚¿ã‚¤ãƒ ã®ç‰©èªã€‚æ™‚é–“ã¨ç©ºé–“ã‚’è¶…è¶Šã—ãŸç¥è–ãªã‚‹ä¸–ç•Œè¦³ã§ã™ã€‚",
                features: ["Rainbow Serpent", "Dreamtime", "Songlines", "Creation Ancestors", "Sacred Sites"],
                featuresZh: ["å½©è™¹è›‡", "æ¢¦å¢ƒæ—¶ä»£", "æ­Œä¹‹å¾„", "åˆ›ä¸–ç¥–å…ˆ", "åœ£åœ°"],
                featuresJa: ["è™¹è›‡", "ãƒ‰ãƒªãƒ¼ãƒ ã‚¿ã‚¤ãƒ ", "ã‚½ãƒ³ã‚°ãƒ©ã‚¤ãƒ³", "å‰µé€ ã®ç¥–å…ˆ", "è–åœ°"],
                color: "#22a6b3"
            },
            polynesian: {
                title: "Polynesian Mythology",
                titleZh: "æ³¢åˆ©å°¼è¥¿äºšç¥è¯",
                titleJa: "ãƒãƒªãƒã‚·ã‚¢ç¥è©±",
                origin: "Pacific Islands",
                originZh: "å¤ªå¹³æ´‹å²›å±¿",
                originJa: "å¤ªå¹³æ´‹è«¸å³¶",
                description: "Ocean-spanning myths from Hawaii, Tahiti, New Zealand, and other Pacific islands.",
                descriptionZh: "æ¥è‡ªå¤å¨å¤·ã€å¡”å¸Œæã€æ–°è¥¿å…°å’Œå…¶ä»–å¤ªå¹³æ´‹å²›å±¿çš„è·¨æµ·ç¥è¯ã€‚",
                descriptionJa: "ãƒãƒ¯ã‚¤ã€ã‚¿ãƒ’ãƒã€ãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰ãªã©å¤ªå¹³æ´‹è«¸å³¶ã®æµ·ã‚’è¶ŠãˆãŸç¥è©±ã€‚å¤§æµ·åŸã‚’èˆå°ã«ã—ãŸå£®å¤§ãªå†’é™ºã¨ç¥ã€…ã®ç‰©èªã§ã™ã€‚",
                features: ["Maui", "Pele", "Tangaroa", "Tiki", "Ocean Voyages"],
                featuresZh: ["æ¯›ä¼Š", "è´åˆ©", "å¦åŠ ç½—é˜¿", "æåŸº", "æµ·æ´‹èˆªè¡Œ"],
                featuresJa: ["ãƒã‚¦ã‚¤", "ãƒšãƒ¬", "ã‚¿ãƒ³ã‚¬ãƒ­ã‚¢", "ãƒ†ã‚£ã‚­", "æµ·æ´‹èˆªæµ·"],
                color: "#30e3ca"
            }
        };


        let currentLang = 'ja';
        let canvas, ctx;
        let mapImage;
        let canvasWidth, canvasHeight;
        let canvasOptimizer;
        let isMapDirty = true;

        // Initialize canvas and load map
        function initializeMap() {
            canvas = document.getElementById('worldMapCanvas');
            
            // Initialize canvas optimizer if available
            if (typeof WorldMapCanvasOptimizer !== 'undefined') {
                try {
                    canvasOptimizer = new WorldMapCanvasOptimizer(canvas, {
                        enableOffscreenCanvas: true,
                        enableImageSmoothing: true,
                        frameRate: 30
                    });
                    ctx = canvasOptimizer.ctx;
                } catch (error) {
                    console.warn('Canvas optimizer failed to initialize:', error);
                    ctx = canvas.getContext('2d');
                }
            } else {
                ctx = canvas.getContext('2d');
            }
            
            // Create world map image
            mapImage = new Image();
            mapImage.onload = function() {
                // Set canvas size
                const maxWidth = 1200;
                const aspectRatio = mapImage.height / mapImage.width;
                canvasWidth = Math.min(maxWidth, window.innerWidth - 80);
                canvasHeight = canvasWidth * aspectRatio;
                
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                
                // Draw map with overlay
                drawMap();
                
                // Create markers
                createMythologyMarkers();
                
                // Create connection lines
                createConnectionLines();
            };
            
            // Use a stylized world map image (we'll create a gradient-based one)
            createStylizedWorldMap();
        }

        // Create a stylized world map using canvas
        function createStylizedWorldMap() {
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 1200;
            tempCanvas.height = 600;
            const tempCtx = tempCanvas.getContext('2d');
            
            // Create gradient background with aurora effect
            const gradient = tempCtx.createLinearGradient(0, 0, 1200, 600);
            gradient.addColorStop(0, '#0f0c29');
            gradient.addColorStop(0.3, '#302b63');
            gradient.addColorStop(0.7, '#24243e');
            gradient.addColorStop(1, '#0f3460');
            tempCtx.fillStyle = gradient;
            tempCtx.fillRect(0, 0, 1200, 600);
            
            // Add aurora waves
            tempCtx.globalAlpha = 0.3;
            const auroraGradient = tempCtx.createLinearGradient(0, 0, 1200, 300);
            auroraGradient.addColorStop(0, 'transparent');
            auroraGradient.addColorStop(0.5, '#667eea');
            auroraGradient.addColorStop(1, 'transparent');
            tempCtx.fillStyle = auroraGradient;
            tempCtx.fillRect(0, 0, 1200, 300);
            tempCtx.globalAlpha = 1;
            
            // Draw simplified continents
            tempCtx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            tempCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            tempCtx.lineWidth = 2;
            
            // Draw continents (simplified shapes)
            drawContinents(tempCtx);
            
            // Set the map image
            mapImage.src = tempCanvas.toDataURL();
        }

        // Draw more detailed continent shapes
        function drawContinents(ctx) {
            // Set up drawing style
            ctx.fillStyle = 'rgba(255, 255, 255, 0.08)';
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.25)';
            ctx.lineWidth = 2;
            ctx.shadowBlur = 20;
            ctx.shadowColor = 'rgba(102, 126, 234, 0.5)';
            
            // North America
            ctx.beginPath();
            ctx.moveTo(150, 100);
            ctx.lineTo(200, 90);
            ctx.lineTo(250, 100);
            ctx.lineTo(300, 120);
            ctx.lineTo(350, 180);
            ctx.lineTo(380, 250);
            ctx.lineTo(350, 350);
            ctx.lineTo(300, 400);
            ctx.quadraticCurveTo(250, 420, 200, 400);
            ctx.lineTo(150, 350);
            ctx.lineTo(120, 280);
            ctx.lineTo(100, 200);
            ctx.lineTo(120, 150);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // South America
            ctx.beginPath();
            ctx.moveTo(280, 400);
            ctx.lineTo(320, 420);
            ctx.quadraticCurveTo(340, 460, 320, 520);
            ctx.lineTo(280, 580);
            ctx.lineTo(240, 560);
            ctx.lineTo(220, 500);
            ctx.lineTo(240, 440);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Africa
            ctx.beginPath();
            ctx.moveTo(580, 200);
            ctx.lineTo(620, 180);
            ctx.lineTo(660, 200);
            ctx.lineTo(680, 250);
            ctx.lineTo(700, 320);
            ctx.quadraticCurveTo(680, 400, 640, 480);
            ctx.lineTo(600, 520);
            ctx.lineTo(560, 500);
            ctx.lineTo(540, 440);
            ctx.lineTo(520, 380);
            ctx.lineTo(500, 320);
            ctx.lineTo(520, 260);
            ctx.lineTo(560, 220);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Europe
            ctx.beginPath();
            ctx.moveTo(560, 200);
            ctx.lineTo(540, 160);
            ctx.lineTo(560, 140);
            ctx.lineTo(600, 130);
            ctx.lineTo(640, 140);
            ctx.lineTo(660, 160);
            ctx.lineTo(640, 180);
            ctx.lineTo(600, 190);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Asia
            ctx.beginPath();
            ctx.moveTo(660, 140);
            ctx.lineTo(760, 120);
            ctx.lineTo(860, 140);
            ctx.lineTo(960, 180);
            ctx.lineTo(1020, 220);
            ctx.lineTo(1040, 280);
            ctx.lineTo(1000, 340);
            ctx.lineTo(920, 380);
            ctx.lineTo(820, 360);
            ctx.lineTo(720, 320);
            ctx.lineTo(680, 280);
            ctx.lineTo(680, 220);
            ctx.lineTo(700, 180);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // India
            ctx.beginPath();
            ctx.moveTo(780, 360);
            ctx.lineTo(820, 380);
            ctx.lineTo(840, 420);
            ctx.lineTo(820, 460);
            ctx.lineTo(780, 440);
            ctx.lineTo(760, 400);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Australia
            ctx.beginPath();
            ctx.moveTo(920, 480);
            ctx.lineTo(1020, 460);
            ctx.lineTo(1060, 500);
            ctx.lineTo(1040, 540);
            ctx.lineTo(980, 560);
            ctx.lineTo(920, 540);
            ctx.lineTo(900, 500);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Add grid overlay for style
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.1)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 15]);
            
            // Vertical lines
            for (let x = 0; x < 1200; x += 100) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, 600);
                ctx.stroke();
            }
            
            // Horizontal lines
            for (let y = 0; y < 600; y += 100) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(1200, y);
                ctx.stroke();
            }
            
            ctx.setLineDash([]);
        }

        // Optimized draw function
        function drawMap() {
            if (canvasOptimizer && canvasOptimizer.batchDraw) {
                canvasOptimizer.batchDraw((ctx) => {
                    drawMapContent(ctx);
                });
            } else {
                drawMapContent(ctx);
            }
        }
        
        // Draw map content with performance optimizations
        function drawMapContent(context) {
            // Clear canvas
            context.clearRect(0, 0, canvasWidth, canvasHeight);
            
            // Draw base map
            context.drawImage(mapImage, 0, 0, canvasWidth, canvasHeight);
            
            // Create overlay gradient once and reuse
            if (!window.mapOverlayGradient || window.lastCanvasSize !== canvasWidth) {
                window.mapOverlayGradient = context.createRadialGradient(
                    canvasWidth/2, canvasHeight/2, 0, 
                    canvasWidth/2, canvasHeight/2, canvasWidth/2
                );
                window.mapOverlayGradient.addColorStop(0, 'rgba(102, 126, 234, 0.15)');
                window.mapOverlayGradient.addColorStop(0.3, 'rgba(118, 75, 162, 0.1)');
                window.mapOverlayGradient.addColorStop(0.6, 'rgba(238, 90, 111, 0.05)');
                window.mapOverlayGradient.addColorStop(1, 'transparent');
                window.lastCanvasSize = canvasWidth;
            }
            
            context.fillStyle = window.mapOverlayGradient;
            context.fillRect(0, 0, canvasWidth, canvasHeight);
            
            // Optimized star rendering - reduce number and use batching
            drawOptimizedStars(context);
        }
        
        // Pre-generate star positions for better performance
        let starPositions = [];
        function generateStarPositions() {
            starPositions = [];
            for (let i = 0; i < 30; i++) { // Reduced from 50 to 30
                starPositions.push({
                    x: Math.random() * canvasWidth,
                    y: Math.random() * canvasHeight,
                    size: Math.random() * 1.5 + 0.5,
                    opacity: Math.random() * 0.6 + 0.4
                });
            }
        }
        
        function drawOptimizedStars(context) {
            if (starPositions.length === 0) {
                generateStarPositions();
            }
            
            // Batch star drawing
            context.save();
            starPositions.forEach(star => {
                context.globalAlpha = star.opacity;
                context.fillStyle = 'rgba(255, 255, 255, 1)';
                context.beginPath();
                context.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                context.fill();
            });
            context.restore();
        }

        // Create mythology markers
        function createMythologyMarkers() {
            const markersContainer = document.getElementById('mythologyMarkers');
            markersContainer.innerHTML = '';
            
            Object.entries(mythologyLocations).forEach(([key, location], index) => {
                const marker = createMarker(key, location, index);
                markersContainer.appendChild(marker);
            });
        }

        // Create individual marker
        function createMarker(mythKey, location, index) {
            const marker = document.createElement('div');
            marker.className = 'mythology-marker';
            marker.dataset.mythology = mythKey;
            marker.style.setProperty('--marker-index', index);
            
            const x = location.x * canvasWidth;
            const y = location.y * canvasHeight;
            
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            
            const markerInner = document.createElement('div');
            markerInner.className = 'marker-inner';
            
            const glow = document.createElement('div');
            glow.className = 'marker-glow';
            glow.style.background = `radial-gradient(circle, ${mythologyData[mythKey].color}88 0%, transparent 70%)`;
            
            const pin = document.createElement('div');
            pin.className = 'marker-pin';
            pin.style.background = `radial-gradient(circle, ${mythologyData[mythKey].color} 30%, transparent 70%)`;
            
            const label = document.createElement('div');
            label.className = 'marker-label';
            const regionText = typeof location.region === 'object' ? location.region[currentLanguage] || location.region.ja : location.region;
            const nameText = typeof location.name === 'object' ? location.name[currentLanguage] || location.name.ja : location.name;
            label.innerHTML = `<div style="font-size: 10px; opacity: 0.7; margin-bottom: 2px;">${regionText}</div><div style="font-size: 12px; font-weight: bold;">${nameText}</div>`;
            
            markerInner.appendChild(glow);
            markerInner.appendChild(pin);
            markerInner.appendChild(label);
            marker.appendChild(markerInner);
            
            // Add click event - direct navigation to mythology page
            marker.addEventListener('click', () => {
                exploreMythology(mythKey);
            });
            
            return marker;
        }

        // Create connection lines between related mythologies
        function createConnectionLines() {
            const connections = [
                ['china', 'japan'],
                ['greece', 'egypt'],
                ['norse', 'celtic'],
                ['aztecMaya', 'nativeAmerican'],
                ['india', 'mesopotamia']
            ];
            
            const linesContainer = document.getElementById('connectionLines');
            linesContainer.innerHTML = '';
            
            connections.forEach(([from, to]) => {
                const line = createConnectionLine(from, to);
                if (line) linesContainer.appendChild(line);
            });
        }

        // Create connection line between two mythologies
        function createConnectionLine(from, to) {
            const fromLoc = mythologyLocations[from];
            const toLoc = mythologyLocations[to];
            
            if (!fromLoc || !toLoc) return null;
            
            const x1 = fromLoc.x * canvasWidth;
            const y1 = fromLoc.y * canvasHeight;
            const x2 = toLoc.x * canvasWidth;
            const y2 = toLoc.y * canvasHeight;
            
            const line = document.createElement('div');
            line.className = 'connection-line';
            line.dataset.from = from;
            line.dataset.to = to;
            
            const distance = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            const angle = Math.atan2(y2 - y1, x2 - x1) * (180 / Math.PI);
            
            line.style.width = distance + 'px';
            line.style.left = x1 + 'px';
            line.style.top = y1 + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            
            return line;
        }

        // Initialize particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 20 + 20) + 's';
                particlesContainer.appendChild(particle);
            }
        }



        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateUILanguage();
            createMythologyMarkers();
        });

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            document.querySelectorAll('.mythology-marker').forEach(marker => {
                const mythologyKey = marker.dataset.mythology;
                const mythologyData_ = mythologyData[mythologyKey];
                
                const searchableText = [
                    mythologyData_.title,
                    mythologyData_.titleZh,
                    mythologyData_.titleJa,
                    mythologyData_.origin,
                    mythologyData_.description,
                    ...mythologyData_.features
                ].join(' ').toLowerCase();
                
                if (searchableText.includes(searchTerm)) {
                    marker.style.opacity = '1';
                    marker.style.pointerEvents = 'auto';
                } else {
                    marker.style.opacity = '0.3';
                    marker.style.pointerEvents = 'none';
                }
            });
            
            // Reset if search is empty
            if (!searchTerm) {
                document.querySelectorAll('.mythology-marker').forEach(marker => {
                    marker.style.opacity = '';
                    marker.style.pointerEvents = '';
                });
            }
        });

        // Filter functionality
        let activeFilters = new Set();
        
        // Define region categories for each mythology
        const mythologyRegions = {
            'china': 'east-asia',
            'japan': 'east-asia',
            'india': 'south-asia',
            'egypt': 'africa',
            'greece': 'europe',
            'norse': 'europe',
            'mesopotamia': 'middle-east',
            'celtic': 'europe',
            'aztecMaya': 'americas',
            'nativeAmerican': 'americas',
            'westAfrica': 'africa',
            'aboriginal': 'oceania',
            'polynesian': 'oceania'
        };
        
        // Toggle filter function
        function toggleFilter(region) {
            const filterItem = document.querySelector(`[data-region="${region}"]`);
            
            if (activeFilters.has(region)) {
                // Remove filter
                activeFilters.delete(region);
                filterItem.classList.remove('active');
            } else {
                // Add filter
                activeFilters.add(region);
                filterItem.classList.add('active');
            }
            
            applyFilters();
        }
        
        // Apply filters to markers with smooth animations
        function applyFilters() {
            const markers = document.querySelectorAll('.mythology-marker');
            
            markers.forEach((marker, index) => {
                const mythologyKey = marker.dataset.mythology;
                const mythologyRegion = mythologyRegions[mythologyKey];
                
                // Add transition for smooth animations
                marker.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                
                // Delay animations for staggered effect
                setTimeout(() => {
                    if (activeFilters.size === 0) {
                        // No filters active, show all
                        marker.style.opacity = '1';
                        marker.style.transform = 'translate(-50%, -50%) scale(1)';
                        marker.style.pointerEvents = 'auto';
                        marker.style.filter = 'none';
                    } else if (activeFilters.has(mythologyRegion)) {
                        // Show filtered items with highlight
                        marker.style.opacity = '1';
                        marker.style.transform = 'translate(-50%, -50%) scale(1.15)';
                        marker.style.pointerEvents = 'auto';
                        marker.style.filter = 'drop-shadow(0 0 10px rgba(255, 255, 255, 0.8))';
                    } else {
                        // Hide non-filtered items
                        marker.style.opacity = '0.15';
                        marker.style.transform = 'translate(-50%, -50%) scale(0.7)';
                        marker.style.pointerEvents = 'none';
                        marker.style.filter = 'grayscale(100%)';
                    }
                }, index * 50); // Staggered animation delay
            });
        }
        
        // Show all regions
        function showAllRegions() {
            activeFilters.clear();
            document.querySelectorAll('.legend-item').forEach(item => {
                item.classList.remove('active');
            });
            applyFilters();
        }
        
        // Clear filters (same as show all)
        function clearFilters() {
            showAllRegions();
        }

        // Explore mythology function
        function exploreMythology(region) {
            const mythologyPages = {
                china: 'chinese-mythology-index.html',  // ä¿æŒä¸­æ–‡ç‰ˆ
                greece: 'greek-mythology-index-ja.html',
                norse: 'norse-mythology-index-ja.html',
                egypt: 'egyptian-mythology-index-ja.html',
                india: 'indian-mythology-index-ja.html',
                japan: 'japanese-mythology-index.html',  // ä¿æŒæ—¥æ–‡ç‰ˆ
                mesopotamia: 'mesopotamian-mythology-index-ja.html',
                celtic: 'celtic-mythology-index-ja.html',
                nativeAmerican: 'native-american-mythology-index-ja.html',
                aztecMaya: 'aztec-maya-mythology-index-ja.html',
                westAfrica: 'west-african-mythology-index-ja.html',
                aboriginal: 'aboriginal-mythology-index-ja.html',
                polynesian: 'polynesian-mythology-index-ja.html'
            };
            
            if (mythologyPages[region]) {
                window.location.href = mythologyPages[region];
            } else {
                alert(`${mythologyData[region].title} coming soon!`);
            }
        }

        // Initialize Japanese interface
        function initializeJapanese() {
            // Update page title and subtitle to Japanese
            document.getElementById('mainTitle').textContent = "ä¸–ç•Œç¥è©±ã®æ—…";
            document.getElementById('subtitle').textContent = "åœ°åŸŸã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç¥è©±ã®å®ç‰©ã‚’æ¢ç´¢";
            
            // Update search placeholder to Japanese
            document.getElementById('searchInput').placeholder = "ç¥è©±ã‚’æ¤œç´¢...";
            
            // Update legend text
            updateLegendLanguage();
            updateUILanguage();
            
            // Create markers with current language
            createMythologyMarkers();
        }
        
        // Initialize after DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize all components
            createParticles();
            initializeMap();
            updateLegendLanguage();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (mapImage && mapImage.complete) {
                const maxWidth = 1200;
                const aspectRatio = mapImage.height / mapImage.width;
                canvasWidth = Math.min(maxWidth, window.innerWidth - 80);
                canvasHeight = canvasWidth * aspectRatio;
                
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                
                drawMap();
                createMythologyMarkers();
                createConnectionLines();
                
            }
        });


        // Animation on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe elements for scroll animations
        document.querySelectorAll('.legend-item, .about-section').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'all 0.6s ease';
            observer.observe(el);
        });
    </script>
</body>
</html>