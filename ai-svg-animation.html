<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SVG åŠ¨ç”»ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #FFD700;
        }

        .container {
            display: flex;
            flex: 1;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            gap: 20px;
            padding: 20px;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            width: 400px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            resize: vertical;
        }

        button {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .animation-area {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        #svgContainer {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 500px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }

        #generatedSVG {
            max-width: 100%;
            max-height: 100%;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .status.success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
        }

        .status.error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
        }

        .status.processing {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.5);
        }

        .examples {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .example-btn {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .example-btn:hover {
            background: rgba(255, 215, 0, 0.2);
        }

        .code-display {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .toggle-code {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 15px;
            font-size: 12px;
            margin-top: 10px;
        }

        .llama-io {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .llama-io h4 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .llama-io pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âœ¨ AI SVG åŠ¨ç”»ç”Ÿæˆå™¨ âœ¨</h1>
        <p>ä½¿ç”¨ Llama2 å°†æ–‡å­—æè¿°è½¬æ¢ä¸º SVG åŠ¨ç”»</p>
    </div>

    <div class="container">
        <div class="control-panel">
            <div class="section">
                <h3>ğŸ“ åœºæ™¯æè¿°</h3>
                <textarea id="sceneInput" placeholder="æè¿°æ‚¨æƒ³è¦çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼š
å¤¸çˆ¶è¿½æ—¥ï¼Œä»–å¥”è·‘åœ¨å¤§åœ°ä¸Šï¼Œå¤ªé˜³åœ¨å‰æ–¹é€ƒè·‘...
ä¸‰ä¸ªå°å­©åœ¨è‰åœ°ä¸Šè¸¢è¶³çƒ...
å±±æµ·ç»ä¸­çš„å‡¤å‡°åœ¨äº‘ç«¯é£èˆï¼Œç¾½æ¯›é—ªçƒç€ä¸ƒå½©å…‰èŠ’..."></textarea>
            </div>

            <div class="section">
                <h3>ğŸ¤– AI æ¨¡å‹é€‰æ‹©</h3>
                <select id="modelSelect" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,215,0,0.3); border-radius: 5px; color: #fff; margin-bottom: 10px;" onchange="onModelChange()">
                    <option value="gemini">Google Gemini (å…è´¹)</option>
                    <option value="ollama">æœ¬åœ° Llama2 (Ollama)</option>
                    <option value="openai">OpenAI GPT-4</option>
                    <option value="deepseek">DeepSeek API</option>
                    <option value="claude">Claude API</option>
                    <option value="fallback">ä»…ä½¿ç”¨å¤‡ç”¨ç”Ÿæˆå™¨</option>
                </select>
                
                <div id="apiKeySection" style="display: none;">
                    <input type="password" id="apiKey" placeholder="è¯·è¾“å…¥ API Key" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,215,0,0.3); border-radius: 5px; color: #fff; margin-top: 10px;">
                    <small style="color: #aaa; display: block; margin-top: 5px;">API Key ä»…ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°</small>
                </div>
            </div>

            <div class="section">
                <h3>ğŸ¯ åŠ¨ç”»ç±»å‹</h3>
                <select id="animationType" style="width: 100%; padding: 10px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,215,0,0.3); border-radius: 5px; color: #fff;">
                    <option value="mythology">ç¥è¯åœºæ™¯</option>
                    <option value="character">äººç‰©åŠ¨ä½œ</option>
                    <option value="creature">ç¥å…½åŠ¨ç”»</option>
                    <option value="nature">è‡ªç„¶æ™¯è§‚</option>
                </select>
            </div>

            <div class="section">
                <button onclick="generateAnimation()" id="generateBtn">ğŸ¨ ç”ŸæˆåŠ¨ç”»</button>
                <button onclick="clearAnimation()">ğŸ—‘ï¸ æ¸…é™¤</button>
                <button onclick="downloadSVG()">ğŸ’¾ ä¸‹è½½ SVG</button>
            </div>

            <div class="section examples">
                <h4>å¿«é€Ÿç¤ºä¾‹ï¼š</h4>
                <button class="example-btn" onclick="loadExample('kuafu')">å¤¸çˆ¶è¿½æ—¥</button>
                <button class="example-btn" onclick="loadExample('phoenix')">å‡¤å‡°é£èˆ</button>
                <button class="example-btn" onclick="loadExample('dragon')">ç¥é¾™å‡ºæµ·</button>
                <button class="example-btn" onclick="loadExample('houyi')">åç¾¿å°„æ—¥</button>
                <button class="example-btn" onclick="loadExample('soccer')">å°å­©è¸¢çƒ</button>
            </div>

            <div id="status"></div>
        </div>

        <div class="animation-area">
            <h3 style="color: #FFD700; margin-bottom: 15px;">ğŸ¬ åŠ¨ç”»é¢„è§ˆ</h3>
            <div id="svgContainer">
                <div id="placeholder" style="text-align: center; color: #666;">
                    <p style="font-size: 24px; margin-bottom: 10px;">âœ¨</p>
                    <p>åœ¨å·¦ä¾§è¾“å…¥åœºæ™¯æè¿°ï¼Œç‚¹å‡»"ç”ŸæˆåŠ¨ç”»"å¼€å§‹åˆ›ä½œ</p>
                </div>
            </div>
            <button class="toggle-code" onclick="toggleCode()">æŸ¥çœ‹ SVG ä»£ç </button>
            <button class="toggle-code" onclick="toggleLlamaIO()">æŸ¥çœ‹ Llama2 è°ƒç”¨è¯¦æƒ…</button>
            <pre class="code-display" id="codeDisplay"></pre>
            
            <div class="llama-io" id="llamaIO" style="display: none;">
                <h4>ğŸ¤– Llama2 è°ƒç”¨è¯¦æƒ…</h4>
                <div id="llamaInput">
                    <h4>è¾“å…¥ (Prompt):</h4>
                    <pre id="llamaInputContent"></pre>
                </div>
                <div id="llamaOutput" style="margin-top: 15px;">
                    <h4>è¾“å‡º (Response):</h4>
                    <pre id="llamaOutputContent"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        const OLLAMA_ENDPOINT = ''; // Set your local Ollama endpoint
        const OPENAI_ENDPOINT = 'https://api.openai.com/v1/chat/completions';
        const DEEPSEEK_ENDPOINT = 'https://api.deepseek.com/v1/chat/completions';
        const CLAUDE_ENDPOINT = 'https://api.anthropic.com/v1/messages';
        const GEMINI_ENDPOINT = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
        
        // Load saved API keys
        window.onload = function() {
            const savedModel = localStorage.getItem('selectedModel') || 'ollama';
            document.getElementById('modelSelect').value = savedModel;
            
            const savedKey = localStorage.getItem(`apiKey_${savedModel}`);
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }
            
            onModelChange();
        };
        
        function onModelChange() {
            const model = document.getElementById('modelSelect').value;
            const apiKeySection = document.getElementById('apiKeySection');
            
            if (['openai', 'deepseek', 'claude', 'gemini'].includes(model)) {
                apiKeySection.style.display = 'block';
                const savedKey = localStorage.getItem(`apiKey_${model}`);
                if (savedKey) {
                    document.getElementById('apiKey').value = savedKey;
                }
                
                // Update placeholder text for different APIs
                const apiKeyInput = document.getElementById('apiKey');
                if (model === 'gemini') {
                    apiKeyInput.placeholder = 'è¯·è¾“å…¥ Google API Key (åœ¨ Google AI Studio è·å–)';
                } else {
                    apiKeyInput.placeholder = 'è¯·è¾“å…¥ API Key';
                }
            } else {
                apiKeySection.style.display = 'none';
            }
            
            localStorage.setItem('selectedModel', model);
        }
        
        const examples = {
            kuafu: "å¤¸çˆ¶è¿½æ—¥ï¼šå·¨äººå¤¸çˆ¶è¿ˆç€å¤§æ­¥è¿½èµ¶å¤ªé˜³ï¼Œä»–çš„èº«å½¢é«˜å¤§å¦‚å±±ï¼Œæ¯ä¸€æ­¥éƒ½éœ‡åŠ¨å¤§åœ°ã€‚å¤ªé˜³åœ¨å¤©ç©ºä¸­å¿«é€Ÿç§»åŠ¨ï¼Œæ•£å‘ç€é‡‘è‰²çš„å…‰èŠ’ã€‚",
            phoenix: "å‡¤å‡°åœ¨äº‘ç«¯é£èˆï¼Œå®ƒçš„ç¾½æ¯›é—ªçƒç€çº¢ã€æ©™ã€é»„ã€ç»¿ã€è“äº”ç§é¢œè‰²ï¼Œç¿…è†€ä¼˜é›…åœ°æ‰‡åŠ¨ï¼Œèº«åç•™ä¸‹å½©è™¹èˆ¬çš„è½¨è¿¹ã€‚",
            dragon: "é’é¾™ä»æµ·ä¸­è…¾ç©ºè€Œèµ·ï¼Œèº«ä½“å‘ˆSå½¢æ‘†åŠ¨ï¼Œé³ç‰‡é—ªé—ªå‘å…‰ï¼Œäº‘é›¾ç¼­ç»•åœ¨å®ƒçš„èº«è¾¹ï¼Œå¨ä¸¥è€Œç¥ç§˜ã€‚",
            houyi: "åç¾¿ç«™åœ¨å±±å·…ï¼Œæ‹‰æ»¡ç¥å¼“ï¼Œç„å‡†å¤©ç©ºä¸­çš„ä¹ä¸ªå¤ªé˜³ã€‚ç®­çŸ¢å¸¦ç€æµå…‰å°„å‡ºï¼Œç›´æŒ‡ç‚½çƒ­çš„å¤ªé˜³ã€‚",
            soccer: "ä¸‰ä¸ªå°å­©åœ¨ç»¿è‰²çš„è‰åœ°ä¸Šè¸¢è¶³çƒï¼Œä»–ä»¬ç©¿ç€å½©è‰²çš„è¿åŠ¨æœï¼Œè¶³çƒåœ¨ä»–ä»¬ä¹‹é—´ä¼ é€’ï¼Œå­©å­ä»¬å¥”è·‘ç€ï¼Œç¬‘å£°å›è¡åœ¨é˜³å…‰æ˜åªšçš„å¤©ç©ºä¸‹ã€‚"
        };

        function loadExample(key) {
            document.getElementById('sceneInput').value = examples[key];
        }

        async function generateAnimation() {
            const scene = document.getElementById('sceneInput').value.trim();
            if (!scene) {
                showStatus('è¯·è¾“å…¥åœºæ™¯æè¿°', 'error');
                return;
            }

            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.textContent = 'â³ ç”Ÿæˆä¸­...';
            const modelName = {
                'ollama': 'Llama2',
                'openai': 'GPT-4',
                'deepseek': 'DeepSeek',
                'claude': 'Claude',
                'gemini': 'Gemini',
                'fallback': 'å¤‡ç”¨ç”Ÿæˆå™¨'
            }[document.getElementById('modelSelect').value];
            showStatus(`æ­£åœ¨è°ƒç”¨ ${modelName} ç”Ÿæˆ SVG åŠ¨ç”»...`, 'processing');

            try {
                const animationType = document.getElementById('animationType').value;
                const selectedModel = document.getElementById('modelSelect').value;
                
                // Save API key if provided
                if (['openai', 'deepseek', 'claude', 'gemini'].includes(selectedModel)) {
                    const apiKey = document.getElementById('apiKey').value;
                    if (apiKey) {
                        localStorage.setItem(`apiKey_${selectedModel}`, apiKey);
                    }
                }
                
                let svgCode;
                if (selectedModel === 'fallback') {
                    svgCode = createFallbackSVG(scene);
                    showStatus('ä½¿ç”¨å¤‡ç”¨ç”Ÿæˆå™¨åˆ›å»ºåŠ¨ç”»', 'success');
                } else {
                    svgCode = await generateSVGWithAI(scene, animationType, selectedModel);
                    // Check if fallback was used
                    if (svgCode.includes('<!-- Fallback Animation -->')) {
                        showStatus(`${selectedModel} ç”Ÿæˆçš„å†…å®¹ä¸å‡†ç¡®ï¼Œå·²ä½¿ç”¨å¤‡ç”¨åŠ¨ç”»ç”Ÿæˆå™¨`, 'success');
                    } else {
                        showStatus('åŠ¨ç”»ç”ŸæˆæˆåŠŸï¼', 'success');
                    }
                }
                
                displaySVG(svgCode);
            } catch (error) {
                showStatus('ç”Ÿæˆå¤±è´¥ï¼š' + error.message, 'error');
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ¨ ç”ŸæˆåŠ¨ç”»';
            }
        }

        async function generateSVGWithAI(scene, type, model) {
            // Create a more specific prompt based on the scene
            let specificRequirements = '';
            
            if (scene.includes('è¶³çƒ') || scene.includes('è¸¢çƒ')) {
                specificRequirements = `
- Include a soccer ball (white circle with black pentagons)
- Show grass field (green rectangle at bottom)
- Ball should bounce or move between players`;
            }
            
            if (scene.includes('å°å­©') || scene.includes('å­©å­')) {
                specificRequirements += `
- Create simple stick figures or basic shapes for children
- Each child should have: head (circle), body (rectangle), arms and legs (lines or rectangles)
- Different colored shirts to distinguish them`;
            }
            
            if (scene.includes('ä¸‰ä¸ª') || scene.includes('three')) {
                specificRequirements += `
- Must show exactly 3 children/figures
- Position them at different x coordinates (e.g., 200, 400, 600)`;
            }

            const prompt = `Generate SVG code for: "${scene}"

IMPORTANT: Output ONLY valid SVG code, no explanations. Start with <svg> and end with </svg>.

Requirements:
- Size: width="800" height="600"
- Include animations using <animate> or <animateTransform>
- Background: sky blue (#87CEEB) rectangle
${specificRequirements}

Example for reference:
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <rect width="800" height="600" fill="#87CEEB"/>
  <rect x="0" y="400" width="800" height="200" fill="#228B22"/>
  <circle cx="400" cy="350" r="20" fill="white">
    <animate attributeName="cx" from="200" to="600" dur="3s" repeatCount="indefinite"/>
  </circle>
</svg>

Generate the SVG now:`;

            // Display the input prompt
            document.getElementById('llamaInputContent').textContent = prompt;
            document.getElementById('llamaIO').style.display = 'block';
            document.getElementById('llamaOutputContent').textContent = `æ­£åœ¨ç­‰å¾… ${model} å“åº”...`;

            let response, result;
            
            switch (model) {
                case 'ollama':
                    response = await fetch(`${OLLAMA_ENDPOINT}/api/generate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: 'llama2',
                            prompt: prompt,
                            stream: false,
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) {
                        document.getElementById('llamaOutputContent').textContent = 'Error: Ollama è¯·æ±‚å¤±è´¥';
                        throw new Error('Ollama è¯·æ±‚å¤±è´¥');
                    }
                    result = await response.json();
                    break;
                    
                case 'openai':
                    const openaiKey = localStorage.getItem('apiKey_openai');
                    if (!openaiKey) throw new Error('è¯·å…ˆè®¾ç½® OpenAI API Key');
                    
                    response = await fetch(OPENAI_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${openaiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4',
                            messages: [{
                                role: 'system',
                                content: 'You are an SVG animation expert. Generate only valid SVG code without any explanations.'
                            }, {
                                role: 'user',
                                content: prompt
                            }],
                            temperature: 0.7,
                            max_tokens: 2000
                        })
                    });
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(`OpenAI API é”™è¯¯: ${error.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                    const openaiResult = await response.json();
                    result = { response: openaiResult.choices[0].message.content };
                    break;
                    
                case 'deepseek':
                    const deepseekKey = localStorage.getItem('apiKey_deepseek');
                    if (!deepseekKey) throw new Error('è¯·å…ˆè®¾ç½® DeepSeek API Key');
                    
                    response = await fetch(DEEPSEEK_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${deepseekKey}`
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [{
                                role: 'system',
                                content: 'You are an SVG animation expert. Generate only valid SVG code without any explanations.'
                            }, {
                                role: 'user',
                                content: prompt
                            }],
                            temperature: 0.7
                        })
                    });
                    if (!response.ok) {
                        throw new Error('DeepSeek API è¯·æ±‚å¤±è´¥');
                    }
                    const deepseekResult = await response.json();
                    result = { response: deepseekResult.choices[0].message.content };
                    break;
                    
                case 'claude':
                    const claudeKey = localStorage.getItem('apiKey_claude');
                    if (!claudeKey) throw new Error('è¯·å…ˆè®¾ç½® Claude API Key');
                    
                    response = await fetch(CLAUDE_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': claudeKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-3-opus-20240229',
                            messages: [{
                                role: 'user',
                                content: prompt
                            }],
                            max_tokens: 2000
                        })
                    });
                    if (!response.ok) {
                        throw new Error('Claude API è¯·æ±‚å¤±è´¥');
                    }
                    const claudeResult = await response.json();
                    result = { response: claudeResult.content[0].text };
                    break;
                    
                case 'gemini':
                    const geminiKey = localStorage.getItem('apiKey_gemini');
                    if (!geminiKey) throw new Error('è¯·å…ˆè®¾ç½® Google API Key');
                    
                    response = await fetch(`${GEMINI_ENDPOINT}?key=${geminiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 2048,
                            }
                        })
                    });
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(`Gemini API é”™è¯¯: ${error.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                    const geminiResult = await response.json();
                    result = { response: geminiResult.candidates[0].content.parts[0].text };
                    break;
                    
                default:
                    throw new Error('æœªçŸ¥çš„æ¨¡å‹ç±»å‹');
            }
            
            // Display the output response
            document.getElementById('llamaOutputContent').textContent = result.response || 'No response received';
            
            // Add SVG extraction process details
            let extractionInfo = '\n\n========== SVG æå–è¿‡ç¨‹ ==========\n';
            
            // Extract SVG from response
            const svgMatch = result.response.match(/<svg[\s\S]*?<\/svg>/);
            if (svgMatch) {
                extractionInfo += 'âœ… æˆåŠŸæ‰¾åˆ° SVG ä»£ç ï¼\n';
                extractionInfo += `ğŸ“ SVG ä»£ç é•¿åº¦: ${svgMatch[0].length} å­—ç¬¦\n`;
                extractionInfo += 'ğŸ“ æå–çš„ SVG ä»£ç é¢„è§ˆ:\n';
                extractionInfo += svgMatch[0].substring(0, 200) + '...\n';
                
                // Check if the SVG actually represents the scene
                const svgContent = svgMatch[0].toLowerCase();
                const sceneKeywords = scene.toLowerCase().split(/\s+/);
                let relevanceScore = 0;
                
                // Check for soccer/football specific elements
                if (scene.includes('è¶³çƒ') || scene.includes('è¸¢çƒ')) {
                    if (svgContent.includes('ball') || svgContent.includes('sphere') || svgContent.includes('è¶³çƒ')) relevanceScore += 2;
                    if (!svgContent.includes('ball') && !svgContent.includes('circle')) relevanceScore -= 2;
                }
                
                // Check for kids/children
                if (scene.includes('å°å­©') || scene.includes('å­©å­')) {
                    if (svgContent.includes('boy') || svgContent.includes('girl') || svgContent.includes('child') || svgContent.includes('kid')) relevanceScore += 2;
                    const personCount = (svgContent.match(/person|boy|girl|child|kid|head|body/g) || []).length;
                    if (personCount < 2) relevanceScore -= 2;
                }
                
                // Check for the number three
                if (scene.includes('ä¸‰ä¸ª') || scene.includes('three')) {
                    const groupCount = (svgContent.match(/<g\s|<circle|<ellipse|<rect/g) || []).length;
                    if (groupCount < 5) relevanceScore -= 1; // Should have multiple elements for 3 kids
                }
                
                extractionInfo += `\nğŸ¯ ç›¸å…³æ€§æ£€æŸ¥:\n`;
                extractionInfo += `   - åœºæ™¯å…³é”®è¯: ${sceneKeywords.join(', ')}\n`;
                extractionInfo += `   - ç›¸å…³æ€§å¾—åˆ†: ${relevanceScore}\n`;
                
                if (relevanceScore < -1) {
                    extractionInfo += `\nâš ï¸ è­¦å‘Š: ç”Ÿæˆçš„ SVG ä¸åœºæ™¯æè¿°ä¸åŒ¹é…ï¼\n`;
                    extractionInfo += `ğŸ”„ ä½¿ç”¨å¤‡ç”¨åŠ¨ç”»ç”Ÿæˆå™¨åˆ›å»ºå‡†ç¡®çš„åŠ¨ç”»\n`;
                    document.getElementById('llamaOutputContent').textContent += extractionInfo;
                    return createFallbackSVG(scene);
                }
                
                document.getElementById('llamaOutputContent').textContent += extractionInfo;
                return svgMatch[0];
            } else {
                extractionInfo += 'âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ SVG ä»£ç \n';
                extractionInfo += 'ğŸ” æœç´¢æ¨¡å¼: /<svg[\\s\\S]*?<\\/svg>/\n';
                extractionInfo += 'ğŸ“‹ å“åº”å†…å®¹ç±»å‹: ' + typeof result.response + '\n';
                extractionInfo += 'ğŸ“ å“åº”é•¿åº¦: ' + (result.response ? result.response.length : 0) + ' å­—ç¬¦\n';
                extractionInfo += 'ğŸ”„ ä½¿ç”¨å¤‡ç”¨åŠ¨ç”»ç”Ÿæˆå™¨\n';
                document.getElementById('llamaOutputContent').textContent += extractionInfo;
                return createFallbackSVG(scene);
            }
        }

        function createFallbackSVG(scene) {
            // Create a simple fallback animation based on keywords
            const isKuafu = scene.includes('å¤¸çˆ¶') || scene.includes('è¿½æ—¥');
            const isDragon = scene.includes('é¾™') || scene.includes('é¾');
            const isPhoenix = scene.includes('å‡¤å‡°') || scene.includes('é³³å‡°');
            const isSoccer = scene.includes('è¶³çƒ') || scene.includes('è¸¢çƒ') || scene.includes('soccer') || scene.includes('football');
            const hasKids = scene.includes('å°å­©') || scene.includes('å­©å­') || scene.includes('å„¿ç«¥') || scene.includes('children') || scene.includes('kids');

            let svg = `<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
                <!-- Fallback Animation -->`;

            if (isSoccer) {
                // Soccer scene
                svg += `
                <!-- å¤©ç©º -->
                <rect width="800" height="600" fill="#87CEEB"/>
                <!-- è‰åœ° -->
                <rect x="0" y="400" width="800" height="200" fill="#228B22"/>
                
                <!-- è¶³çƒ -->
                <g id="ball">
                    <circle cx="400" cy="380" r="20" fill="white" stroke="black" stroke-width="2">
                        <animate attributeName="cx" values="400;300;500;400" dur="4s" repeatCount="indefinite"/>
                        <animate attributeName="cy" values="380;350;350;380" dur="4s" repeatCount="indefinite"/>
                    </circle>
                    <path d="M385,365 L395,365 L398,375 L390,382 L382,375 Z" fill="black"/>
                    <path d="M405,375 L415,375 L415,385 L405,385 Z" fill="black"/>
                </g>
                
                <!-- å°å­©1 -->
                <g id="kid1" transform="translate(200,350)">
                    <circle cx="0" cy="-20" r="15" fill="#FDBCB4"/> <!-- å¤´ -->
                    <rect x="-10" y="-5" width="20" height="30" fill="#FF6347"/> <!-- èº«ä½“ -->
                    <rect x="-15" y="25" width="10" height="25" fill="#4169E1"/> <!-- å·¦è…¿ -->
                    <rect x="5" y="25" width="10" height="25" fill="#4169E1"/> <!-- å³è…¿ -->
                    <animateTransform attributeName="transform" type="translate" 
                        values="200,350; 250,350; 200,350" dur="4s" repeatCount="indefinite"/>
                </g>
                
                <!-- å°å­©2 -->
                <g id="kid2" transform="translate(400,350)">
                    <circle cx="0" cy="-20" r="15" fill="#FDBCB4"/> <!-- å¤´ -->
                    <rect x="-10" y="-5" width="20" height="30" fill="#32CD32"/> <!-- èº«ä½“ -->
                    <rect x="-15" y="25" width="10" height="25" fill="#4169E1"/> <!-- å·¦è…¿ -->
                    <rect x="5" y="25" width="10" height="25" fill="#4169E1"/> <!-- å³è…¿ -->
                    <animateTransform attributeName="transform" type="translate" 
                        values="400,350; 350,340; 450,340; 400,350" dur="4s" repeatCount="indefinite"/>
                </g>
                
                <!-- å°å­©3 -->
                <g id="kid3" transform="translate(600,350)">
                    <circle cx="0" cy="-20" r="15" fill="#FDBCB4"/> <!-- å¤´ -->
                    <rect x="-10" y="-5" width="20" height="30" fill="#FFD700"/> <!-- èº«ä½“ -->
                    <rect x="-15" y="25" width="10" height="25" fill="#4169E1"/> <!-- å·¦è…¿ -->
                    <rect x="5" y="25" width="10" height="25" fill="#4169E1"/> <!-- å³è…¿ -->
                    <animateTransform attributeName="transform" type="translate" 
                        values="600,350; 550,350; 600,350" dur="4s" repeatCount="indefinite"/>
                </g>`;
            } else if (isKuafu) {
                svg += `
                <defs>
                    <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FFA07A;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <rect width="800" height="600" fill="url(#skyGradient)"/>
                <!-- å¤ªé˜³ -->
                <circle cx="700" cy="100" r="60" fill="#FFD700">
                    <animate attributeName="cx" from="700" to="100" dur="5s" repeatCount="indefinite"/>
                </circle>
                <!-- å¤¸çˆ¶ -->
                <ellipse cx="200" cy="400" rx="40" ry="80" fill="#8B4513">
                    <animateTransform attributeName="transform" type="translate" 
                        from="0 0" to="400 0" dur="5s" repeatCount="indefinite"/>
                </ellipse>`;
            } else if (isDragon) {
                svg += `
                <rect width="800" height="600" fill="#001122"/>
                <!-- é¾™èº« -->
                <path d="M100,300 Q200,200 300,300 T500,300" stroke="#00CED1" stroke-width="20" fill="none">
                    <animate attributeName="d" 
                        values="M100,300 Q200,200 300,300 T500,300;
                                M100,300 Q200,400 300,300 T500,300;
                                M100,300 Q200,200 300,300 T500,300"
                        dur="2s" repeatCount="indefinite"/>
                </path>`;
            } else {
                svg += `
                <rect width="800" height="600" fill="#87CEEB"/>
                <!-- é€šç”¨åŠ¨ç”»å…ƒç´  -->
                <circle cx="400" cy="300" r="50" fill="#FFD700" opacity="0.8">
                    <animate attributeName="r" from="50" to="80" dur="2s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" from="0.8" to="0.3" dur="2s" repeatCount="indefinite"/>
                </circle>`;
            }

            svg += `</svg>`;
            return svg;
        }

        function displaySVG(svgCode) {
            const container = document.getElementById('svgContainer');
            container.innerHTML = svgCode;
            document.getElementById('codeDisplay').textContent = svgCode;
        }

        function clearAnimation() {
            document.getElementById('svgContainer').innerHTML = `
                <div id="placeholder" style="text-align: center; color: #666;">
                    <p style="font-size: 24px; margin-bottom: 10px;">âœ¨</p>
                    <p>åœ¨å·¦ä¾§è¾“å…¥åœºæ™¯æè¿°ï¼Œç‚¹å‡»"ç”ŸæˆåŠ¨ç”»"å¼€å§‹åˆ›ä½œ</p>
                </div>`;
            document.getElementById('codeDisplay').textContent = '';
            document.getElementById('sceneInput').value = '';
            document.getElementById('llamaIO').style.display = 'none';
            document.getElementById('llamaInputContent').textContent = '';
            document.getElementById('llamaOutputContent').textContent = '';
            showStatus('', '');
        }

        function downloadSVG() {
            const svgElement = document.querySelector('#svgContainer svg');
            if (!svgElement) {
                showStatus('æ²¡æœ‰å¯ä¸‹è½½çš„åŠ¨ç”»', 'error');
                return;
            }

            const svgData = new XMLSerializer().serializeToString(svgElement);
            const blob = new Blob([svgData], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mythology-animation.svg';
            a.click();
            URL.revokeObjectURL(url);
            showStatus('SVG å·²ä¸‹è½½', 'success');
        }

        function toggleCode() {
            const codeDisplay = document.getElementById('codeDisplay');
            codeDisplay.style.display = codeDisplay.style.display === 'none' ? 'block' : 'none';
        }

        function toggleLlamaIO() {
            const llamaIO = document.getElementById('llamaIO');
            if (llamaIO.style.display === 'none' && document.getElementById('llamaInputContent').textContent) {
                llamaIO.style.display = 'block';
            } else {
                llamaIO.style.display = 'none';
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            if (!message) {
                status.style.display = 'none';
                return;
            }
            status.style.display = 'block';
            status.className = 'status ' + type;
            status.textContent = message;
        }
    </script>
</body>
</html>