<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç¥æ¼”ç¾©ãƒŸã‚¹ãƒ†ãƒªãƒ¼ - ç«æŸ´äººæ¢åµã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f5f3e9;
            color: #2c1810;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ */
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .game-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0));
        }

        .game-title {
            font-size: 2.5em;
            color: #8b4513;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .game-subtitle {
            font-size: 1.2em;
            color: #666;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* ç«æŸ´äººã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¨ãƒªã‚¢ */
        .stick-figure-area {
            background: white;
            border: 3px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            min-height: 400px;
        }

        #gameCanvas {
            width: 100%;
            height: 400px;
            border: 1px dashed #ccc;
            cursor: pointer;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ‘ã‚ºãƒ«ã‚¨ãƒªã‚¢ */
        .content-area {
            background: white;
            border: 3px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
            max-height: 600px;
        }

        /* ç« ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            font-size: 1.8em;
            color: #8b4513;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b4513;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .text-display {
            background: #fefefe;
            padding: 15px;
            border-left: 4px solid #d4a574;
            margin-bottom: 20px;
            font-size: 1.1em;
            line-height: 1.8;
        }

        .text-display p {
            margin-bottom: 10px;
        }

        /* ãƒ‘ã‚ºãƒ«ã‚¨ãƒªã‚¢ */
        .puzzle-area {
            background: #f9f7f3;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .puzzle-question {
            font-size: 1.3em;
            color: #8b4513;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .puzzle-options {
            display: grid;
            gap: 10px;
        }

        .option-button {
            background: white;
            border: 2px solid #d4a574;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            text-align: left;
        }

        .option-button:hover {
            background: #fff8dc;
            border-color: #8b4513;
            transform: translateX(5px);
        }

        .option-button.correct {
            background: #90ee90;
            border-color: #228b22;
        }

        .option-button.wrong {
            background: #ffcccb;
            border-color: #dc143c;
        }

        /* ãƒœãƒˆãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .bottom-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #8b4513;
        }

        /* ã‚¹ã‚³ã‚¢è¡¨ç¤º */
        .score-display {
            font-size: 1.3em;
            color: #8b4513;
            font-weight: bold;
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-container {
            flex: 1;
            margin: 0 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8b4513, #d4a574);
            transition: width 0.5s ease;
            width: 0%;
        }

        /* ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ */
        .home-button {
            background: #8b4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .home-button:hover {
            background: #a0522d;
            transform: translateY(-2px);
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .start-content {
            background: linear-gradient(135deg, #8b4513 0%, #d2691e 100%);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            color: white;
            max-width: 600px;
        }

        .start-title {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .start-description {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .start-button {
            background: #FFD700;
            color: #8b4513;
            border: none;
            padding: 20px 40px;
            font-size: 1.5em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(255,215,0,0.5);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }

        .modal-title {
            font-size: 2em;
            color: #8b4513;
            margin-bottom: 20px;
        }

        .modal-message {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #666;
        }

        .modal-button {
            background: #8b4513;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .modal-button:hover {
            background: #a0522d;
            transform: translateY(-2px);
        }

        /* æ¢åµãƒãƒ¼ãƒˆ */
        .detective-note {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            max-height: 200px;
            overflow-y: auto;
        }

        .note-title {
            font-weight: bold;
            color: #8b4513;
            margin-bottom: 10px;
        }

        .clue-item {
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #666;
        }

        /* ãƒ’ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ  */
        .hint-button {
            background: #ffd700;
            color: #8b4513;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .hint-button:hover {
            background: #ffed4e;
            transform: translateY(-1px);
        }

        .hint-text {
            margin-top: 10px;
            padding: 10px;
            background: #fffacd;
            border-radius: 5px;
            font-size: 0.9em;
            color: #8b4513;
            display: none;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .stick-figure-area {
                min-height: 300px;
            }
            
            #gameCanvas {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
    <div class="start-screen" id="startScreen">
        <div class="start-content">
            <h1 class="start-title">å°ç¥æ¼”ç¾©ã®è¬</h1>
            <p class="start-description">
                ç«æŸ´äººæ¢åµã¨ãªã£ã¦ã€å°ç¥æ¼”ç¾©ã®ä¸–ç•Œã‚’æ¢ç´¢ã—ã‚ˆã†ï¼<br>
                ç¥ã€…ã¨å¦–æ€ªã®æˆ¦ã„ã€è‹±é›„ãŸã¡ã®å†’é™ºã‚’è§£ãæ˜ã‹ã›ï¼
            </p>
            <button class="start-button" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="game-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="game-header">
            <h1 class="game-title">å°ç¥æ¼”ç¾©ãƒŸã‚¹ãƒ†ãƒªãƒ¼</h1>
            <p class="game-subtitle">ç«æŸ´äººæ¢åµã®ç¥è©±èª¿æŸ»</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <div class="game-area">
            <!-- ç«æŸ´äººã‚­ãƒ£ãƒ³ãƒã‚¹ -->
            <div class="stick-figure-area">
                <canvas id="gameCanvas"></canvas>
            </div>

            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
            <div class="content-area" id="contentArea">
                <h2 class="chapter-title" id="chapterTitle">ç¬¬ä¸€ç« ï¼šç´‚ç‹ã¨å¥³åª§</h2>
                <div class="text-display" id="textDisplay">
                    <p>ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¦ãã ã•ã„...</p>
                </div>
                <div class="puzzle-area" id="puzzleArea" style="display: none;">
                    <div class="puzzle-question" id="puzzleQuestion"></div>
                    <div class="puzzle-options" id="puzzleOptions"></div>
                    <button class="hint-button" onclick="showHint()">ãƒ’ãƒ³ãƒˆ (-10ç‚¹)</button>
                    <div class="hint-text" id="hintText"></div>
                </div>
            </div>
        </div>

        <!-- ãƒœãƒˆãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="bottom-controls">
            <div class="score-display">ã‚¹ã‚³ã‚¢: <span id="scoreValue">0</span></div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <a href="chinese-mythology-index.html" class="home-button">ãƒ›ãƒ¼ãƒ </a>
        </div>
    </div>

    <!-- æ¢åµãƒãƒ¼ãƒˆ -->
    <div class="detective-note">
        <div class="note-title">ğŸ” æ¢åµãƒãƒ¼ãƒˆ</div>
        <div id="cluesList"></div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">ç« ã‚¯ãƒªã‚¢ï¼</h2>
            <p class="modal-message" id="modalMessage">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
            <button class="modal-button" onclick="closeModal()">ç¶šã‘ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        const gameState = {
            currentChapter: 0,
            currentPuzzle: 0,
            totalPuzzles: 3,
            completedPuzzles: 0,
            score: 0,
            clues: [],
            solvedPuzzles: [],
            animations: {},
            chapters: []
        };

        // å°ç¥æ¼”ç¾©ã®ç« ãƒ‡ãƒ¼ã‚¿
        const fengshenChapters = [
            {
                id: 1,
                title: "ç¬¬ä¸€å›ï¼šç´‚ç‹é¡Œè©©",
                content: `
                    <p>æ®·æœã®ç¬¬ä¸‰åä»£çš‡å¸ãƒ»ç´‚ç‹ã¯ã€æ–‡æ­¦ä¸¡é“ã«å„ªã‚Œã€åŠ›ã¯åƒæ–¤ã‚’æŒ™ã’ã‚‹ã“ã¨ãŒã§ãã‚‹è‹±å‚‘ã§ã‚ã£ãŸã€‚</p>
                    <p>ã‚ã‚‹å¹´ã®ä¸‰æœˆåäº”æ—¥ã€å¥³åª§è–æ¯ã®èª•ç”Ÿæ—¥ã«ã€ç´‚ç‹ã¯ç¾¤è‡£ã‚’å¾“ãˆã¦å¥³åª§å®®ã«å‚æ‹ã—ãŸã€‚</p>
                    <p>ç´‚ç‹ãŒå®®æ®¿ã«å…¥ã‚‹ã¨ã€å¥³åª§ã®ç¥åƒã®ç¾ã—ã•ã«å¿ƒã‚’å¥ªã‚ã‚ŒãŸã€‚ç´‚ç‹ã¯ç­†ã‚’å–ã‚Šã€å®®æ®¿ã®å£ã«ä¸æ•¬ãªè©©ã‚’é¡Œã—ãŸã€‚</p>
                    <p>ã“ã®ä¸æ•¬ãªè©©ãŒã€æ®·æœå…­ç™¾å¹´ã®åŸºæ¥­ã‚’æ»…ã¼ã™åŸå› ã¨ãªã‚‹ã“ã¨ã‚’ã€ç´‚ç‹ã¯ã¾ã çŸ¥ã‚‰ãªã‹ã£ãŸ...</p>
                `,
                puzzles: [
                    {
                        type: 'character_identification',
                        question: 'ç´‚ç‹ã¯ã©ã®ã‚ˆã†ãªäººç‰©ã¨ã—ã¦æã‹ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ',
                        options: [
                            'æ–‡æ­¦ä¸¡é“ã«å„ªã‚Œã€åƒæ–¤ã®åŠ›ã‚’æŒã¤è‹±å‚‘',
                            'å¼±ãè‡†ç—…ãªæš´å›',
                            'è©©ã¨éŸ³æ¥½ã ã‘ã‚’æ„›ã™ã‚‹æ–‡äºº',
                            'å¥³åª§ã‚’æ·±ãä¿¡ä»°ã™ã‚‹è–äººå›å­'
                        ],
                        correct: 0,
                        hint: 'ç´‚ç‹ã®èƒ½åŠ›ã«ã¤ã„ã¦æœ€åˆã®æ®µè½ã‚’èª­ã¿è¿”ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚'
                    },
                    {
                        type: 'event_sequence',
                        question: 'ç´‚ç‹ãŒå¥³åª§å®®ã§è¡Œã£ãŸè¡Œå‹•ã¯ï¼Ÿ',
                        options: [
                            'å¥³åª§åƒã‚’ç ´å£Šã—ãŸ',
                            'å£ã«ä¸æ•¬ãªè©©ã‚’æ›¸ã„ãŸ',
                            'å¥³åª§ã«ç¥ˆã‚Šã‚’æ§ã’ãŸ',
                            'å®®æ®¿ã‚’ç‡ƒã‚„ã—ãŸ'
                        ],
                        correct: 1,
                        hint: 'ç´‚ç‹ãŒç­†ã‚’å–ã£ã¦ä½•ã‚’ã—ãŸã‹æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'consequence_prediction',
                        question: 'ã“ã®å‡ºæ¥äº‹ã¯ä½•ã‚’ã‚‚ãŸã‚‰ã™ã“ã¨ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ',
                        options: [
                            'æ®·æœã®ç¹æ „',
                            'ç´‚ç‹ã®æ”¹å¿ƒ',
                            'æ®·æœå…­ç™¾å¹´ã®åŸºæ¥­ã®æ»…äº¡',
                            'å¥³åª§ã®ç¥ç¦'
                        ],
                        correct: 2,
                        hint: 'æœ€å¾Œã®æ®µè½ã«é‡è¦ãªäºˆè¨€ãŒã‚ã‚Šã¾ã™ã€‚'
                    }
                ]
            },
            {
                id: 2,
                title: "ç¬¬äºŒå›ï¼šå¦²å·±å…¥å®®",
                content: `
                    <p>å¥³åª§è–æ¯ã¯ç´‚ç‹ã®ä¸æ•¬ãªè©©ã‚’çŸ¥ã‚Šã€æ¿€æ€’ã—ãŸã€‚å½¼å¥³ã¯è»’è½…å¢³ã®åƒå¹´ç‹ç‹¸ç²¾ã€ä¹é ­é›‰é¶ç²¾ã€ç‰çŸ³çµç¶ç²¾ã®ä¸‰å¦–ã‚’å¬å–šã—ãŸã€‚</p>
                    <p>ã€Œç´‚ç‹ã¯ç„¡é“ã«ã—ã¦ã€ç”ŸéœŠã‚’å¡—ç‚­ã®è‹¦ã—ã¿ã«é™¥ã‚Œã¦ã„ã‚‹ã€‚æ±ã‚‰ä¸‰å¦–ã¯äººé–“ç•Œã«ä¸‹ã‚Šã€ç´‚ç‹ã‚’æƒ‘ã‚ã—ã¦æ®·æœã‚’æ»…ã¼ã™ãŒã‚ˆã„ã€‚ã€</p>
                    <p>åƒå¹´ç‹ç‹¸ç²¾ã¯å†€å·ä¾¯è˜‡è­·ã®å¨˜ãƒ»å¦²å·±ã«åŒ–èº«ã—ã€ãã®ç¾è²Œã§ç´‚ç‹ã‚’é­…äº†ã—ãŸã€‚</p>
                    <p>å¦²å·±ã®é€²è¨€ã«ã‚ˆã‚Šã€ç´‚ç‹ã¯ç‚®çƒ™ã®åˆ‘ã€è †ç›†ã®åˆ‘ãªã©ã®æ®‹é…·ãªåˆ‘ç½°ã‚’ä½œã‚Šã€å¿ è‡£ã‚’æ¬¡ã€…ã¨å‡¦åˆ‘ã—ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'creature_identification',
                        question: 'å¥³åª§ãŒå¬å–šã—ãŸä¸‰å¦–ã®ç­†é ­ã¯ï¼Ÿ',
                        options: [
                            'ä¹å°¾ã®ç‹',
                            'åƒå¹´ç‹ç‹¸ç²¾',
                            'ç™½éª¨ç²¾',
                            'ç‰›é­”ç‹'
                        ],
                        correct: 1,
                        hint: 'è»’è½…å¢³ã‹ã‚‰æ¥ãŸå¦–æ€ªã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'transformation_puzzle',
                        question: 'åƒå¹´ç‹ç‹¸ç²¾ã¯èª°ã«åŒ–èº«ã—ã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'å¥³åª§è–æ¯',
                            'ç‹å¦ƒ',
                            'è˜‡è­·ã®å¨˜ãƒ»å¦²å·±',
                            'å®®å¥³'
                        ],
                        correct: 2,
                        hint: 'å†€å·ä¾¯ã®å¨˜ã®åå‰ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'consequence_analysis',
                        question: 'å¦²å·±ã®å½±éŸ¿ã§ç´‚ç‹ãŒä½œã£ãŸåˆ‘ç½°ã¯ï¼Ÿ',
                        options: [
                            'ç‚®çƒ™ã®åˆ‘ã¨è †ç›†ã®åˆ‘',
                            'æ–¬é¦–åˆ‘ã®ã¿',
                            'è¿½æ”¾åˆ‘',
                            'ç½°é‡‘åˆ‘'
                        ],
                        correct: 0,
                        hint: 'æ®‹é…·ãªåˆ‘ç½°ã®åå‰ãŒäºŒã¤æŒ™ã’ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚'
                    }
                ]
            },
            {
                id: 3,
                title: "ç¬¬ä¸‰å›ï¼šå§œå­ç‰™ä¸‹å±±",
                content: `
                    <p>å´‘å´™å±±ã®ç‰è™šå®®ã§ã€å…ƒå§‹å¤©å°Šã®å¼Ÿå­ãƒ»å§œå­ç‰™ã¯å››åå¹´ã®ä¿®è¡Œã‚’çµ‚ãˆãŸã€‚</p>
                    <p>å…ƒå§‹å¤©å°Šã¯å§œå­ç‰™ã‚’å‘¼ã³ã€ã€Œæ±ã¯ä»™éª¨ãªãã€äººé–“ç•Œã§åŠŸã‚’ç«‹ã¦ã‚‹ã¹ã—ã€‚å‘¨ã®æ–‡ç‹ã‚’åŠ©ã‘ã€æ®·ã‚’æ»…ã¼ã—ã€å°ç¥ã®å¤§æ¥­ã‚’æˆå°±ã›ã‚ˆã€ã¨å‘½ã˜ãŸã€‚</p>
                    <p>å§œå­ç‰™ã¯å¸«ã®å‘½ã‚’å—ã‘ã€æ‰“ç¥é­ã¨æé»„æ——ã‚’è³œã‚Šã€å±±ã‚’ä¸‹ã‚ŠãŸã€‚</p>
                    <p>æ¸­æ°´ã®ã»ã¨ã‚Šã§é‡£ã‚Šã‚’ã—ãªãŒã‚‰ã€æ–‡ç‹ã¨ã®å‡ºä¼šã„ã‚’å¾…ã¤å§œå­ç‰™ã€‚ãã®é‡£ã‚Šé‡ã¯çœŸã£ç›´ãã§ã€é¤Œã‚‚ã¤ã‘ã¦ã„ãªã‹ã£ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'character_mission',
                        question: 'å§œå­ç‰™ãŒå…ƒå§‹å¤©å°Šã‹ã‚‰å—ã‘ãŸä½¿å‘½ã¯ï¼Ÿ',
                        options: [
                            'ä»™äººã«ãªã‚‹ã“ã¨',
                            'å´‘å´™å±±ã‚’å®ˆã‚‹ã“ã¨',
                            'å‘¨ã®æ–‡ç‹ã‚’åŠ©ã‘ã¦å°ç¥ã®å¤§æ¥­ã‚’æˆå°±ã™ã‚‹ã“ã¨',
                            'ç´‚ç‹ã‚’æ”¹å¿ƒã•ã›ã‚‹ã“ã¨'
                        ],
                        correct: 2,
                        hint: 'å…ƒå§‹å¤©å°Šã®å‘½ä»¤ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'artifact_identification',
                        question: 'å§œå­ç‰™ãŒæˆã‹ã£ãŸå®ç‰©ã¯ï¼Ÿ',
                        options: [
                            'æ‰“ç¥é­ã¨æé»„æ——',
                            'å¤ªæ¥µå›³ã¨ç›¤å¤æ–§',
                            'å¦‚æ„æ£’ã¨ç·Šç®å’’',
                            'èŠ­è•‰æ‰‡ã¨ç‰æµ„ç“¶'
                        ],
                        correct: 0,
                        hint: 'å¸«ã‹ã‚‰è³œã£ãŸäºŒã¤ã®å®ç‰©ã®åå‰ã‚’æ¢ã—ã¾ã—ã‚‡ã†ã€‚'
                    },
                    {
                        type: 'symbolic_action',
                        question: 'å§œå­ç‰™ã®é‡£ã‚Šã®ç‰¹å¾´ã¯ï¼Ÿ',
                        options: [
                            'é‡‘ã®é‡£ã‚Šé‡ã‚’ä½¿ã£ã¦ã„ãŸ',
                            'é‡£ã‚Šé‡ãŒçœŸã£ç›´ãã§é¤Œã‚‚ãªã„',
                            'å¤œã ã‘é‡£ã‚Šã‚’ã—ã¦ã„ãŸ',
                            'é­šã§ã¯ãªãé¾ã‚’é‡£ã‚ã†ã¨ã—ã¦ã„ãŸ'
                        ],
                        correct: 1,
                        hint: 'æ™®é€šã®é‡£ã‚Šã¨ã¯é•ã†ç‚¹ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            },
            {
                id: 4,
                title: "ç¬¬å››å›ï¼šå“ªå’å‡ºä¸–",
                content: `
                    <p>é™³å¡˜é–¢ã®ç·å…µãƒ»æé–ã®å¤«äººã¯ä¸‰å¹´å…­ãƒ¶æœˆã®æ‡èƒã®æœ«ã€è‚‰çƒã‚’ç”£ã‚“ã ã€‚</p>
                    <p>æé–ãŒå‰£ã§è‚‰çƒã‚’åˆ‡ã‚‹ã¨ã€ä¸­ã‹ã‚‰ç´…ã„å…‰ã¨å…±ã«ç”·ã®å­ãŒç¾ã‚ŒãŸã€‚ã“ã‚ŒãŒå“ªå’ã§ã‚ã‚‹ã€‚</p>
                    <p>å¤ªä¹™çœŸäººãŒç¾ã‚Œã€ã€Œã“ã®å­ã¯éœŠç å­ã®ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šã§ã€å°†æ¥å°ç¥ã®å¤§æ¥­ã«åŠŸã‚’ç«‹ã¦ã‚‹ã€ã¨äºˆè¨€ã—ã€å“ªå’ã¨åä»˜ã‘ãŸã€‚</p>
                    <p>ä¸ƒæ­³ã®æ™‚ã€å“ªå’ã¯æ±æµ·ã§æ°´æµ´ã³ã‚’ã—ã€æ··å¤©ç¶¾ã§æµ·ã‚’æºã‚‰ã—ã¦é¾å®®ã‚’éœ‡å‹•ã•ã›ã€æ±æµ·é¾ç‹ã®ä¸‰å¤ªå­ãƒ»æ•–ä¸™ã¨æˆ¦ã„ã«ãªã£ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'birth_mystery',
                        question: 'å“ªå’ã®èª•ç”Ÿã®ç‰¹ç•°ãªç‚¹ã¯ï¼Ÿ',
                        options: [
                            'é›·ã¨å…±ã«ç”Ÿã¾ã‚ŒãŸ',
                            'ä¸‰å¹´å…­ãƒ¶æœˆã®æ‡èƒå¾Œã€è‚‰çƒã‹ã‚‰ç”Ÿã¾ã‚ŒãŸ',
                            'è“®ã®èŠ±ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸ',
                            'çŸ³ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸ'
                        ],
                        correct: 1,
                        hint: 'æ¯è¦ªã®æ‡èƒæœŸé–“ã¨ç”Ÿã¾ã‚ŒãŸæ™‚ã®æ§˜å­ã«æ³¨ç›®ã€‚'
                    },
                    {
                        type: 'prophecy_puzzle',
                        question: 'å¤ªä¹™çœŸäººã¯å“ªå’ã«ã¤ã„ã¦ä½•ã¨äºˆè¨€ã—ãŸï¼Ÿ',
                        options: [
                            'ä¸–ç•Œã‚’æ»…ã¼ã™é­”ç‹ã«ãªã‚‹',
                            'ä»™äººã«ãªã£ã¦å¤©ã«æ˜‡ã‚‹',
                            'éœŠç å­ã®ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šã§å°ç¥ã®å¤§æ¥­ã«åŠŸã‚’ç«‹ã¦ã‚‹',
                            'æ™®é€šã®äººé–“ã¨ã—ã¦ç”Ÿãã‚‹'
                        ],
                        correct: 2,
                        hint: 'å¤ªä¹™çœŸäººã®è¨€è‘‰ã‚’æ³¨æ„æ·±ãèª­ã‚“ã§ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'conflict_origin',
                        question: 'å“ªå’ã¨é¾ç‹ã®äº‰ã„ã®åŸå› ã¯ï¼Ÿ',
                        options: [
                            'å“ªå’ãŒé¾ç‹ã‚’ä¾®è¾±ã—ãŸ',
                            'æ··å¤©ç¶¾ã§æµ·ã‚’æºã‚‰ã—ã¦é¾å®®ã‚’éœ‡å‹•ã•ã›ãŸ',
                            'é¾ç‹ã®å®ç‰©ã‚’ç›—ã‚“ã ',
                            'é¾ç‹ã®å¨˜ã‚’èª˜æ‹ã—ãŸ'
                        ],
                        correct: 1,
                        hint: 'æ±æµ·ã§ã®æ°´æµ´ã³ã®éš›ã«ä½•ãŒèµ·ããŸã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚'
                    }
                ]
            },
            {
                id: 5,
                title: "ç¬¬äº”å›ï¼šé»„é£›è™åå•†",
                content: `
                    <p>æ­¦æˆç‹ãƒ»é»„é£›è™ã¯æ®·æœã®é‡è‡£ã§ã€ä¸ƒä»£ã«ã‚ãŸã£ã¦æ®·ã«ä»•ãˆãŸå¿ è‡£ã®å®¶ç³»ã§ã‚ã£ãŸã€‚</p>
                    <p>ã‚ã‚‹æ—¥ã€é»„é£›è™ã®å¦»ãƒ»è³ˆæ°ãŒå¦¹ã®é»„å¦ƒã‚’è¦‹èˆã†ãŸã‚å®®ä¸­ã«å…¥ã£ãŸã€‚å¦²å·±ã¯è³ˆæ°ã®ç¾è²Œã«å«‰å¦¬ã—ã€ç´‚ç‹ã‚’å”†ã—ã¦è³ˆæ°ã‚’é™µè¾±ã•ã›ã‚ˆã†ã¨ã—ãŸã€‚</p>
                    <p>è³ˆæ°ã¯è²ç¯€ã‚’å®ˆã‚‹ãŸã‚ã€æ‘˜æ˜Ÿæ¥¼ã‹ã‚‰èº«ã‚’æŠ•ã’ã¦è‡ªæ®ºã—ãŸã€‚ã•ã‚‰ã«é»„å¦ƒã‚‚å¦²å·±ã®é™°è¬€ã§æ®ºã•ã‚ŒãŸã€‚</p>
                    <p>å¦»ã¨å¦¹ã‚’å¤±ã£ãŸé»„é£›è™ã¯ã€ã¤ã„ã«æ®·æœã«èƒŒãã€å®¶æ—ã¨éƒ¨ä¸‹ã‚’ç‡ã„ã¦è¥¿å²ã¸æŠ•é™ã—ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'character_background',
                        question: 'é»„é£›è™ã®æ®·æœã§ã®åœ°ä½ã¯ï¼Ÿ',
                        options: [
                            'ä¸€èˆ¬ã®å…µå£«',
                            'æ­¦æˆç‹ã§ä¸ƒä»£ã«ã‚ãŸã‚‹å¿ è‡£ã®å®¶ç³»',
                            'å•†äºº',
                            'é“å£«'
                        ],
                        correct: 1,
                        hint: 'é»„é£›è™ã®ç§°å·ã¨å®¶ç³»ã«ã¤ã„ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'tragedy_cause',
                        question: 'è³ˆæ°ãŒè‡ªæ®ºã—ãŸç†ç”±ã¯ï¼Ÿ',
                        options: [
                            'ç—…æ°—ã‚’è‹¦ã«ã—ã¦',
                            'è²ç¯€ã‚’å®ˆã‚‹ãŸã‚',
                            'é»„é£›è™ã«å‘½ã˜ã‚‰ã‚Œã¦',
                            'äº‹æ•…ã ã£ãŸ'
                        ],
                        correct: 1,
                        hint: 'å¦²å·±ã®é™°è¬€ã¨è³ˆæ°ã®è¡Œå‹•ã®ç†ç”±ã‚’èª­ã¿å–ã‚Šã¾ã—ã‚‡ã†ã€‚'
                    },
                    {
                        type: 'turning_point',
                        question: 'é»„é£›è™ãŒæ®·æœã«èƒŒã„ãŸæœ€çµ‚çš„ãªç†ç”±ã¯ï¼Ÿ',
                        options: [
                            'å‡ºä¸–ã§ããªã‹ã£ãŸã‹ã‚‰',
                            'è³„è³‚ã‚’ã‚‚ã‚‰ã£ãŸã‹ã‚‰',
                            'å¦»ã¨å¦¹ã‚’å¤±ã£ãŸã‹ã‚‰',
                            'æˆ¦ã„ã«è² ã‘ãŸã‹ã‚‰'
                        ],
                        correct: 2,
                        hint: 'å®¶æ—ã«ä½•ãŒèµ·ããŸã‹ã€ãã®çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            }
        ];

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®åˆæœŸåŒ–
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
        let animationFrame = 0;
        let currentAnimation = 'detective';

        // ç«æŸ´äººæç”»é–¢æ•°
        function drawStickFigure(x, y, type = 'detective', frame = 0, scale = 1) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.strokeStyle = type === 'detective' ? '#2c1810' : '#8b4513';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';

            // é ­
            ctx.beginPath();
            ctx.arc(0, -30, 15, 0, Math.PI * 2);
            ctx.stroke();

            if (type === 'detective') {
                // æ¢åµã®å¸½å­
                ctx.beginPath();
                ctx.moveTo(-20, -35);
                ctx.lineTo(20, -35);
                ctx.lineTo(15, -45);
                ctx.lineTo(-15, -45);
                ctx.closePath();
                ctx.stroke();

                // è™«çœ¼é¡
                ctx.beginPath();
                ctx.arc(25, -10, 8, 0, Math.PI * 2);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(31, -4);
                ctx.lineTo(40, 5);
                ctx.stroke();
            }

            // ä½“
            ctx.beginPath();
            ctx.moveTo(0, -15);
            ctx.lineTo(0, 20);
            ctx.stroke();

            // è…•ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            const armAngle = Math.sin(frame * 0.1) * 0.3;
            
            // å·¦è…•
            ctx.beginPath();
            ctx.moveTo(0, -5);
            ctx.lineTo(-15, 5);
            ctx.lineTo(-10 + Math.sin(frame * 0.1 + Math.PI) * 5, 20);
            ctx.stroke();

            // å³è…•
            ctx.beginPath();
            ctx.moveTo(0, -5);
            ctx.lineTo(15, 5);
            ctx.lineTo(10 + Math.sin(frame * 0.1) * 5, 20);
            ctx.stroke();

            // è„šï¼ˆæ­©è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            const legAngle = Math.sin(frame * 0.15) * 0.5;
            
            // å·¦è„š
            ctx.beginPath();
            ctx.moveTo(0, 20);
            ctx.lineTo(-10 + Math.sin(frame * 0.15) * 10, 40);
            ctx.lineTo(-15 + Math.sin(frame * 0.15) * 15, 60);
            ctx.stroke();

            // å³è„š
            ctx.beginPath();
            ctx.moveTo(0, 20);
            ctx.lineTo(10 + Math.sin(frame * 0.15 + Math.PI) * 10, 40);
            ctx.lineTo(15 + Math.sin(frame * 0.15 + Math.PI) * 15, 60);
            ctx.stroke();

            ctx.restore();
        }

        // ç¥ç£ãƒ»ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æç”»
        function drawMythicalCreature(x, y, type, frame = 0) {
            ctx.save();
            ctx.translate(x, y);
            
            switch(type) {
                case 'fox_spirit': // ç‹ç‹¸ç²¾
                    ctx.strokeStyle = '#ff6b6b';
                    ctx.fillStyle = '#ff6b6b';
                    ctx.lineWidth = 2;
                    
                    // ä½“
                    ctx.beginPath();
                    ctx.ellipse(0, 0, 30, 20, 0, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ä¹å°¾
                    for (let i = 0; i < 9; i++) {
                        const angle = (Math.PI * 2 / 9) * i + frame * 0.02;
                        const tailX = Math.cos(angle) * 40;
                        const tailY = Math.sin(angle) * 40;
                        
                        ctx.beginPath();
                        ctx.moveTo(0, 0);
                        ctx.quadraticCurveTo(
                            tailX * 0.5 + Math.sin(frame * 0.1 + i) * 5,
                            tailY * 0.5,
                            tailX,
                            tailY
                        );
                        ctx.stroke();
                    }
                    
                    // é ­
                    ctx.beginPath();
                    ctx.arc(0, -25, 15, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // è€³
                    ctx.beginPath();
                    ctx.moveTo(-10, -35);
                    ctx.lineTo(-5, -45);
                    ctx.lineTo(0, -35);
                    ctx.moveTo(10, -35);
                    ctx.lineTo(5, -45);
                    ctx.lineTo(0, -35);
                    ctx.stroke();
                    break;
                    
                case 'nezha': // å“ªå’
                    ctx.strokeStyle = '#4a90e2';
                    ctx.lineWidth = 3;
                    
                    // ä½“
                    ctx.beginPath();
                    ctx.moveTo(0, -20);
                    ctx.lineTo(0, 10);
                    ctx.stroke();
                    
                    // é ­
                    ctx.beginPath();
                    ctx.arc(0, -30, 12, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // é¢¨ç«è¼ª
                    ctx.strokeStyle = '#ff6b6b';
                    ctx.beginPath();
                    ctx.arc(-15, 25, 8, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.arc(15, 25, 8, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // ç«ã®åŠ¹æœ
                    for (let i = 0; i < 5; i++) {
                        const flameHeight = Math.sin(frame * 0.2 + i) * 5 + 10;
                        ctx.beginPath();
                        ctx.moveTo(-15 + i * 7.5 - 15, 25);
                        ctx.lineTo(-15 + i * 7.5 - 15, 25 - flameHeight);
                        ctx.stroke();
                    }
                    
                    // è…•
                    ctx.strokeStyle = '#4a90e2';
                    ctx.beginPath();
                    ctx.moveTo(0, -10);
                    ctx.lineTo(-20, 0);
                    ctx.moveTo(0, -10);
                    ctx.lineTo(20, 0);
                    ctx.stroke();
                    break;
                    
                case 'jiang_ziya': // å§œå­ç‰™
                    ctx.strokeStyle = '#8b4513';
                    ctx.lineWidth = 2;
                    
                    // ãƒ­ãƒ¼ãƒ–
                    ctx.beginPath();
                    ctx.moveTo(0, -20);
                    ctx.lineTo(-15, 30);
                    ctx.lineTo(15, 30);
                    ctx.closePath();
                    ctx.stroke();
                    
                    // é ­
                    ctx.beginPath();
                    ctx.arc(0, -30, 12, 0, Math.PI * 2);
                    ctx.stroke();
                    
                    // é«­
                    ctx.beginPath();
                    ctx.moveTo(-5, -25);
                    ctx.quadraticCurveTo(-10, -20, -12, -15);
                    ctx.moveTo(5, -25);
                    ctx.quadraticCurveTo(10, -20, 12, -15);
                    ctx.stroke();
                    
                    // é‡£ã‚Šç«¿
                    ctx.beginPath();
                    ctx.moveTo(15, -10);
                    ctx.quadraticCurveTo(30, -20, 35, -5);
                    ctx.stroke();
                    
                    // é‡£ã‚Šç³¸
                    ctx.beginPath();
                    ctx.moveTo(35, -5);
                    ctx.lineTo(35, 10 + Math.sin(frame * 0.1) * 5);
                    ctx.stroke();
                    break;
            }
            
            ctx.restore();
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // èƒŒæ™¯
            ctx.fillStyle = 'rgba(255, 248, 220, 0.3)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æç”»
            if (currentAnimation === 'detective') {
                drawStickFigure(canvas.width / 2, canvas.height / 2 + 50, 'detective', animationFrame);
            } else if (currentAnimation === 'celebration') {
                // ç¥è³€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                drawStickFigure(canvas.width / 2, canvas.height / 2 + 50 - Math.abs(Math.sin(animationFrame * 0.1)) * 30, 'detective', animationFrame);
                
                // ç´™å¹é›ªåŠ¹æœ
                for (let i = 0; i < 10; i++) {
                    ctx.fillStyle = `hsl(${i * 36}, 70%, 50%)`;
                    ctx.fillRect(
                        canvas.width / 2 + Math.sin(animationFrame * 0.05 + i) * 100,
                        (animationFrame * 2 + i * 50) % canvas.height,
                        5,
                        10
                    );
                }
            } else if (currentAnimation === 'thinking') {
                drawStickFigure(canvas.width / 2, canvas.height / 2 + 50, 'detective', animationFrame);
                
                // æ€è€ƒãƒãƒ–ãƒ«
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(canvas.width / 2 + 50, canvas.height / 2 - 50, 30, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#333';
                ctx.font = '20px sans-serif';
                ctx.fillText('?', canvas.width / 2 + 45, canvas.height / 2 - 45);
            } else if (currentAnimation.includes('creature_')) {
                const creatureType = currentAnimation.replace('creature_', '');
                drawMythicalCreature(canvas.width / 2, canvas.height / 2, creatureType, animationFrame);
            }
            
            animationFrame++;
            requestAnimationFrame(animate);
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            gameState.chapters = fengshenChapters;
            loadChapter(0);
            animate();
        }

        // ç« ã®èª­ã¿è¾¼ã¿
        function loadChapter(chapterIndex) {
            if (chapterIndex >= gameState.chapters.length) {
                showGameComplete();
                return;
            }
            
            gameState.currentChapter = chapterIndex;
            gameState.currentPuzzle = 0;
            const chapter = gameState.chapters[chapterIndex];
            
            document.getElementById('chapterTitle').textContent = chapter.title;
            document.getElementById('textDisplay').innerHTML = chapter.content;
            document.getElementById('puzzleArea').style.display = 'none';
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¤‰æ›´
            currentAnimation = 'detective';
            
            // 2ç§’å¾Œã«æœ€åˆã®ãƒ‘ã‚ºãƒ«ã‚’è¡¨ç¤º
            setTimeout(() => {
                showPuzzle(0);
            }, 3000);
        }

        // ãƒ‘ã‚ºãƒ«è¡¨ç¤º
        function showPuzzle(puzzleIndex) {
            const chapter = gameState.chapters[gameState.currentChapter];
            const puzzle = chapter.puzzles[puzzleIndex];
            
            document.getElementById('puzzleArea').style.display = 'block';
            document.getElementById('puzzleQuestion').textContent = puzzle.question;
            document.getElementById('hintText').style.display = 'none';
            
            const optionsContainer = document.getElementById('puzzleOptions');
            optionsContainer.innerHTML = '';
            
            puzzle.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => checkAnswer(index, puzzle.correct);
                optionsContainer.appendChild(button);
            });
            
            currentAnimation = 'thinking';
        }

        // ç­”ãˆç¢ºèª
        function checkAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach(btn => btn.disabled = true);
            
            if (selected === correct) {
                buttons[selected].classList.add('correct');
                gameState.score += 100;
                gameState.completedPuzzles++;
                currentAnimation = 'celebration';
                
                // æ‰‹ãŒã‹ã‚Šã‚’è¿½åŠ 
                addClue(`âœ“ ${gameState.chapters[gameState.currentChapter].title} - ãƒ‘ã‚ºãƒ«${gameState.currentPuzzle + 1}ã‚¯ãƒªã‚¢`);
                
                setTimeout(() => {
                    nextPuzzle();
                }, 2000);
            } else {
                buttons[selected].classList.add('wrong');
                buttons[correct].classList.add('correct');
                gameState.score = Math.max(0, gameState.score - 20);
                
                setTimeout(() => {
                    buttons.forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('wrong', 'correct');
                    });
                    currentAnimation = 'detective';
                }, 2000);
            }
            
            updateScore();
            updateProgress();
        }

        // æ¬¡ã®ãƒ‘ã‚ºãƒ«
        function nextPuzzle() {
            gameState.currentPuzzle++;
            
            if (gameState.currentPuzzle >= gameState.totalPuzzles) {
                // ç« ã‚¯ãƒªã‚¢
                showChapterComplete();
            } else {
                showPuzzle(gameState.currentPuzzle);
            }
        }

        // ç« ã‚¯ãƒªã‚¢è¡¨ç¤º
        function showChapterComplete() {
            gameState.score += 300; // ãƒœãƒ¼ãƒŠã‚¹ãƒã‚¤ãƒ³ãƒˆ
            updateScore();
            
            document.getElementById('modalTitle').textContent = 'ç« ã‚¯ãƒªã‚¢ï¼';
            document.getElementById('modalMessage').textContent = `${gameState.chapters[gameState.currentChapter].title}ã‚’å®Œäº†ã—ã¾ã—ãŸï¼\nãƒœãƒ¼ãƒŠã‚¹: +300ç‚¹`;
            document.getElementById('modal').classList.add('active');
            
            currentAnimation = 'celebration';
        }

        // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function showGameComplete() {
            document.getElementById('modalTitle').textContent = 'ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼';
            document.getElementById('modalMessage').textContent = `ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼\nå…¨ã¦ã®ç« ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼\næœ€çµ‚ã‚¹ã‚³ã‚¢: ${gameState.score}ç‚¹`;
            document.getElementById('modal').classList.add('active');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            loadChapter(gameState.currentChapter + 1);
        }

        // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
        function showHint() {
            const chapter = gameState.chapters[gameState.currentChapter];
            const puzzle = chapter.puzzles[gameState.currentPuzzle];
            
            document.getElementById('hintText').textContent = puzzle.hint;
            document.getElementById('hintText').style.display = 'block';
            
            gameState.score = Math.max(0, gameState.score - 10);
            updateScore();
        }

        // ã‚¹ã‚³ã‚¢æ›´æ–°
        function updateScore() {
            document.getElementById('scoreValue').textContent = gameState.score;
        }

        // é€²æ—æ›´æ–°
        function updateProgress() {
            const totalPuzzles = gameState.chapters.length * gameState.totalPuzzles;
            const progress = (gameState.completedPuzzles / totalPuzzles) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        // æ‰‹ãŒã‹ã‚Šè¿½åŠ 
        function addClue(clue) {
            gameState.clues.push(clue);
            const cluesList = document.getElementById('cluesList');
            const clueItem = document.createElement('div');
            clueItem.className = 'clue-item';
            clueItem.textContent = clue;
            cluesList.appendChild(clueItem);
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        window.addEventListener('resize', () => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        });

        // åˆæœŸåŒ–
        updateScore();
        updateProgress();
    </script>
</body>
</html>