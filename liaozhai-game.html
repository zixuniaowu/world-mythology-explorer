<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠæ–å¿—ç•°ãƒŸã‚¹ãƒ†ãƒªãƒ¼ - ç«æŸ´äººæ¢åµã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f5f3e9;
            color: #2c1810;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ */
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .game-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(255,255,255,0.8), rgba(255,255,255,0));
        }

        .game-title {
            font-size: 2.5em;
            color: #8b4513;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .game-subtitle {
            font-size: 1.2em;
            color: #666;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* ç«æŸ´äººã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¨ãƒªã‚¢ */
        .stick-figure-area {
            background: white;
            border: 3px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            min-height: 400px;
        }

        #gameCanvas {
            width: 100%;
            height: 400px;
            border: 1px dashed #ddd;
            cursor: pointer;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ‘ã‚ºãƒ«ã‚¨ãƒªã‚¢ */
        .content-area {
            background: white;
            border: 3px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
            max-height: 600px;
        }

        /* ç« ã‚¿ã‚¤ãƒˆãƒ« */
        .chapter-title {
            font-size: 1.8em;
            color: #8b4513;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b4513;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .text-display {
            background: #fefefe;
            padding: 15px;
            border-left: 4px solid #d4a574;
            margin-bottom: 20px;
            font-size: 1.1em;
            line-height: 1.8;
        }

        .text-display p {
            margin-bottom: 10px;
        }

        /* ãƒ‘ã‚ºãƒ«ã‚¨ãƒªã‚¢ */
        .puzzle-area {
            background: #f9f7f3;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .puzzle-question {
            font-size: 1.3em;
            color: #8b4513;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .puzzle-options {
            display: grid;
            gap: 10px;
        }

        .option-button {
            background: white;
            border: 2px solid #d4a574;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            text-align: left;
        }

        .option-button:hover {
            background: #fff8dc;
            border-color: #8b4513;
            transform: translateX(5px);
        }

        .option-button.correct {
            background: #90ee90;
            border-color: #228b22;
        }

        .option-button.wrong {
            background: #ffcccb;
            border-color: #dc143c;
        }

        /* ãƒœãƒˆãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .bottom-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #8b4513;
        }

        /* ã‚¹ã‚³ã‚¢è¡¨ç¤º */
        .score-display {
            font-size: 1.3em;
            color: #8b4513;
            font-weight: bold;
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-container {
            flex: 1;
            margin: 0 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8b4513, #d4a574);
            transition: width 0.5s ease;
            width: 0%;
        }

        /* ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ */
        .home-button {
            background: #8b4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .home-button:hover {
            background: #8b4513;
            transform: translateY(-2px);
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .start-content {
            background: linear-gradient(135deg, #8b4513 0%, #8b4513 100%);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            color: white;
            max-width: 600px;
        }

        .start-title {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .start-description {
            font-size: 1.2em;
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .start-button {
            background: #FFD700;
            color: #8b4513;
            border: none;
            padding: 20px 40px;
            font-size: 1.5em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .start-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(255,215,0,0.5);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }

        .modal-title {
            font-size: 2em;
            color: #8b4513;
            margin-bottom: 20px;
        }

        .modal-message {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #666;
        }

        .modal-button {
            background: #8b4513;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .modal-button:hover {
            background: #8b4513;
            transform: translateY(-2px);
        }

        /* æ¢åµãƒãƒ¼ãƒˆ */
        .detective-note {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            max-height: 200px;
            overflow-y: auto;
        }

        .note-title {
            font-weight: bold;
            color: #8b4513;
            margin-bottom: 10px;
        }

        .clue-item {
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #666;
        }

        /* ãƒ’ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ  */
        .hint-button {
            background: #d4a574;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .hint-button:hover {
            background: #cd853f;
            transform: translateY(-1px);
        }

        .hint-text {
            margin-top: 10px;
            padding: 10px;
            background: #f9f7f3;
            border-radius: 5px;
            font-size: 0.9em;
            color: #8b4513;
            display: none;
        }

        /* å¹½éœŠã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        @keyframes ghostFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .stick-figure-area {
                min-height: 300px;
            }
            
            #gameCanvas {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
    <div class="start-screen" id="startScreen">
        <div class="start-content">
            <h1 class="start-title">èŠæ–å¿—ç•°ã®è¬</h1>
            <p class="start-description">
                ç«æŸ´äººæ¢åµã¨ãªã£ã¦ã€ç‹ä»™ã¨å¹½éœŠã®ä¸–ç•Œã‚’æ¢ç´¢ã—ã‚ˆã†ï¼<br>
                ä¸æ€è­°ãªç‰©èªã«éš ã•ã‚ŒãŸçœŸå®Ÿã‚’è§£ãæ˜ã‹ã›ï¼
            </p>
            <button class="start-button" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="game-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="game-header">
            <h1 class="game-title">èŠæ–å¿—ç•°ãƒŸã‚¹ãƒ†ãƒªãƒ¼</h1>
            <p class="game-subtitle">ç«æŸ´äººæ¢åµã®æ€ªç•°èª¿æŸ»</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <div class="game-area">
            <!-- ç«æŸ´äººã‚­ãƒ£ãƒ³ãƒã‚¹ -->
            <div class="stick-figure-area">
                <canvas id="gameCanvas"></canvas>
            </div>

            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
            <div class="content-area" id="contentArea">
                <h2 class="chapter-title" id="chapterTitle">ç¬¬ä¸€è©±ï¼šç”»çš®</h2>
                <div class="text-display" id="textDisplay">
                    <p>ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¦ãã ã•ã„...</p>
                </div>
                <div class="puzzle-area" id="puzzleArea" style="display: none;">
                    <div class="puzzle-question" id="puzzleQuestion"></div>
                    <div class="puzzle-options" id="puzzleOptions"></div>
                    <button class="hint-button" onclick="showHint()">ãƒ’ãƒ³ãƒˆ (-10ç‚¹)</button>
                    <div class="hint-text" id="hintText"></div>
                </div>
            </div>
        </div>

        <!-- ãƒœãƒˆãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="bottom-controls">
            <div class="score-display">ã‚¹ã‚³ã‚¢: <span id="scoreValue">0</span></div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <a href="chinese-mythology-index.html" class="home-button">ãƒ›ãƒ¼ãƒ </a>
        </div>
    </div>

    <!-- æ¢åµãƒãƒ¼ãƒˆ -->
    <div class="detective-note">
        <div class="note-title">ğŸ” æ¢åµãƒãƒ¼ãƒˆ</div>
        <div id="cluesList"></div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">ç‰©èªã‚¯ãƒªã‚¢ï¼</h2>
            <p class="modal-message" id="modalMessage">ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</p>
            <button class="modal-button" onclick="closeModal()">ç¶šã‘ã‚‹</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        const gameState = {
            currentChapter: 0,
            currentPuzzle: 0,
            totalPuzzles: 3,
            completedPuzzles: 0,
            score: 0,
            clues: [],
            solvedPuzzles: [],
            animations: {},
            chapters: []
        };

        // èŠæ–å¿—ç•°ã®ç‰©èªãƒ‡ãƒ¼ã‚¿
        const liaozhaiStories = [
            {
                id: 1,
                title: "ç”»çš®",
                content: `
                    <p>å¤ªåŸã®ç‹ç”Ÿã¯ã€é“ã§ç¾ã—ã„å¥³ã«å‡ºä¼šã£ãŸã€‚å¥³ã¯ã€Œç§ã¯äººã«è¿½ã‚ã‚Œã¦ã„ã¾ã™ã€ã¨åŠ©ã‘ã‚’æ±‚ã‚ãŸã€‚</p>
                    <p>ç‹ç”Ÿã¯å¥³ã‚’å®¶ã«é€£ã‚Œå¸°ã‚Šã€å¯†ã‹ã«åŒ¿ã£ãŸã€‚ã—ã‹ã—ã€é“å£«ãŒç‹ç”Ÿã®å®¶ã‚’è¨ªã‚Œã€ã€Œé‚ªæ°—ã‚’æ„Ÿã˜ã‚‹ã€ã¨è­¦å‘Šã—ãŸã€‚</p>
                    <p>ã‚ã‚‹å¤œã€ç‹ç”ŸãŒã“ã£ãã‚Šå¥³ã®éƒ¨å±‹ã‚’è¦—ãã¨ã€æã‚ã—ã„é¬¼ãŒäººã®çš®ã‚’å½©è‰²ã—ã¦ã„ãŸã€‚å¥³ã®æ­£ä½“ã¯ã€ç¾ã—ã„çš®ã‚’è¢«ã£ãŸæ‚ªé¬¼ã ã£ãŸã®ã ã€‚</p>
                    <p>ç‹ç”Ÿã¯ææ€–ã§é€ƒã’ã‚ˆã†ã¨ã—ãŸãŒã€æ‚ªé¬¼ã«è¦‹ã¤ã‹ã‚Šã€å¿ƒè‡“ã‚’æŠœãå–ã‚‰ã‚Œã¦æ­»ã‚“ã§ã—ã¾ã£ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'character_identity',
                        question: 'ç¾ã—ã„å¥³ã®æ­£ä½“ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'è¿·å­ã«ãªã£ãŸè²´æ—ã®å¨˜',
                            'ç¾ã—ã„çš®ã‚’è¢«ã£ãŸæ‚ªé¬¼',
                            'å¤‰èº«ã—ãŸç‹ä»™',
                            'å¤©ç•Œã‹ã‚‰é™ã‚Šã¦ããŸä»™å¥³'
                        ],
                        correct: 1,
                        hint: 'ç‹ç”ŸãŒå¤œã«ç›®æ’ƒã—ãŸæã‚ã—ã„å…‰æ™¯ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'warning_sign',
                        question: 'é“å£«ã¯ä½•ã‚’æ„Ÿã˜ã¦è­¦å‘Šã—ã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'é‡‘é‹ã®ä¸Šæ˜‡',
                            'å¹¸é‹ã®è¨ªã‚Œ',
                            'é‚ªæ°—ã®å­˜åœ¨',
                            'ç—…æ°—ã®å‰å…†'
                        ],
                        correct: 2,
                        hint: 'é“å£«ãŒç‹ç”Ÿã®å®¶ã‚’è¨ªã‚ŒãŸç†ç”±ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'tragic_ending',
                        question: 'ç‹ç”Ÿã®æœ€æœŸã¯ã©ã†ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'å¥³ã¨å¹¸ã›ã«æš®ã‚‰ã—ãŸ',
                            'é“å£«ã«æ•‘ã‚ã‚ŒãŸ',
                            'å¿ƒè‡“ã‚’æŠœãå–ã‚‰ã‚Œã¦æ­»ã‚“ã ',
                            'é€ƒã’ã‚‹ã“ã¨ã«æˆåŠŸã—ãŸ'
                        ],
                        correct: 2,
                        hint: 'æ‚ªé¬¼ã«è¦‹ã¤ã‹ã£ãŸå¾Œã®çµæœ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            },
            {
                id: 2,
                title: "è¶å°å€©",
                content: `
                    <p>æ›¸ç”Ÿã®å¯§é‡‡è‡£ã¯ã€é‡‘è¯ã®è’ã‚Œå¯ºã«å®¿æ³Šã—ãŸã€‚æ·±å¤œã€ç¾ã—ã„å¥³ãƒ»è¶å°å€©ãŒç¾ã‚ŒãŸã€‚</p>
                    <p>å°å€©ã¯ã€Œç§ã¯å¹½éœŠã§ã™ã€‚å¦–æ€ªã«æ“ã‚‰ã‚Œã¦ç”·ã‚’èª˜æƒ‘ã—ã¦ã„ã¾ã™ãŒã€ã‚ãªãŸã®æ­£ç›´ãªå¿ƒã«æ‰“ãŸã‚Œã¾ã—ãŸã€ã¨å‘Šç™½ã—ãŸã€‚</p>
                    <p>å¯§é‡‡è‡£ã¨å°å€©ã¯äº’ã„ã«æƒ¹ã‹ã‚Œåˆã£ãŸã€‚å°å€©ã¯ã€Œç§ã®éª¨ã‚’æ˜ã‚Šå‡ºã—ã¦ã€æ•…éƒ·ã«åŸ‹è‘¬ã—ã¦ãã ã•ã„ã€ã¨é ¼ã‚“ã ã€‚</p>
                    <p>å¯§é‡‡è‡£ãŒå°å€©ã®é¡˜ã„ã‚’å¶ãˆã‚‹ã¨ã€å°å€©ã¯ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šã€äºŒäººã¯çµã°ã‚Œã¦å¹¸ã›ã«æš®ã‚‰ã—ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'character_confession',
                        question: 'è¶å°å€©ã¯è‡ªåˆ†ã«ã¤ã„ã¦ä½•ã¨å‘Šç™½ã—ã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'é€ƒäº¡ä¸­ã®è²´æ—ã®å¨˜',
                            'å¦–æ€ªã«æ“ã‚‰ã‚Œã¦ã„ã‚‹å¹½éœŠ',
                            'å¤©ç•Œã®ä»™å¥³',
                            'ç‹ã®åŒ–èº«'
                        ],
                        correct: 1,
                        hint: 'å°å€©ãŒå¯§é‡‡è‡£ã«æ‰“ã¡æ˜ã‘ãŸçœŸå®Ÿã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'request_puzzle',
                        question: 'å°å€©ã¯å¯§é‡‡è‡£ã«ä½•ã‚’é ¼ã¿ã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'ä¸€ç·’ã«é€ƒã’ã¦ã»ã—ã„',
                            'å¦–æ€ªã‚’é€€æ²»ã—ã¦ã»ã—ã„',
                            'éª¨ã‚’æ˜ã‚Šå‡ºã—ã¦æ•…éƒ·ã«åŸ‹è‘¬ã—ã¦ã»ã—ã„',
                            'æ‰‹ç´™ã‚’å±Šã‘ã¦ã»ã—ã„'
                        ],
                        correct: 2,
                        hint: 'å°å€©ãŒè§£æ”¾ã•ã‚Œã‚‹ãŸã‚ã«å¿…è¦ãªã“ã¨ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ'
                    },
                    {
                        type: 'happy_ending',
                        question: 'ç‰©èªã®çµæœ«ã¯ã©ã†ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'å°å€©ã¯æˆä»ã—ã¦æ¶ˆãˆãŸ',
                            'å¯§é‡‡è‡£ã¯å‘ªã‚ã‚ŒãŸ',
                            'äºŒäººã¯æ°¸é ã«åˆ¥ã‚ŒãŸ',
                            'å°å€©ã¯ç”Ÿã¾ã‚Œå¤‰ã‚ã‚ŠäºŒäººã¯çµã°ã‚ŒãŸ'
                        ],
                        correct: 3,
                        hint: 'é¡˜ã„ãŒå¶ã£ãŸå¾Œã®å±•é–‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            },
            {
                id: 3,
                title: "é’é³³",
                content: `
                    <p>æ›¸ç”Ÿã®è€¿å»ç—…ã¯ã€ç‹ä»™ã®å¨˜ãƒ»é’é³³ã¨å‡ºä¼šã„ã€æ‹ã«è½ã¡ãŸã€‚</p>
                    <p>é’é³³ã®å”çˆ¶ã¯äººé–“ã¨ã®äº¤éš›ã«åå¯¾ã—ã€ã€Œç‹æ—ã®æŸã‚’ç ´ã‚Œã°ã€é›·ã«æ‰“ãŸã‚Œã¦æ­»ã¬ã€ã¨è­¦å‘Šã—ãŸã€‚</p>
                    <p>ã—ã‹ã—é’é³³ã¯ã€Œæ„›ã™ã‚‹äººã®ãŸã‚ãªã‚‰ã€é›·ã«æ‰“ãŸã‚Œã¦ã‚‚æ§‹ã‚ãªã„ã€ã¨æ±ºæ„ã—ãŸã€‚</p>
                    <p>é’é³³ã®çœŸå¿ƒã«æ„Ÿå‹•ã—ãŸå¤©å¸ã¯ã€é’é³³ã‚’äººé–“ã«è»¢ç”Ÿã•ã›ã€äºŒäººã¯æ­£å¼ã«å¤«å©¦ã¨ãªã£ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'supernatural_identity',
                        question: 'é’é³³ã®æ­£ä½“ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'äººé–“ã®å¨˜',
                            'ç‹ä»™ã®å¨˜',
                            'é¾ã®åŒ–èº«',
                            'èŠ±ã®ç²¾éœŠ'
                        ],
                        correct: 1,
                        hint: 'é’é³³ã®å®¶æ—ã«ã¤ã„ã¦è¨€åŠã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ã«æ³¨ç›®ã€‚'
                    },
                    {
                        type: 'forbidden_love',
                        question: 'å”çˆ¶ãŒè­¦å‘Šã—ãŸç‹æ—ã®æŸã‚’ç ´ã£ãŸçµæœã¯ï¼Ÿ',
                        options: [
                            'æ°¸é ã®å¹¸ç¦',
                            'ä¸€æ—ã‹ã‚‰ã®è¿½æ”¾',
                            'é›·ã«æ‰“ãŸã‚Œã¦æ­»ã¬',
                            'è¨˜æ†¶ã‚’å¤±ã†'
                        ],
                        correct: 2,
                        hint: 'æŸã‚’ç ´ã‚‹ã“ã¨ã®æã‚ã—ã„çµæœã«ã¤ã„ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'divine_intervention',
                        question: 'å¤©å¸ã¯é’é³³ã®çœŸå¿ƒã«ã©ã†å¿œãˆã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'ç½°ã‚’ä¸ãˆãŸ',
                            'é’é³³ã‚’äººé–“ã«è»¢ç”Ÿã•ã›ãŸ',
                            'äºŒäººã‚’å¼•ãé›¢ã—ãŸ',
                            'ä½•ã‚‚ã—ãªã‹ã£ãŸ'
                        ],
                        correct: 1,
                        hint: 'ç‰©èªã®æœ€å¾Œã§å¤©å¸ãŒä¸‹ã—ãŸæ±ºå®šã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            },
            {
                id: 4,
                title: "å¬°å¯§",
                content: `
                    <p>ç‹å­æœã¯å±±ã§é“ã«è¿·ã„ã€ç¾ã—ã„å°‘å¥³ã«å‡ºä¼šã£ãŸã€‚å°‘å¥³ã¯å¬°å¯§ã¨åä¹—ã‚Šã€ã„ã¤ã‚‚ç¬‘ã£ã¦ã„ãŸã€‚</p>
                    <p>å¬°å¯§ã¯ç‹ã®é¤Šå¥³ã§ã€ç´”ç²‹ç„¡å¢ãªæ€§æ ¼ã ã£ãŸã€‚ç‹å­æœã¯å¬°å¯§ã®ç„¡é‚ªæ°—ãªç¬‘é¡”ã«å¿ƒã‚’å¥ªã‚ã‚ŒãŸã€‚</p>
                    <p>çµå©šå¾Œã‚‚å¬°å¯§ã¯ç¬‘ã„ç¶šã‘ãŸãŒã€ã‚ã‚‹æ—¥éš£äººã®ç„¡ç¤¼ãªç”·ã‚’æ‡²ã‚‰ã—ã‚ãŸå¾Œã€ã€Œã‚‚ã†ç¬‘ã‚ãªã„ã€ã¨è¨€ã£ãŸã€‚</p>
                    <p>ã€Œäººã®ä¸–ã¯è¤‡é›‘ã§ã€ã„ã¤ã‚‚ç¬‘ã£ã¦ã„ã¦ã¯ç”Ÿãã¦ã„ã‘ãªã„ã€ã¨æ‚Ÿã£ãŸå¬°å¯§ã¯ã€æ™®é€šã®äººé–“ã®å¦»ã¨ãªã£ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'character_trait',
                        question: 'å¬°å¯§ã®æœ€ã‚‚ç‰¹å¾´çš„ãªæ€§æ ¼ã¯ï¼Ÿ',
                        options: [
                            'ã„ã¤ã‚‚æ³£ã„ã¦ã„ã‚‹',
                            'ã„ã¤ã‚‚æ€’ã£ã¦ã„ã‚‹',
                            'ã„ã¤ã‚‚ç¬‘ã£ã¦ã„ã‚‹',
                            'ã„ã¤ã‚‚çœ ã£ã¦ã„ã‚‹'
                        ],
                        correct: 2,
                        hint: 'å¬°å¯§ã®åå‰ã¨å…±ã«èªã‚‰ã‚Œã‚‹ç‰¹å¾´ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'hidden_background',
                        question: 'å¬°å¯§ã®è‚²ã¡ã®èƒŒæ™¯ã¯ï¼Ÿ',
                        options: [
                            'è²´æ—ã®å®Ÿã®å¨˜',
                            'ç‹ã®é¤Šå¥³',
                            'å¤©ç•Œã®ä»™å¥³',
                            'å­¤å…é™¢ã§è‚²ã£ãŸ'
                        ],
                        correct: 1,
                        hint: 'å¬°å¯§ã®å‡ºè‡ªã«ã¤ã„ã¦èª¬æ˜ã•ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ã‚’ç¢ºèªã€‚'
                    },
                    {
                        type: 'character_growth',
                        question: 'å¬°å¯§ãŒç¬‘ã‚ãªããªã£ãŸç†ç”±ã¯ï¼Ÿ',
                        options: [
                            'ç—…æ°—ã«ãªã£ãŸã‹ã‚‰',
                            'å¤«ã«é£½ããŸã‹ã‚‰',
                            'äººã®ä¸–ã®è¤‡é›‘ã•ã‚’æ‚Ÿã£ãŸã‹ã‚‰',
                            'æ•…éƒ·ãŒæ‹ã—ããªã£ãŸã‹ã‚‰'
                        ],
                        correct: 2,
                        hint: 'éš£äººã®äº‹ä»¶å¾Œã®å¬°å¯§ã®è¨€è‘‰ã«æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            },
            {
                id: 5,
                title: "ç‹å…­éƒ",
                content: `
                    <p>æ¼å¸«ã®è¨±ã¯ã€ã„ã¤ã‚‚åŒã˜å ´æ‰€ã§é‡£ã‚Šã‚’ã—ã¦ã„ãŸã€‚ã‚ã‚‹æ—¥ã€æ°´ä¸­ã‹ã‚‰å£°ãŒã—ã¦ã€Œç§ã¯æººæ­»ã—ãŸç‹å…­éƒã§ã™ã€ã¨åä¹—ã£ãŸã€‚</p>
                    <p>ç‹å…­éƒã®éœŠã¯è¨±ã¨å‹äººã«ãªã‚Šã€é­šã‚’è¿½ã„è¾¼ã‚“ã§å¤§æ¼ã«ã—ã¦ãã‚ŒãŸã€‚è¨±ã¯ç‹å…­éƒã«é…’ã‚„é£Ÿã¹ç‰©ã‚’ä¾›ãˆãŸã€‚</p>
                    <p>ç‹å…­éƒã¯ã€Œã¾ã‚‚ãªãç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šã¾ã™ã€‚æ¥ä¸–ã§ã‚‚å‹äººã§ã„ã¾ã—ã‚‡ã†ã€ã¨å‘Šã’ã¦å»ã£ãŸã€‚</p>
                    <p>æ•°å¹´å¾Œã€è¨±ã¯ç‹å…­éƒã®ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šã¨å†ä¼šã—ã€å‰ä¸–ã®è¨˜æ†¶ã¯ãªã‹ã£ãŸãŒã€ä¸æ€è­°ãªç¸ã§è¦ªå‹ã¨ãªã£ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'spirit_identity',
                        question: 'ç‹å…­éƒã¯ä½•è€…ã§ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'æ²³ã®ç¥æ§˜',
                            'æººæ­»ã—ãŸäººã®éœŠ',
                            'é¾ç‹ã®ä½¿è€…',
                            'æ°´ã®å¦–æ€ª'
                        ],
                        correct: 1,
                        hint: 'ç‹å…­éƒãŒè‡ªå·±ç´¹ä»‹ã—ãŸå†…å®¹ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚'
                    },
                    {
                        type: 'spirit_help',
                        question: 'ç‹å…­éƒã¯è¨±ã‚’ã©ã®ã‚ˆã†ã«åŠ©ã‘ã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'å®ç‰©ã‚’ä¸ãˆãŸ',
                            'ç—…æ°—ã‚’æ²»ã—ãŸ',
                            'é­šã‚’è¿½ã„è¾¼ã‚“ã§å¤§æ¼ã«ã—ãŸ',
                            'æœªæ¥ã‚’äºˆè¨€ã—ãŸ'
                        ],
                        correct: 2,
                        hint: 'æ¼å¸«ã§ã‚ã‚‹è¨±ã¸ã®æœ€ã‚‚å®Ÿç”¨çš„ãªåŠ©ã‘ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ'
                    },
                    {
                        type: 'reincarnation',
                        question: 'ç”Ÿã¾ã‚Œå¤‰ã‚ã£ãŸç‹å…­éƒã¯ã©ã†ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                        options: [
                            'è¨±ã‚’è¦šãˆã¦ã„ã¦æ„Ÿè¬ã—ãŸ',
                            'å‰ä¸–ã®è¨˜æ†¶ã¯ãªã„ãŒè¦ªå‹ã«ãªã£ãŸ',
                            'è¨±ã‚’é¿ã‘ãŸ',
                            'å†ã³æ°´æ­»ã—ãŸ'
                        ],
                        correct: 1,
                        hint: 'è»¢ç”Ÿå¾Œã®äºŒäººã®é–¢ä¿‚ã«ã¤ã„ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            },
            {
                id: 6,
                title: "é»„è‹±",
                content: `
                    <p>é¦¬å­æ‰ã¯èŠã®èŠ±ã‚’æ„›ã™ã‚‹æ–‡äººã ã£ãŸã€‚ã‚ã‚‹æ—¥ã€èŠèŠ±å£²ã‚Šã®å§‰å¼Ÿã¨å‡ºä¼šã£ãŸã€‚</p>
                    <p>å§‰ã®é»„è‹±ã¯ç¾ã—ãã€èŠã®æ ½åŸ¹ã«è©³ã—ã‹ã£ãŸã€‚å®Ÿã¯äºŒäººã¯èŠèŠ±ã®ç²¾éœŠã ã£ãŸã€‚</p>
                    <p>é¦¬å­æ‰ã¯é»„è‹±ã¨çµå©šã—ã€é»„è‹±ã®æŒ‡å°ã§è¦‹äº‹ãªèŠåœ’ã‚’ä½œã£ãŸã€‚ã—ã‹ã—é¦¬ã¯å•†å£²ã‚’è»½è”‘ã—ã¦ã„ãŸã€‚</p>
                    <p>é»„è‹±ã¯ã€ŒèŠ±ã‚’æ„›ã™ã‚‹ãªã‚‰ã€èŠ±ã§ç”Ÿè¨ˆã‚’ç«‹ã¦ã‚‹ã“ã¨ã‚‚å°Šã„ã€ã¨è«­ã—ã€é¦¬ã‚‚æ¬¡ç¬¬ã«ç†è§£ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚</p>
                `,
                puzzles: [
                    {
                        type: 'flower_spirit',
                        question: 'é»„è‹±ã¨å¼Ÿã®æ­£ä½“ã¯ï¼Ÿ',
                        options: [
                            'æ™®é€šã®èŠ±å£²ã‚Š',
                            'èŠèŠ±ã®ç²¾éœŠ',
                            'è²§ã—ã„è¾²æ°‘',
                            'ä»™ç•Œã®ä½¿è€…'
                        ],
                        correct: 1,
                        hint: 'å§‰å¼Ÿã®è¶…è‡ªç„¶çš„ãªæ­£ä½“ã«ã¤ã„ã¦è¨€åŠã•ã‚Œã¦ã„ã¾ã™ã€‚'
                    },
                    {
                        type: 'conflict_values',
                        question: 'é¦¬å­æ‰ãŒæœ€åˆã«è»½è”‘ã—ã¦ã„ãŸã“ã¨ã¯ï¼Ÿ',
                        options: [
                            'èŠ±ã‚’è‚²ã¦ã‚‹ã“ã¨',
                            'çµå©šã™ã‚‹ã“ã¨',
                            'å•†å£²ã‚’ã™ã‚‹ã“ã¨',
                            'å‹‰å¼·ã™ã‚‹ã“ã¨'
                        ],
                        correct: 2,
                        hint: 'æ–‡äººã¨ã—ã¦ã®é¦¬ã®ä¾¡å€¤è¦³ã¨å¯¾ç«‹ã—ãŸã‚‚ã®ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ'
                    },
                    {
                        type: 'wisdom_lesson',
                        question: 'é»„è‹±ãŒé¦¬ã«æ•™ãˆãŸæ•™è¨“ã¯ï¼Ÿ',
                        options: [
                            'é‡‘å„²ã‘ãŒå…¨ã¦',
                            'èŠ±ã‚’æ„›ã™ã‚‹ãªã‚‰èŠ±ã§ç”Ÿè¨ˆã‚’ç«‹ã¦ã‚‹ã“ã¨ã‚‚å°Šã„',
                            'å•†å£²äººã«ãªã‚‹ã¹ã',
                            'æ–‡äººã‚’ã‚„ã‚ã‚‹ã¹ã'
                        ],
                        correct: 1,
                        hint: 'é»„è‹±ã®è«­ã—ã®æ ¸å¿ƒçš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚'
                    }
                ]
            }
        ];

        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®åˆæœŸåŒ–
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
        let animationFrame = 0;
        let currentAnimation = 'detective';

        // ç«æŸ´äººæç”»é–¢æ•°
        function drawStickFigure(x, y, type = 'detective', frame = 0, scale = 1) {
            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);
            ctx.strokeStyle = type === 'detective' ? '#2c1810' : '#8b4513';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';

            // é ­
            ctx.beginPath();
            ctx.arc(0, -30, 15, 0, Math.PI * 2);
            ctx.stroke();

            if (type === 'detective') {
                // æ¢åµã®å¸½å­
                ctx.beginPath();
                ctx.moveTo(-20, -35);
                ctx.lineTo(20, -35);
                ctx.lineTo(15, -45);
                ctx.lineTo(-15, -45);
                ctx.closePath();
                ctx.stroke();

                // è™«çœ¼é¡
                ctx.beginPath();
                ctx.arc(25, -10, 8, 0, Math.PI * 2);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(31, -4);
                ctx.lineTo(40, 5);
                ctx.stroke();
            }

            // ä½“
            ctx.beginPath();
            ctx.moveTo(0, -15);
            ctx.lineTo(0, 20);
            ctx.stroke();

            // è…•ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            const armAngle = Math.sin(frame * 0.1) * 0.3;
            
            // å·¦è…•
            ctx.beginPath();
            ctx.moveTo(0, -5);
            ctx.lineTo(-15, 5);
            ctx.lineTo(-10 + Math.sin(frame * 0.1 + Math.PI) * 5, 20);
            ctx.stroke();

            // å³è…•
            ctx.beginPath();
            ctx.moveTo(0, -5);
            ctx.lineTo(15, 5);
            ctx.lineTo(10 + Math.sin(frame * 0.1) * 5, 20);
            ctx.stroke();

            // è„šï¼ˆæ­©è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            const legAngle = Math.sin(frame * 0.15) * 0.5;
            
            // å·¦è„š
            ctx.beginPath();
            ctx.moveTo(0, 20);
            ctx.lineTo(-10 + Math.sin(frame * 0.15) * 10, 40);
            ctx.lineTo(-15 + Math.sin(frame * 0.15) * 15, 60);
            ctx.stroke();

            // å³è„š
            ctx.beginPath();
            ctx.moveTo(0, 20);
            ctx.lineTo(10 + Math.sin(frame * 0.15 + Math.PI) * 10, 40);
            ctx.lineTo(15 + Math.sin(frame * 0.15 + Math.PI) * 15, 60);
            ctx.stroke();

            ctx.restore();
        }

        // å¦–æ€ªãƒ»å¹½éœŠæç”»
        function drawSupernatural(x, y, type, frame = 0) {
            ctx.save();
            ctx.translate(x, y);
            
            switch(type) {
                case 'ghost': // å¹½éœŠ
                    ctx.globalAlpha = 0.7;
                    ctx.strokeStyle = '#b3e5fc';
                    ctx.fillStyle = '#e1f5fe';
                    ctx.lineWidth = 2;
                    
                    // æµ®éŠåŠ¹æœ
                    const floatY = Math.sin(frame * 0.05) * 10;
                    ctx.translate(0, floatY);
                    
                    // ä½“ï¼ˆæµã‚Œã‚‹ã‚ˆã†ãªå½¢ï¼‰
                    ctx.beginPath();
                    ctx.moveTo(0, -30);
                    ctx.quadraticCurveTo(-20, 0, -15, 30);
                    ctx.quadraticCurveTo(-10, 40, 0, 35);
                    ctx.quadraticCurveTo(10, 40, 15, 30);
                    ctx.quadraticCurveTo(20, 0, 0, -30);
                    ctx.fill();
                    ctx.stroke();
                    
                    // é¡”
                    ctx.fillStyle = '#333';
                    ctx.beginPath();
                    ctx.arc(-5, -10, 3, 0, Math.PI * 2);
                    ctx.arc(5, -10, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.globalAlpha = 1;
                    break;
                    
                case 'fox': // ç‹ç‹¸ç²¾
                    ctx.strokeStyle = '#ff8a65';
                    ctx.fillStyle = '#ffccbc';
                    ctx.lineWidth = 2;
                    
                    // ä½“
                    ctx.beginPath();
                    ctx.ellipse(0, 0, 25, 18, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // é ­
                    ctx.beginPath();
                    ctx.arc(0, -20, 15, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // è€³
                    ctx.beginPath();
                    ctx.moveTo(-10, -28);
                    ctx.lineTo(-8, -40);
                    ctx.lineTo(-5, -30);
                    ctx.moveTo(10, -28);
                    ctx.lineTo(8, -40);
                    ctx.lineTo(5, -30);
                    ctx.stroke();
                    
                    // å°»å°¾ï¼ˆãµã‚ãµã‚ï¼‰
                    ctx.beginPath();
                    const tailAngle = Math.sin(frame * 0.08) * 0.3;
                    ctx.moveTo(20, 0);
                    ctx.quadraticCurveTo(
                        40 + Math.sin(frame * 0.1) * 5,
                        -10 + Math.cos(frame * 0.1) * 5,
                        35,
                        -25
                    );
                    ctx.stroke();
                    
                    // ç›®
                    ctx.fillStyle = '#333';
                    ctx.beginPath();
                    ctx.arc(-5, -20, 2, 0, Math.PI * 2);
                    ctx.arc(5, -20, 2, 0, Math.PI * 2);
                    ctx.fill();
                    break;
                    
                case 'flower_spirit': // èŠ±ã®ç²¾éœŠ
                    ctx.strokeStyle = '#c8e6c9';
                    ctx.fillStyle = '#a5d6a7';
                    ctx.lineWidth = 2;
                    
                    // èŠ±ã³ã‚‰ã®ã‚ˆã†ãªä½“
                    for (let i = 0; i < 5; i++) {
                        const angle = (Math.PI * 2 / 5) * i + frame * 0.02;
                        ctx.save();
                        ctx.rotate(angle);
                        ctx.beginPath();
                        ctx.ellipse(0, -20, 8, 20, 0, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.stroke();
                        ctx.restore();
                    }
                    
                    // ä¸­å¿ƒã®é¡”
                    ctx.fillStyle = '#fff9c4';
                    ctx.beginPath();
                    ctx.arc(0, 0, 12, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // ç›®
                    ctx.fillStyle = '#333';
                    ctx.beginPath();
                    ctx.arc(-4, -2, 2, 0, Math.PI * 2);
                    ctx.arc(4, -2, 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å¾®ç¬‘ã¿
                    ctx.beginPath();
                    ctx.arc(0, 2, 4, 0, Math.PI);
                    ctx.stroke();
                    break;
            }
            
            ctx.restore();
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // èƒŒæ™¯ï¼ˆç¥ç§˜çš„ãªé›°å›²æ°—ï¼‰
            const gradient = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width/2);
            gradient.addColorStop(0, 'rgba(230, 184, 255, 0.1)');
            gradient.addColorStop(1, 'rgba(139, 69, 19, 0.1)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æç”»
            if (currentAnimation === 'detective') {
                drawStickFigure(canvas.width / 2, canvas.height / 2 + 50, 'detective', animationFrame);
            } else if (currentAnimation === 'celebration') {
                // ç¥è³€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                drawStickFigure(canvas.width / 2, canvas.height / 2 + 50 - Math.abs(Math.sin(animationFrame * 0.1)) * 30, 'detective', animationFrame);
                
                // ç´™å¹é›ªåŠ¹æœï¼ˆç´«ç³»ï¼‰
                for (let i = 0; i < 10; i++) {
                    const hue = 270 + (i * 10); // ç´«ç³»ã®è‰²ç›¸
                    ctx.fillStyle = `hsl(${hue}, 70%, 60%)`;
                    ctx.fillRect(
                        canvas.width / 2 + Math.sin(animationFrame * 0.05 + i) * 100,
                        (animationFrame * 2 + i * 50) % canvas.height,
                        5,
                        10
                    );
                }
            } else if (currentAnimation === 'thinking') {
                drawStickFigure(canvas.width / 2, canvas.height / 2 + 50, 'detective', animationFrame);
                
                // æ€è€ƒãƒãƒ–ãƒ«
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(canvas.width / 2 + 50, canvas.height / 2 - 50, 30, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#333';
                ctx.font = '20px sans-serif';
                ctx.fillText('?', canvas.width / 2 + 45, canvas.height / 2 - 45);
            } else if (currentAnimation.includes('creature_')) {
                const creatureType = currentAnimation.replace('creature_', '');
                drawSupernatural(canvas.width / 2, canvas.height / 2, creatureType, animationFrame);
            }
            
            animationFrame++;
            requestAnimationFrame(animate);
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            gameState.chapters = liaozhaiStories;
            loadChapter(0);
            animate();
        }

        // ç« ã®èª­ã¿è¾¼ã¿
        function loadChapter(chapterIndex) {
            if (chapterIndex >= gameState.chapters.length) {
                showGameComplete();
                return;
            }
            
            gameState.currentChapter = chapterIndex;
            gameState.currentPuzzle = 0;
            const chapter = gameState.chapters[chapterIndex];
            
            document.getElementById('chapterTitle').textContent = chapter.title;
            document.getElementById('textDisplay').innerHTML = chapter.content;
            document.getElementById('puzzleArea').style.display = 'none';
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¤‰æ›´
            currentAnimation = 'detective';
            
            // 2ç§’å¾Œã«æœ€åˆã®ãƒ‘ã‚ºãƒ«ã‚’è¡¨ç¤º
            setTimeout(() => {
                showPuzzle(0);
            }, 3000);
        }

        // ãƒ‘ã‚ºãƒ«è¡¨ç¤º
        function showPuzzle(puzzleIndex) {
            const chapter = gameState.chapters[gameState.currentChapter];
            const puzzle = chapter.puzzles[puzzleIndex];
            
            document.getElementById('puzzleArea').style.display = 'block';
            document.getElementById('puzzleQuestion').textContent = puzzle.question;
            document.getElementById('hintText').style.display = 'none';
            
            const optionsContainer = document.getElementById('puzzleOptions');
            optionsContainer.innerHTML = '';
            
            puzzle.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option;
                button.onclick = () => checkAnswer(index, puzzle.correct);
                optionsContainer.appendChild(button);
            });
            
            currentAnimation = 'thinking';
        }

        // ç­”ãˆç¢ºèª
        function checkAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach(btn => btn.disabled = true);
            
            if (selected === correct) {
                buttons[selected].classList.add('correct');
                gameState.score += 100;
                gameState.completedPuzzles++;
                currentAnimation = 'celebration';
                
                // æ‰‹ãŒã‹ã‚Šã‚’è¿½åŠ 
                addClue(`âœ“ ${gameState.chapters[gameState.currentChapter].title} - ãƒ‘ã‚ºãƒ«${gameState.currentPuzzle + 1}ã‚¯ãƒªã‚¢`);
                
                setTimeout(() => {
                    nextPuzzle();
                }, 2000);
            } else {
                buttons[selected].classList.add('wrong');
                buttons[correct].classList.add('correct');
                gameState.score = Math.max(0, gameState.score - 20);
                
                setTimeout(() => {
                    buttons.forEach(btn => {
                        btn.disabled = false;
                        btn.classList.remove('wrong', 'correct');
                    });
                    currentAnimation = 'detective';
                }, 2000);
            }
            
            updateScore();
            updateProgress();
        }

        // æ¬¡ã®ãƒ‘ã‚ºãƒ«
        function nextPuzzle() {
            gameState.currentPuzzle++;
            
            if (gameState.currentPuzzle >= gameState.totalPuzzles) {
                // ç« ã‚¯ãƒªã‚¢
                showChapterComplete();
            } else {
                showPuzzle(gameState.currentPuzzle);
            }
        }

        // ç« ã‚¯ãƒªã‚¢è¡¨ç¤º
        function showChapterComplete() {
            gameState.score += 300; // ãƒœãƒ¼ãƒŠã‚¹ãƒã‚¤ãƒ³ãƒˆ
            updateScore();
            
            document.getElementById('modalTitle').textContent = 'ç‰©èªã‚¯ãƒªã‚¢ï¼';
            document.getElementById('modalMessage').textContent = `${gameState.chapters[gameState.currentChapter].title}ã‚’å®Œäº†ã—ã¾ã—ãŸï¼\nãƒœãƒ¼ãƒŠã‚¹: +300ç‚¹`;
            document.getElementById('modal').classList.add('active');
            
            currentAnimation = 'celebration';
        }

        // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢
        function showGameComplete() {
            document.getElementById('modalTitle').textContent = 'ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼';
            document.getElementById('modalMessage').textContent = `ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼\nå…¨ã¦ã®ç‰©èªã‚’è§£æ˜ã—ã¾ã—ãŸï¼\næœ€çµ‚ã‚¹ã‚³ã‚¢: ${gameState.score}ç‚¹`;
            document.getElementById('modal').classList.add('active');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            loadChapter(gameState.currentChapter + 1);
        }

        // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
        function showHint() {
            const chapter = gameState.chapters[gameState.currentChapter];
            const puzzle = chapter.puzzles[gameState.currentPuzzle];
            
            document.getElementById('hintText').textContent = puzzle.hint;
            document.getElementById('hintText').style.display = 'block';
            
            gameState.score = Math.max(0, gameState.score - 10);
            updateScore();
        }

        // ã‚¹ã‚³ã‚¢æ›´æ–°
        function updateScore() {
            document.getElementById('scoreValue').textContent = gameState.score;
        }

        // é€²æ—æ›´æ–°
        function updateProgress() {
            const totalPuzzles = gameState.chapters.length * gameState.totalPuzzles;
            const progress = (gameState.completedPuzzles / totalPuzzles) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        // æ‰‹ãŒã‹ã‚Šè¿½åŠ 
        function addClue(clue) {
            gameState.clues.push(clue);
            const cluesList = document.getElementById('cluesList');
            const clueItem = document.createElement('div');
            clueItem.className = 'clue-item';
            clueItem.textContent = clue;
            cluesList.appendChild(clueItem);
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        window.addEventListener('resize', () => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        });

        // åˆæœŸåŒ–
        updateScore();
        updateProgress();
    </script>
</body>
</html>