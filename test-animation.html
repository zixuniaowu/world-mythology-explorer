<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>动画测试</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        canvas {
            border: 2px solid #333;
            display: block;
            margin: 20px auto;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
        }
        .controls {
            text-align: center;
            margin: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 0 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #status {
            text-align: center;
            margin: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">火柴人动画测试</h1>
    <div id="status">状态：准备就绪</div>
    <canvas id="canvas" width="800" height="400"></canvas>
    <div class="controls">
        <button onclick="startAnimation()">开始动画</button>
        <button onclick="stopAnimation()">停止动画</button>
        <button onclick="addFigure()">添加火柴人</button>
    </div>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        
        let animating = false;
        let frame = 0;
        let figures = [];
        
        // 添加初始火柴人
        figures.push({
            x: 100,
            y: 300,
            vx: 2,
            type: 'walking'
        });
        
        function drawStickFigure(x, y, frame) {
            ctx.save();
            ctx.translate(x, y);
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 3;
            
            // 头
            ctx.beginPath();
            ctx.arc(0, -40, 15, 0, Math.PI * 2);
            ctx.stroke();
            
            // 身体
            ctx.beginPath();
            ctx.moveTo(0, -25);
            ctx.lineTo(0, 0);
            ctx.stroke();
            
            // 手臂
            const armSwing = Math.sin(frame * 0.1) * 20;
            ctx.beginPath();
            ctx.moveTo(0, -15);
            ctx.lineTo(-20 + armSwing, -5);
            ctx.moveTo(0, -15);
            ctx.lineTo(20 - armSwing, -5);
            ctx.stroke();
            
            // 腿 - 行走动画
            const legPhase = frame * 0.1;
            const leftLegAngle = Math.sin(legPhase) * 30;
            const rightLegAngle = Math.sin(legPhase + Math.PI) * 30;
            
            ctx.beginPath();
            // 左腿
            ctx.moveTo(0, 0);
            ctx.lineTo(-10 + leftLegAngle * 0.5, 20);
            ctx.lineTo(-15 + leftLegAngle, 40);
            
            // 右腿
            ctx.moveTo(0, 0);
            ctx.lineTo(10 + rightLegAngle * 0.5, 20);
            ctx.lineTo(15 + rightLegAngle, 40);
            ctx.stroke();
            
            ctx.restore();
        }
        
        function animate() {
            if (!animating) return;
            
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制背景
            ctx.fillStyle = 'rgba(135, 206, 235, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 更新和绘制所有火柴人
            figures.forEach((figure, index) => {
                // 更新位置
                figure.x += figure.vx;
                
                // 边界检测
                if (figure.x > canvas.width - 50 || figure.x < 50) {
                    figure.vx = -figure.vx;
                }
                
                // 绘制火柴人
                drawStickFigure(figure.x, figure.y, frame);
                
                // 显示ID
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(`#${index + 1}`, figure.x - 10, figure.y - 60);
            });
            
            // 显示帧数
            ctx.fillStyle = '#666';
            ctx.font = '16px Arial';
            ctx.fillText(`帧: ${frame}`, 10, 30);
            ctx.fillText(`火柴人数量: ${figures.length}`, 10, 50);
            
            frame++;
            requestAnimationFrame(animate);
        }
        
        function startAnimation() {
            if (!animating) {
                animating = true;
                status.textContent = '状态：动画播放中...';
                animate();
            }
        }
        
        function stopAnimation() {
            animating = false;
            status.textContent = '状态：动画已停止';
        }
        
        function addFigure() {
            figures.push({
                x: Math.random() * (canvas.width - 100) + 50,
                y: 300,
                vx: (Math.random() - 0.5) * 4 + 1,
                type: 'walking'
            });
            status.textContent = `状态：添加了新的火柴人 (总计: ${figures.length})`;
        }
        
        // 初始绘制
        animate();
        status.textContent = '状态：准备就绪 - 点击"开始动画"';
    </script>
</body>
</html>